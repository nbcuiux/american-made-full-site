this.createjs = this.createjs || {},
    function() {
        "use strict";
        var a = createjs.PreloadJS = createjs.PreloadJS || {};
        a.version = "0.6.2", a.buildDate = "Thu, 26 Nov 2015 20:44:31 GMT"
    }(), this.createjs = this.createjs || {}, createjs.extend = function(a, b) {
        "use strict";

        function c() {
            this.constructor = a
        }
        return c.prototype = b.prototype, a.prototype = new c
    }, this.createjs = this.createjs || {}, createjs.promote = function(a, b) {
        "use strict";
        var c = a.prototype,
            d = Object.getPrototypeOf && Object.getPrototypeOf(c) || c.__proto__;
        if (d) {
            c[(b += "_") + "constructor"] = d.constructor;
            for (var e in d) c.hasOwnProperty(e) && "function" == typeof d[e] && (c[b + e] = d[e])
        }
        return a
    }, this.createjs = this.createjs || {},
    function() {
        "use strict";
        createjs.proxy = function(a, b) {
            var c = Array.prototype.slice.call(arguments, 2);
            return function() {
                return a.apply(b, Array.prototype.slice.call(arguments, 0).concat(c))
            }
        }
    }(), this.createjs = this.createjs || {}, createjs.indexOf = function(a, b) {
        "use strict";
        for (var c = 0, d = a.length; d > c; c++)
            if (b === a[c]) return c;
        return -1
    }, this.createjs = this.createjs || {},
    function() {
        "use strict";

        function Event(a, b, c) {
            this.type = a, this.target = null, this.currentTarget = null, this.eventPhase = 0, this.bubbles = !!b, this.cancelable = !!c, this.timeStamp = (new Date).getTime(), this.defaultPrevented = !1, this.propagationStopped = !1, this.immediatePropagationStopped = !1, this.removed = !1
        }
        var a = Event.prototype;
        a.preventDefault = function() {
            this.defaultPrevented = this.cancelable && !0
        }, a.stopPropagation = function() {
            this.propagationStopped = !0
        }, a.stopImmediatePropagation = function() {
            this.immediatePropagationStopped = this.propagationStopped = !0
        }, a.remove = function() {
            this.removed = !0
        }, a.clone = function() {
            return new Event(this.type, this.bubbles, this.cancelable)
        }, a.set = function(a) {
            for (var b in a) this[b] = a[b];
            return this
        }, a.toString = function() {
            return "[Event (type=" + this.type + ")]"
        }, createjs.Event = Event
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function ErrorEvent(a, b, c) {
            this.Event_constructor("error"), this.title = a, this.message = b, this.data = c
        }
        var a = createjs.extend(ErrorEvent, createjs.Event);
        a.clone = function() {
            return new createjs.ErrorEvent(this.title, this.message, this.data)
        }, createjs.ErrorEvent = createjs.promote(ErrorEvent, "Event")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function EventDispatcher() {
            this._listeners = null, this._captureListeners = null
        }
        var a = EventDispatcher.prototype;
        EventDispatcher.initialize = function(b) {
            b.addEventListener = a.addEventListener, b.on = a.on, b.removeEventListener = b.off = a.removeEventListener, b.removeAllEventListeners = a.removeAllEventListeners, b.hasEventListener = a.hasEventListener, b.dispatchEvent = a.dispatchEvent, b._dispatchEvent = a._dispatchEvent, b.willTrigger = a.willTrigger
        }, a.addEventListener = function(a, b, c) {
            var d;
            d = c ? this._captureListeners = this._captureListeners || {} : this._listeners = this._listeners || {};
            var e = d[a];
            return e && this.removeEventListener(a, b, c), e = d[a], e ? e.push(b) : d[a] = [b], b
        }, a.on = function(a, b, c, d, e, f) {
            return b.handleEvent && (c = c || b, b = b.handleEvent), c = c || this, this.addEventListener(a, function(a) {
                b.call(c, a, e), d && a.remove()
            }, f)
        }, a.removeEventListener = function(a, b, c) {
            var d = c ? this._captureListeners : this._listeners;
            if (d) {
                var e = d[a];
                if (e)
                    for (var f = 0, g = e.length; g > f; f++)
                        if (e[f] == b) {
                            1 == g ? delete d[a] : e.splice(f, 1);
                            break
                        }
            }
        }, a.off = a.removeEventListener, a.removeAllEventListeners = function(a) {
            a ? (this._listeners && delete this._listeners[a], this._captureListeners && delete this._captureListeners[a]) : this._listeners = this._captureListeners = null
        }, a.dispatchEvent = function(a, b, c) {
            if ("string" == typeof a) {
                var d = this._listeners;
                if (!(b || d && d[a])) return !0;
                a = new createjs.Event(a, b, c)
            } else a.target && a.clone && (a = a.clone());
            try {
                a.target = this
            } catch (e) {}
            if (a.bubbles && this.parent) {
                for (var f = this, g = [f]; f.parent;) g.push(f = f.parent);
                var h, i = g.length;
                for (h = i - 1; h >= 0 && !a.propagationStopped; h--) g[h]._dispatchEvent(a, 1 + (0 == h));
                for (h = 1; i > h && !a.propagationStopped; h++) g[h]._dispatchEvent(a, 3)
            } else this._dispatchEvent(a, 2);
            return !a.defaultPrevented
        }, a.hasEventListener = function(a) {
            var b = this._listeners,
                c = this._captureListeners;
            return !!(b && b[a] || c && c[a])
        }, a.willTrigger = function(a) {
            for (var b = this; b;) {
                if (b.hasEventListener(a)) return !0;
                b = b.parent
            }
            return !1
        }, a.toString = function() {
            return "[EventDispatcher]"
        }, a._dispatchEvent = function(a, b) {
            var c, d = 1 == b ? this._captureListeners : this._listeners;
            if (a && d) {
                var e = d[a.type];
                if (!e || !(c = e.length)) return;
                try {
                    a.currentTarget = this
                } catch (f) {}
                try {
                    a.eventPhase = b
                } catch (f) {}
                a.removed = !1, e = e.slice();
                for (var g = 0; c > g && !a.immediatePropagationStopped; g++) {
                    var h = e[g];
                    h.handleEvent ? h.handleEvent(a) : h(a), a.removed && (this.off(a.type, h, 1 == b), a.removed = !1)
                }
            }
        }, createjs.EventDispatcher = EventDispatcher
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function ProgressEvent(a, b) {
            this.Event_constructor("progress"), this.loaded = a, this.total = null == b ? 1 : b, this.progress = 0 == b ? 0 : this.loaded / this.total
        }
        var a = createjs.extend(ProgressEvent, createjs.Event);
        a.clone = function() {
            return new createjs.ProgressEvent(this.loaded, this.total)
        }, createjs.ProgressEvent = createjs.promote(ProgressEvent, "Event")
    }(window),
    function() {
        function a(b, d) {
            function f(a) {
                if (f[a] !== q) return f[a];
                var b;
                if ("bug-string-char-index" == a) b = "a" != "a" [0];
                else if ("json" == a) b = f("json-stringify") && f("json-parse");
                else {
                    var c, e = '{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';
                    if ("json-stringify" == a) {
                        var i = d.stringify,
                            k = "function" == typeof i && t;
                        if (k) {
                            (c = function() {
                                return 1
                            }).toJSON = c;
                            try {
                                k = "0" === i(0) && "0" === i(new g) && '""' == i(new h) && i(s) === q && i(q) === q && i() === q && "1" === i(c) && "[1]" == i([c]) && "[null]" == i([q]) && "null" == i(null) && "[null,null,null]" == i([q, s, null]) && i({
                                    a: [c, !0, !1, null, "\x00\b\n\f\r	"]
                                }) == e && "1" === i(null, c) && "[\n 1,\n 2\n]" == i([1, 2], null, 1) && '"-271821-04-20T00:00:00.000Z"' == i(new j(-864e13)) && '"+275760-09-13T00:00:00.000Z"' == i(new j(864e13)) && '"-000001-01-01T00:00:00.000Z"' == i(new j(-621987552e5)) && '"1969-12-31T23:59:59.999Z"' == i(new j(-1))
                            } catch (l) {
                                k = !1
                            }
                        }
                        b = k
                    }
                    if ("json-parse" == a) {
                        var m = d.parse;
                        if ("function" == typeof m) try {
                            if (0 === m("0") && !m(!1)) {
                                c = m(e);
                                var n = 5 == c.a.length && 1 === c.a[0];
                                if (n) {
                                    try {
                                        n = !m('"	"')
                                    } catch (l) {}
                                    if (n) try {
                                        n = 1 !== m("01")
                                    } catch (l) {}
                                    if (n) try {
                                        n = 1 !== m("1.")
                                    } catch (l) {}
                                }
                            }
                        } catch (l) {
                            n = !1
                        }
                        b = n
                    }
                }
                return f[a] = !!b
            }
            b || (b = e.Object()), d || (d = e.Object());
            var g = b.Number || e.Number,
                h = b.String || e.String,
                i = b.Object || e.Object,
                j = b.Date || e.Date,
                k = b.SyntaxError || e.SyntaxError,
                l = b.TypeError || e.TypeError,
                m = b.Math || e.Math,
                n = b.JSON || e.JSON;
            "object" == typeof n && n && (d.stringify = n.stringify, d.parse = n.parse);
            var o, p, q, r = i.prototype,
                s = r.toString,
                t = new j(-0xc782b5b800cec);
            try {
                t = -109252 == t.getUTCFullYear() && 0 === t.getUTCMonth() && 1 === t.getUTCDate() && 10 == t.getUTCHours() && 37 == t.getUTCMinutes() && 6 == t.getUTCSeconds() && 708 == t.getUTCMilliseconds()
            } catch (u) {}
            if (!f("json")) {
                var v = "[object Function]",
                    w = "[object Date]",
                    x = "[object Number]",
                    y = "[object String]",
                    z = "[object Array]",
                    A = "[object Boolean]",
                    B = f("bug-string-char-index");
                if (!t) var C = m.floor,
                    D = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334],
                    E = function(a, b) {
                        return D[b] + 365 * (a - 1970) + C((a - 1969 + (b = +(b > 1))) / 4) - C((a - 1901 + b) / 100) + C((a - 1601 + b) / 400)
                    };
                if ((o = r.hasOwnProperty) || (o = function(a) {
                        var b, c = {};
                        return (c.__proto__ = null, c.__proto__ = {
                            toString: 1
                        }, c).toString != s ? o = function(a) {
                            var b = this.__proto__,
                                c = a in (this.__proto__ = null, this);
                            return this.__proto__ = b, c
                        } : (b = c.constructor, o = function(a) {
                            var c = (this.constructor || b).prototype;
                            return a in this && !(a in c && this[a] === c[a])
                        }), c = null, o.call(this, a)
                    }), p = function(a, b) {
                        var d, e, f, g = 0;
                        (d = function() {
                            this.valueOf = 0
                        }).prototype.valueOf = 0, e = new d;
                        for (f in e) o.call(e, f) && g++;
                        return d = e = null, g ? p = 2 == g ? function(a, b) {
                            var c, d = {},
                                e = s.call(a) == v;
                            for (c in a) e && "prototype" == c || o.call(d, c) || !(d[c] = 1) || !o.call(a, c) || b(c)
                        } : function(a, b) {
                            var c, d, e = s.call(a) == v;
                            for (c in a) e && "prototype" == c || !o.call(a, c) || (d = "constructor" === c) || b(c);
                            (d || o.call(a, c = "constructor")) && b(c)
                        } : (e = ["valueOf", "toString", "toLocaleString", "propertyIsEnumerable", "isPrototypeOf", "hasOwnProperty", "constructor"], p = function(a, b) {
                            var d, f, g = s.call(a) == v,
                                h = !g && "function" != typeof a.constructor && c[typeof a.hasOwnProperty] && a.hasOwnProperty || o;
                            for (d in a) g && "prototype" == d || !h.call(a, d) || b(d);
                            for (f = e.length; d = e[--f]; h.call(a, d) && b(d));
                        }), p(a, b)
                    }, !f("json-stringify")) {
                    var F = {
                            92: "\\\\",
                            34: '\\"',
                            8: "\\b",
                            12: "\\f",
                            10: "\\n",
                            13: "\\r",
                            9: "\\t"
                        },
                        G = "000000",
                        H = function(a, b) {
                            return (G + (b || 0)).slice(-a)
                        },
                        I = "\\u00",
                        J = function(a) {
                            for (var b = '"', c = 0, d = a.length, e = !B || d > 10, f = e && (B ? a.split("") : a); d > c; c++) {
                                var g = a.charCodeAt(c);
                                switch (g) {
                                    case 8:
                                    case 9:
                                    case 10:
                                    case 12:
                                    case 13:
                                    case 34:
                                    case 92:
                                        b += F[g];
                                        break;
                                    default:
                                        if (32 > g) {
                                            b += I + H(2, g.toString(16));
                                            break
                                        }
                                        b += e ? f[c] : a.charAt(c)
                                }
                            }
                            return b + '"'
                        },
                        K = function(a, b, c, d, e, f, g) {
                            var h, i, j, k, m, n, r, t, u, v, B, D, F, G, I, L;
                            try {
                                h = b[a]
                            } catch (M) {}
                            if ("object" == typeof h && h)
                                if (i = s.call(h), i != w || o.call(h, "toJSON")) "function" == typeof h.toJSON && (i != x && i != y && i != z || o.call(h, "toJSON")) && (h = h.toJSON(a));
                                else if (h > -1 / 0 && 1 / 0 > h) {
                                if (E) {
                                    for (m = C(h / 864e5), j = C(m / 365.2425) + 1970 - 1; E(j + 1, 0) <= m; j++);
                                    for (k = C((m - E(j, 0)) / 30.42); E(j, k + 1) <= m; k++);
                                    m = 1 + m - E(j, k), n = (h % 864e5 + 864e5) % 864e5, r = C(n / 36e5) % 24, t = C(n / 6e4) % 60, u = C(n / 1e3) % 60, v = n % 1e3
                                } else j = h.getUTCFullYear(), k = h.getUTCMonth(), m = h.getUTCDate(), r = h.getUTCHours(), t = h.getUTCMinutes(), u = h.getUTCSeconds(), v = h.getUTCMilliseconds();
                                h = (0 >= j || j >= 1e4 ? (0 > j ? "-" : "+") + H(6, 0 > j ? -j : j) : H(4, j)) + "-" + H(2, k + 1) + "-" + H(2, m) + "T" + H(2, r) + ":" + H(2, t) + ":" + H(2, u) + "." + H(3, v) + "Z"
                            } else h = null;
                            if (c && (h = c.call(b, a, h)), null === h) return "null";
                            if (i = s.call(h), i == A) return "" + h;
                            if (i == x) return h > -1 / 0 && 1 / 0 > h ? "" + h : "null";
                            if (i == y) return J("" + h);
                            if ("object" == typeof h) {
                                for (G = g.length; G--;)
                                    if (g[G] === h) throw l();
                                if (g.push(h), B = [], I = f, f += e, i == z) {
                                    for (F = 0, G = h.length; G > F; F++) D = K(F, h, c, d, e, f, g), B.push(D === q ? "null" : D);
                                    L = B.length ? e ? "[\n" + f + B.join(",\n" + f) + "\n" + I + "]" : "[" + B.join(",") + "]" : "[]"
                                } else p(d || h, function(a) {
                                    var b = K(a, h, c, d, e, f, g);
                                    b !== q && B.push(J(a) + ":" + (e ? " " : "") + b)
                                }), L = B.length ? e ? "{\n" + f + B.join(",\n" + f) + "\n" + I + "}" : "{" + B.join(",") + "}" : "{}";
                                return g.pop(), L
                            }
                        };
                    d.stringify = function(a, b, d) {
                        var e, f, g, h;
                        if (c[typeof b] && b)
                            if ((h = s.call(b)) == v) f = b;
                            else if (h == z) {
                            g = {};
                            for (var i, j = 0, k = b.length; k > j; i = b[j++], h = s.call(i), (h == y || h == x) && (g[i] = 1));
                        }
                        if (d)
                            if ((h = s.call(d)) == x) {
                                if ((d -= d % 1) > 0)
                                    for (e = "", d > 10 && (d = 10); e.length < d; e += " ");
                            } else h == y && (e = d.length <= 10 ? d : d.slice(0, 10));
                        return K("", (i = {}, i[""] = a, i), f, g, e, "", [])
                    }
                }
                if (!f("json-parse")) {
                    var L, M, N = h.fromCharCode,
                        O = {
                            92: "\\",
                            34: '"',
                            47: "/",
                            98: "\b",
                            116: "	",
                            110: "\n",
                            102: "\f",
                            114: "\r"
                        },
                        P = function() {
                            throw L = M = null, k()
                        },
                        Q = function() {
                            for (var a, b, c, d, e, f = M, g = f.length; g > L;) switch (e = f.charCodeAt(L)) {
                                case 9:
                                case 10:
                                case 13:
                                case 32:
                                    L++;
                                    break;
                                case 123:
                                case 125:
                                case 91:
                                case 93:
                                case 58:
                                case 44:
                                    return a = B ? f.charAt(L) : f[L], L++, a;
                                case 34:
                                    for (a = "@", L++; g > L;)
                                        if (e = f.charCodeAt(L), 32 > e) P();
                                        else if (92 == e) switch (e = f.charCodeAt(++L)) {
                                        case 92:
                                        case 34:
                                        case 47:
                                        case 98:
                                        case 116:
                                        case 110:
                                        case 102:
                                        case 114:
                                            a += O[e], L++;
                                            break;
                                        case 117:
                                            for (b = ++L, c = L + 4; c > L; L++) e = f.charCodeAt(L), e >= 48 && 57 >= e || e >= 97 && 102 >= e || e >= 65 && 70 >= e || P();
                                            a += N("0x" + f.slice(b, L));
                                            break;
                                        default:
                                            P()
                                    } else {
                                        if (34 == e) break;
                                        for (e = f.charCodeAt(L), b = L; e >= 32 && 92 != e && 34 != e;) e = f.charCodeAt(++L);
                                        a += f.slice(b, L)
                                    }
                                    if (34 == f.charCodeAt(L)) return L++, a;
                                    P();
                                default:
                                    if (b = L, 45 == e && (d = !0, e = f.charCodeAt(++L)), e >= 48 && 57 >= e) {
                                        for (48 == e && (e = f.charCodeAt(L + 1), e >= 48 && 57 >= e) && P(), d = !1; g > L && (e = f.charCodeAt(L), e >= 48 && 57 >= e); L++);
                                        if (46 == f.charCodeAt(L)) {
                                            for (c = ++L; g > c && (e = f.charCodeAt(c), e >= 48 && 57 >= e); c++);
                                            c == L && P(), L = c
                                        }
                                        if (e = f.charCodeAt(L), 101 == e || 69 == e) {
                                            for (e = f.charCodeAt(++L), (43 == e || 45 == e) && L++, c = L; g > c && (e = f.charCodeAt(c), e >= 48 && 57 >= e); c++);
                                            c == L && P(), L = c
                                        }
                                        return +f.slice(b, L)
                                    }
                                    if (d && P(), "true" == f.slice(L, L + 4)) return L += 4, !0;
                                    if ("false" == f.slice(L, L + 5)) return L += 5, !1;
                                    if ("null" == f.slice(L, L + 4)) return L += 4, null;
                                    P()
                            }
                            return "$"
                        },
                        R = function(a) {
                            var b, c;
                            if ("$" == a && P(), "string" == typeof a) {
                                if ("@" == (B ? a.charAt(0) : a[0])) return a.slice(1);
                                if ("[" == a) {
                                    for (b = []; a = Q(), "]" != a; c || (c = !0)) c && ("," == a ? (a = Q(), "]" == a && P()) : P()), "," == a && P(), b.push(R(a));
                                    return b
                                }
                                if ("{" == a) {
                                    for (b = {}; a = Q(), "}" != a; c || (c = !0)) c && ("," == a ? (a = Q(), "}" == a && P()) : P()), ("," == a || "string" != typeof a || "@" != (B ? a.charAt(0) : a[0]) || ":" != Q()) && P(), b[a.slice(1)] = R(Q());
                                    return b
                                }
                                P()
                            }
                            return a
                        },
                        S = function(a, b, c) {
                            var d = T(a, b, c);
                            d === q ? delete a[b] : a[b] = d
                        },
                        T = function(a, b, c) {
                            var d, e = a[b];
                            if ("object" == typeof e && e)
                                if (s.call(e) == z)
                                    for (d = e.length; d--;) S(e, d, c);
                                else p(e, function(a) {
                                    S(e, a, c)
                                });
                            return c.call(a, b, e)
                        };
                    d.parse = function(a, b) {
                        var c, d;
                        return L = 0, M = "" + a, c = R(Q()), "$" != Q() && P(), L = M = null, b && s.call(b) == v ? T((d = {}, d[""] = c, d), "", b) : c
                    }
                }
            }
            return d.runInContext = a, d
        }
        var b = "function" == typeof define && define.amd,
            c = {
                "function": !0,
                object: !0
            },
            d = c[typeof exports] && exports && !exports.nodeType && exports,
            e = c[typeof window] && window || this,
            f = d && c[typeof module] && module && !module.nodeType && "object" == typeof global && global;
        if (!f || f.global !== f && f.window !== f && f.self !== f || (e = f), d && !b) a(e, d);
        else {
            var g = e.JSON,
                h = e.JSON3,
                i = !1,
                j = a(e, e.JSON3 = {
                    noConflict: function() {
                        return i || (i = !0, e.JSON = g, e.JSON3 = h, g = h = null), j
                    }
                });
            e.JSON = {
                parse: j.parse,
                stringify: j.stringify
            }
        }
        b && define(function() {
            return j
        })
    }.call(this),
    function() {
        var a = {};
        a.appendToHead = function(b) {
            a.getHead().appendChild(b)
        }, a.getHead = function() {
            return document.head || document.getElementsByTagName("head")[0]
        }, a.getBody = function() {
            return document.body || document.getElementsByTagName("body")[0]
        }, createjs.DomUtils = a
    }(),
    function() {
        var a = {};
        a.parseXML = function(a, b) {
            var c = null;
            try {
                if (window.DOMParser) {
                    var d = new DOMParser;
                    c = d.parseFromString(a, b)
                }
            } catch (e) {}
            if (!c) try {
                c = new ActiveXObject("Microsoft.XMLDOM"), c.async = !1, c.loadXML(a)
            } catch (e) {
                c = null
            }
            return c
        }, a.parseJSON = function(a) {
            if (null == a) return null;
            try {
                return JSON.parse(a)
            } catch (b) {
                throw b
            }
        }, createjs.DataUtils = a
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function LoadItem() {
            this.src = null, this.type = null, this.id = null, this.maintainOrder = !1, this.callback = null, this.data = null, this.method = createjs.LoadItem.GET, this.values = null, this.headers = null, this.withCredentials = !1, this.mimeType = null, this.crossOrigin = null, this.loadTimeout = b.LOAD_TIMEOUT_DEFAULT
        }
        var a = LoadItem.prototype = {},
            b = LoadItem;
        b.LOAD_TIMEOUT_DEFAULT = 8e3, b.create = function(a) {
            if ("string" == typeof a) {
                var c = new LoadItem;
                return c.src = a, c
            }
            if (a instanceof b) return a;
            if (a instanceof Object && a.src) return null == a.loadTimeout && (a.loadTimeout = b.LOAD_TIMEOUT_DEFAULT), a;
            throw new Error("Type not recognized.")
        }, a.set = function(a) {
            for (var b in a) this[b] = a[b];
            return this
        }, createjs.LoadItem = b
    }(),
    function() {
        var a = {};
        a.ABSOLUTE_PATT = /^(?:\w+:)?\/{2}/i, a.RELATIVE_PATT = /^[.\/]*?\//i, a.EXTENSION_PATT = /\/?[^\/]+\.(\w{1,5})$/i, a.parseURI = function(b) {
            var c = {
                absolute: !1,
                relative: !1
            };
            if (null == b) return c;
            var d = b.indexOf("?");
            d > -1 && (b = b.substr(0, d));
            var e;
            return a.ABSOLUTE_PATT.test(b) ? c.absolute = !0 : a.RELATIVE_PATT.test(b) && (c.relative = !0), (e = b.match(a.EXTENSION_PATT)) && (c.extension = e[1].toLowerCase()), c
        }, a.formatQueryString = function(a, b) {
            if (null == a) throw new Error("You must specify data.");
            var c = [];
            for (var d in a) c.push(d + "=" + escape(a[d]));
            return b && (c = c.concat(b)), c.join("&")
        }, a.buildPath = function(a, b) {
            if (null == b) return a;
            var c = [],
                d = a.indexOf("?");
            if (-1 != d) {
                var e = a.slice(d + 1);
                c = c.concat(e.split("&"))
            }
            return -1 != d ? a.slice(0, d) + "?" + this.formatQueryString(b, c) : a + "?" + this.formatQueryString(b, c)
        }, a.isCrossDomain = function(a) {
            var b = document.createElement("a");
            b.href = a.src;
            var c = document.createElement("a");
            c.href = location.href;
            var d = "" != b.hostname && (b.port != c.port || b.protocol != c.protocol || b.hostname != c.hostname);
            return d
        }, a.isLocal = function(a) {
            var b = document.createElement("a");
            return b.href = a.src, "" == b.hostname && "file:" == b.protocol
        }, a.isBinary = function(a) {
            switch (a) {
                case createjs.AbstractLoader.IMAGE:
                case createjs.AbstractLoader.BINARY:
                    return !0;
                default:
                    return !1
            }
        }, a.isImageTag = function(a) {
            return a instanceof HTMLImageElement
        }, a.isAudioTag = function(a) {
            return window.HTMLAudioElement ? a instanceof HTMLAudioElement : !1
        }, a.isVideoTag = function(a) {
            return window.HTMLVideoElement ? a instanceof HTMLVideoElement : !1
        }, a.isText = function(a) {
            switch (a) {
                case createjs.AbstractLoader.TEXT:
                case createjs.AbstractLoader.JSON:
                case createjs.AbstractLoader.MANIFEST:
                case createjs.AbstractLoader.XML:
                case createjs.AbstractLoader.CSS:
                case createjs.AbstractLoader.SVG:
                case createjs.AbstractLoader.JAVASCRIPT:
                case createjs.AbstractLoader.SPRITESHEET:
                    return !0;
                default:
                    return !1
            }
        }, a.getTypeByExtension = function(a) {
            if (null == a) return createjs.AbstractLoader.TEXT;
            switch (a.toLowerCase()) {
                case "jpeg":
                case "jpg":
                case "gif":
                case "png":
                case "webp":
                case "bmp":
                    return createjs.AbstractLoader.IMAGE;
                case "ogg":
                case "mp3":
                case "webm":
                    return createjs.AbstractLoader.SOUND;
                case "mp4":
                case "webm":
                case "ts":
                    return createjs.AbstractLoader.VIDEO;
                case "json":
                    return createjs.AbstractLoader.JSON;
                case "xml":
                    return createjs.AbstractLoader.XML;
                case "css":
                    return createjs.AbstractLoader.CSS;
                case "js":
                    return createjs.AbstractLoader.JAVASCRIPT;
                case "svg":
                    return createjs.AbstractLoader.SVG;
                default:
                    return createjs.AbstractLoader.TEXT
            }
        }, createjs.RequestUtils = a
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function AbstractLoader(a, b, c) {
            this.EventDispatcher_constructor(), this.loaded = !1, this.canceled = !1, this.progress = 0, this.type = c, this.resultFormatter = null, this._item = a ? createjs.LoadItem.create(a) : null, this._preferXHR = b, this._result = null, this._rawResult = null, this._loadedItems = null, this._tagSrcAttribute = null, this._tag = null
        }
        var a = createjs.extend(AbstractLoader, createjs.EventDispatcher),
            b = AbstractLoader;
        b.POST = "POST", b.GET = "GET", b.BINARY = "binary", b.CSS = "css", b.IMAGE = "image", b.JAVASCRIPT = "javascript", b.JSON = "json", b.JSONP = "jsonp", b.MANIFEST = "manifest", b.SOUND = "sound", b.VIDEO = "video", b.SPRITESHEET = "spritesheet", b.SVG = "svg", b.TEXT = "text", b.XML = "xml", a.getItem = function() {
            return this._item
        }, a.getResult = function(a) {
            return a ? this._rawResult : this._result
        }, a.getTag = function() {
            return this._tag
        }, a.setTag = function(a) {
            this._tag = a
        }, a.load = function() {
            this._createRequest(), this._request.on("complete", this, this), this._request.on("progress", this, this), this._request.on("loadStart", this, this), this._request.on("abort", this, this), this._request.on("timeout", this, this), this._request.on("error", this, this);
            var a = new createjs.Event("initialize");
            a.loader = this._request, this.dispatchEvent(a), this._request.load()
        }, a.cancel = function() {
            this.canceled = !0, this.destroy()
        }, a.destroy = function() {
            this._request && (this._request.removeAllEventListeners(), this._request.destroy()), this._request = null, this._item = null, this._rawResult = null, this._result = null, this._loadItems = null, this.removeAllEventListeners()
        }, a.getLoadedItems = function() {
            return this._loadedItems
        }, a._createRequest = function() {
            this._request = this._preferXHR ? new createjs.XHRRequest(this._item) : new createjs.TagRequest(this._item, this._tag || this._createTag(), this._tagSrcAttribute)
        }, a._createTag = function() {
            return null
        }, a._sendLoadStart = function() {
            this._isCanceled() || this.dispatchEvent("loadstart")
        }, a._sendProgress = function(a) {
            if (!this._isCanceled()) {
                var b = null;
                "number" == typeof a ? (this.progress = a, b = new createjs.ProgressEvent(this.progress)) : (b = a, this.progress = a.loaded / a.total, b.progress = this.progress, (isNaN(this.progress) || 1 / 0 == this.progress) && (this.progress = 0)), this.hasEventListener("progress") && this.dispatchEvent(b)
            }
        }, a._sendComplete = function() {
            if (!this._isCanceled()) {
                this.loaded = !0;
                var a = new createjs.Event("complete");
                a.rawResult = this._rawResult, null != this._result && (a.result = this._result), this.dispatchEvent(a)
            }
        }, a._sendError = function(a) {
            !this._isCanceled() && this.hasEventListener("error") && (null == a && (a = new createjs.ErrorEvent("PRELOAD_ERROR_EMPTY")), this.dispatchEvent(a))
        }, a._isCanceled = function() {
            return null == window.createjs || this.canceled ? !0 : !1
        }, a.resultFormatter = null, a.handleEvent = function(a) {
            switch (a.type) {
                case "complete":
                    this._rawResult = a.target._response;
                    var b = this.resultFormatter && this.resultFormatter(this);
                    b instanceof Function ? b.call(this, createjs.proxy(this._resultFormatSuccess, this), createjs.proxy(this._resultFormatFailed, this)) : (this._result = b || this._rawResult, this._sendComplete());
                    break;
                case "progress":
                    this._sendProgress(a);
                    break;
                case "error":
                    this._sendError(a);
                    break;
                case "loadstart":
                    this._sendLoadStart();
                    break;
                case "abort":
                case "timeout":
                    this._isCanceled() || this.dispatchEvent(new createjs.ErrorEvent("PRELOAD_" + a.type.toUpperCase() + "_ERROR"))
            }
        }, a._resultFormatSuccess = function(a) {
            this._result = a, this._sendComplete()
        }, a._resultFormatFailed = function(a) {
            this._sendError(a)
        }, a.buildPath = function(a, b) {
            return createjs.RequestUtils.buildPath(a, b)
        }, a.toString = function() {
            return "[PreloadJS AbstractLoader]"
        }, createjs.AbstractLoader = createjs.promote(AbstractLoader, "EventDispatcher")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function AbstractMediaLoader(a, b, c) {
            this.AbstractLoader_constructor(a, b, c), this.resultFormatter = this._formatResult, this._tagSrcAttribute = "src", this.on("initialize", this._updateXHR, this)
        }
        var a = createjs.extend(AbstractMediaLoader, createjs.AbstractLoader);
        a.load = function() {
            this._tag || (this._tag = this._createTag(this._item.src)), this._tag.preload = "auto", this._tag.load(), this.AbstractLoader_load()
        }, a._createTag = function() {}, a._createRequest = function() {
            this._request = this._preferXHR ? new createjs.XHRRequest(this._item) : new createjs.MediaTagRequest(this._item, this._tag || this._createTag(), this._tagSrcAttribute)
        }, a._updateXHR = function(a) {
            a.loader.setResponseType && a.loader.setResponseType("blob")
        }, a._formatResult = function(a) {
            if (this._tag.removeEventListener && this._tag.removeEventListener("canplaythrough", this._loadedHandler), this._tag.onstalled = null, this._preferXHR) {
                var b = window.URL || window.webkitURL,
                    c = a.getResult(!0);
                a.getTag().src = b.createObjectURL(c)
            }
            return a.getTag()
        }, createjs.AbstractMediaLoader = createjs.promote(AbstractMediaLoader, "AbstractLoader")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";
        var AbstractRequest = function(a) {
                this._item = a
            },
            a = createjs.extend(AbstractRequest, createjs.EventDispatcher);
        a.load = function() {}, a.destroy = function() {}, a.cancel = function() {}, createjs.AbstractRequest = createjs.promote(AbstractRequest, "EventDispatcher")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function TagRequest(a, b, c) {
            this.AbstractRequest_constructor(a), this._tag = b, this._tagSrcAttribute = c, this._loadedHandler = createjs.proxy(this._handleTagComplete, this), this._addedToDOM = !1, this._startTagVisibility = null
        }
        var a = createjs.extend(TagRequest, createjs.AbstractRequest);
        a.load = function() {
            this._tag.onload = createjs.proxy(this._handleTagComplete, this), this._tag.onreadystatechange = createjs.proxy(this._handleReadyStateChange, this), this._tag.onerror = createjs.proxy(this._handleError, this);
            var a = new createjs.Event("initialize");
            a.loader = this._tag, this.dispatchEvent(a), this._hideTag(), this._loadTimeout = setTimeout(createjs.proxy(this._handleTimeout, this), this._item.loadTimeout), this._tag[this._tagSrcAttribute] = this._item.src, null == this._tag.parentNode && (window.document.body.appendChild(this._tag), this._addedToDOM = !0)
        }, a.destroy = function() {
            this._clean(), this._tag = null, this.AbstractRequest_destroy()
        }, a._handleReadyStateChange = function() {
            clearTimeout(this._loadTimeout);
            var a = this._tag;
            ("loaded" == a.readyState || "complete" == a.readyState) && this._handleTagComplete()
        }, a._handleError = function() {
            this._clean(), this.dispatchEvent("error")
        }, a._handleTagComplete = function() {
            this._rawResult = this._tag, this._result = this.resultFormatter && this.resultFormatter(this) || this._rawResult, this._clean(), this._showTag(), this.dispatchEvent("complete")
        }, a._handleTimeout = function() {
            this._clean(), this.dispatchEvent(new createjs.Event("timeout"))
        }, a._clean = function() {
            this._tag.onload = null, this._tag.onreadystatechange = null, this._tag.onerror = null, this._addedToDOM && null != this._tag.parentNode && this._tag.parentNode.removeChild(this._tag), clearTimeout(this._loadTimeout)
        }, a._hideTag = function() {
            this._startTagVisibility = this._tag.style.visibility, this._tag.style.visibility = "hidden"
        }, a._showTag = function() {
            this._tag.style.visibility = this._startTagVisibility
        }, a._handleStalled = function() {}, createjs.TagRequest = createjs.promote(TagRequest, "AbstractRequest")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function MediaTagRequest(a, b, c) {
            this.AbstractRequest_constructor(a), this._tag = b, this._tagSrcAttribute = c, this._loadedHandler = createjs.proxy(this._handleTagComplete, this)
        }
        var a = createjs.extend(MediaTagRequest, createjs.TagRequest);
        a.load = function() {
            var a = createjs.proxy(this._handleStalled, this);
            this._stalledCallback = a;
            var b = createjs.proxy(this._handleProgress, this);
            this._handleProgress = b, this._tag.addEventListener("stalled", a), this._tag.addEventListener("progress", b), this._tag.addEventListener && this._tag.addEventListener("canplaythrough", this._loadedHandler, !1), this.TagRequest_load()
        }, a._handleReadyStateChange = function() {
            clearTimeout(this._loadTimeout);
            var a = this._tag;
            ("loaded" == a.readyState || "complete" == a.readyState) && this._handleTagComplete()
        }, a._handleStalled = function() {}, a._handleProgress = function(a) {
            if (a && !(a.loaded > 0 && 0 == a.total)) {
                var b = new createjs.ProgressEvent(a.loaded, a.total);
                this.dispatchEvent(b)
            }
        }, a._clean = function() {
            this._tag.removeEventListener && this._tag.removeEventListener("canplaythrough", this._loadedHandler), this._tag.removeEventListener("stalled", this._stalledCallback), this._tag.removeEventListener("progress", this._progressCallback), this.TagRequest__clean()
        }, createjs.MediaTagRequest = createjs.promote(MediaTagRequest, "TagRequest")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function XHRRequest(a) {
            this.AbstractRequest_constructor(a), this._request = null, this._loadTimeout = null, this._xhrLevel = 1, this._response = null, this._rawResponse = null, this._canceled = !1, this._handleLoadStartProxy = createjs.proxy(this._handleLoadStart, this), this._handleProgressProxy = createjs.proxy(this._handleProgress, this), this._handleAbortProxy = createjs.proxy(this._handleAbort, this), this._handleErrorProxy = createjs.proxy(this._handleError, this), this._handleTimeoutProxy = createjs.proxy(this._handleTimeout, this), this._handleLoadProxy = createjs.proxy(this._handleLoad, this), this._handleReadyStateChangeProxy = createjs.proxy(this._handleReadyStateChange, this), !this._createXHR(a)
        }
        var a = createjs.extend(XHRRequest, createjs.AbstractRequest);
        XHRRequest.ACTIVEX_VERSIONS = ["Msxml2.XMLHTTP.6.0", "Msxml2.XMLHTTP.5.0", "Msxml2.XMLHTTP.4.0", "MSXML2.XMLHTTP.3.0", "MSXML2.XMLHTTP", "Microsoft.XMLHTTP"], a.getResult = function(a) {
            return a && this._rawResponse ? this._rawResponse : this._response
        }, a.cancel = function() {
            this.canceled = !0, this._clean(), this._request.abort()
        }, a.load = function() {
            if (null == this._request) return void this._handleError();
            null != this._request.addEventListener ? (this._request.addEventListener("loadstart", this._handleLoadStartProxy, !1), this._request.addEventListener("progress", this._handleProgressProxy, !1), this._request.addEventListener("abort", this._handleAbortProxy, !1), this._request.addEventListener("error", this._handleErrorProxy, !1), this._request.addEventListener("timeout", this._handleTimeoutProxy, !1), this._request.addEventListener("load", this._handleLoadProxy, !1), this._request.addEventListener("readystatechange", this._handleReadyStateChangeProxy, !1)) : (this._request.onloadstart = this._handleLoadStartProxy, this._request.onprogress = this._handleProgressProxy, this._request.onabort = this._handleAbortProxy, this._request.onerror = this._handleErrorProxy, this._request.ontimeout = this._handleTimeoutProxy, this._request.onload = this._handleLoadProxy, this._request.onreadystatechange = this._handleReadyStateChangeProxy), 1 == this._xhrLevel && (this._loadTimeout = setTimeout(createjs.proxy(this._handleTimeout, this), this._item.loadTimeout));
            try {
                this._item.values && this._item.method != createjs.AbstractLoader.GET ? this._item.method == createjs.AbstractLoader.POST && this._request.send(createjs.RequestUtils.formatQueryString(this._item.values)) : this._request.send()
            } catch (a) {
                this.dispatchEvent(new createjs.ErrorEvent("XHR_SEND", null, a))
            }
        }, a.setResponseType = function(a) {
            "blob" === a && (a = window.URL ? "blob" : "arraybuffer", this._responseType = a), this._request.responseType = a
        }, a.getAllResponseHeaders = function() {
            return this._request.getAllResponseHeaders instanceof Function ? this._request.getAllResponseHeaders() : null
        }, a.getResponseHeader = function(a) {
            return this._request.getResponseHeader instanceof Function ? this._request.getResponseHeader(a) : null
        }, a._handleProgress = function(a) {
            if (a && !(a.loaded > 0 && 0 == a.total)) {
                var b = new createjs.ProgressEvent(a.loaded, a.total);
                this.dispatchEvent(b)
            }
        }, a._handleLoadStart = function() {
            clearTimeout(this._loadTimeout), this.dispatchEvent("loadstart")
        }, a._handleAbort = function(a) {
            this._clean(), this.dispatchEvent(new createjs.ErrorEvent("XHR_ABORTED", null, a))
        }, a._handleError = function(a) {
            this._clean(), this.dispatchEvent(new createjs.ErrorEvent(a.message))
        }, a._handleReadyStateChange = function() {
            4 == this._request.readyState && this._handleLoad()
        }, a._handleLoad = function() {
            if (!this.loaded) {
                this.loaded = !0;
                var a = this._checkError();
                if (a) return void this._handleError(a);
                if (this._response = this._getResponse(), "arraybuffer" === this._responseType) try {
                    this._response = new Blob([this._response])
                } catch (b) {
                    if (window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder, "TypeError" === b.name && window.BlobBuilder) {
                        var c = new BlobBuilder;
                        c.append(this._response), this._response = c.getBlob()
                    }
                }
                this._clean(), this.dispatchEvent(new createjs.Event("complete"))
            }
        }, a._handleTimeout = function(a) {
            this._clean(), this.dispatchEvent(new createjs.ErrorEvent("PRELOAD_TIMEOUT", null, a))
        }, a._checkError = function() {
            var a = parseInt(this._request.status);
            switch (a) {
                case 404:
                case 0:
                    return new Error(a)
            }
            return null
        }, a._getResponse = function() {
            if (null != this._response) return this._response;
            if (null != this._request.response) return this._request.response;
            try {
                if (null != this._request.responseText) return this._request.responseText
            } catch (a) {}
            try {
                if (null != this._request.responseXML) return this._request.responseXML
            } catch (a) {}
            return null
        }, a._createXHR = function(a) {
            var b = createjs.RequestUtils.isCrossDomain(a),
                c = {},
                d = null;
            if (window.XMLHttpRequest) d = new XMLHttpRequest, b && void 0 === d.withCredentials && window.XDomainRequest && (d = new XDomainRequest);
            else {
                for (var e = 0, f = s.ACTIVEX_VERSIONS.length; f > e; e++) {
                    var g = s.ACTIVEX_VERSIONS[e];
                    try {
                        d = new ActiveXObject(g);
                        break
                    } catch (h) {}
                }
                if (null == d) return !1
            }
            null == a.mimeType && createjs.RequestUtils.isText(a.type) && (a.mimeType = "text/plain; charset=utf-8"), a.mimeType && d.overrideMimeType && d.overrideMimeType(a.mimeType), this._xhrLevel = "string" == typeof d.responseType ? 2 : 1;
            var i = null;
            if (i = a.method == createjs.AbstractLoader.GET ? createjs.RequestUtils.buildPath(a.src, a.values) : a.src, d.open(a.method || createjs.AbstractLoader.GET, i, !0), b && d instanceof XMLHttpRequest && 1 == this._xhrLevel && (c.Origin = location.origin), a.values && a.method == createjs.AbstractLoader.POST && (c["Content-Type"] = "application/x-www-form-urlencoded"), b || c["X-Requested-With"] || (c["X-Requested-With"] = "XMLHttpRequest"), a.headers)
                for (var j in a.headers) c[j] = a.headers[j];
            for (j in c) d.setRequestHeader(j, c[j]);
            return d instanceof XMLHttpRequest && void 0 !== a.withCredentials && (d.withCredentials = a.withCredentials), this._request = d, !0
        }, a._clean = function() {
            clearTimeout(this._loadTimeout), null != this._request.removeEventListener ? (this._request.removeEventListener("loadstart", this._handleLoadStartProxy), this._request.removeEventListener("progress", this._handleProgressProxy), this._request.removeEventListener("abort", this._handleAbortProxy), this._request.removeEventListener("error", this._handleErrorProxy), this._request.removeEventListener("timeout", this._handleTimeoutProxy), this._request.removeEventListener("load", this._handleLoadProxy), this._request.removeEventListener("readystatechange", this._handleReadyStateChangeProxy)) : (this._request.onloadstart = null, this._request.onprogress = null, this._request.onabort = null, this._request.onerror = null, this._request.ontimeout = null, this._request.onload = null, this._request.onreadystatechange = null)
        }, a.toString = function() {
            return "[PreloadJS XHRRequest]"
        }, createjs.XHRRequest = createjs.promote(XHRRequest, "AbstractRequest")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function LoadQueue(a, b, c) {
            this.AbstractLoader_constructor(), this._plugins = [], this._typeCallbacks = {}, this._extensionCallbacks = {}, this.next = null, this.maintainScriptOrder = !0, this.stopOnError = !1, this._maxConnections = 1, this._availableLoaders = [createjs.ImageLoader, createjs.JavaScriptLoader, createjs.CSSLoader, createjs.JSONLoader, createjs.JSONPLoader, createjs.SoundLoader, createjs.ManifestLoader, createjs.SpriteSheetLoader, createjs.XMLLoader, createjs.SVGLoader, createjs.BinaryLoader, createjs.VideoLoader, createjs.TextLoader], this._defaultLoaderLength = this._availableLoaders.length, this.init(a, b, c)
        }
        var a = createjs.extend(LoadQueue, createjs.AbstractLoader),
            b = LoadQueue;
        a.init = function(a, b, c) {
            this.useXHR = !0, this.preferXHR = !0, this._preferXHR = !0, this.setPreferXHR(a), this._paused = !1, this._basePath = b, this._crossOrigin = c, this._loadStartWasDispatched = !1, this._currentlyLoadingScript = null, this._currentLoads = [], this._loadQueue = [], this._loadQueueBackup = [], this._loadItemsById = {}, this._loadItemsBySrc = {}, this._loadedResults = {}, this._loadedRawResults = {}, this._numItems = 0, this._numItemsLoaded = 0, this._scriptOrder = [], this._loadedScripts = [], this._lastProgress = 0 / 0
        }, b.loadTimeout = 8e3, b.LOAD_TIMEOUT = 0, b.BINARY = createjs.AbstractLoader.BINARY, b.CSS = createjs.AbstractLoader.CSS, b.IMAGE = createjs.AbstractLoader.IMAGE, b.JAVASCRIPT = createjs.AbstractLoader.JAVASCRIPT, b.JSON = createjs.AbstractLoader.JSON, b.JSONP = createjs.AbstractLoader.JSONP, b.MANIFEST = createjs.AbstractLoader.MANIFEST, b.SOUND = createjs.AbstractLoader.SOUND, b.VIDEO = createjs.AbstractLoader.VIDEO, b.SVG = createjs.AbstractLoader.SVG, b.TEXT = createjs.AbstractLoader.TEXT, b.XML = createjs.AbstractLoader.XML, b.POST = createjs.AbstractLoader.POST, b.GET = createjs.AbstractLoader.GET, a.registerLoader = function(a) {
            if (!a || !a.canLoadItem) throw new Error("loader is of an incorrect type.");
            if (-1 != this._availableLoaders.indexOf(a)) throw new Error("loader already exists.");
            this._availableLoaders.unshift(a)
        }, a.unregisterLoader = function(a) {
            var b = this._availableLoaders.indexOf(a); - 1 != b && b < this._defaultLoaderLength - 1 && this._availableLoaders.splice(b, 1)
        }, a.setUseXHR = function(a) {
            return this.setPreferXHR(a)
        }, a.setPreferXHR = function(a) {
            return this.preferXHR = 0 != a && null != window.XMLHttpRequest, this.preferXHR
        }, a.removeAll = function() {
            this.remove()
        }, a.remove = function(a) {
            var b = null;
            if (a && !Array.isArray(a)) b = [a];
            else if (a) b = a;
            else if (arguments.length > 0) return;
            var c = !1;
            if (b) {
                for (; b.length;) {
                    var d = b.pop(),
                        e = this.getResult(d);
                    for (f = this._loadQueue.length - 1; f >= 0; f--)
                        if (g = this._loadQueue[f].getItem(), g.id == d || g.src == d) {
                            this._loadQueue.splice(f, 1)[0].cancel();
                            break
                        }
                    for (f = this._loadQueueBackup.length - 1; f >= 0; f--)
                        if (g = this._loadQueueBackup[f].getItem(), g.id == d || g.src == d) {
                            this._loadQueueBackup.splice(f, 1)[0].cancel();
                            break
                        }
                    if (e) this._disposeItem(this.getItem(d));
                    else
                        for (var f = this._currentLoads.length - 1; f >= 0; f--) {
                            var g = this._currentLoads[f].getItem();
                            if (g.id == d || g.src == d) {
                                this._currentLoads.splice(f, 1)[0].cancel(), c = !0;
                                break
                            }
                        }
                }
                c && this._loadNext()
            } else {
                this.close();
                for (var h in this._loadItemsById) this._disposeItem(this._loadItemsById[h]);
                this.init(this.preferXHR, this._basePath)
            }
        }, a.reset = function() {
            this.close();
            for (var a in this._loadItemsById) this._disposeItem(this._loadItemsById[a]);
            for (var b = [], c = 0, d = this._loadQueueBackup.length; d > c; c++) b.push(this._loadQueueBackup[c].getItem());
            this.loadManifest(b, !1)
        }, a.installPlugin = function(a) {
            if (null != a && null != a.getPreloadHandlers) {
                this._plugins.push(a);
                var b = a.getPreloadHandlers();
                if (b.scope = a, null != b.types)
                    for (var c = 0, d = b.types.length; d > c; c++) this._typeCallbacks[b.types[c]] = b;
                if (null != b.extensions)
                    for (c = 0, d = b.extensions.length; d > c; c++) this._extensionCallbacks[b.extensions[c]] = b
            }
        }, a.setMaxConnections = function(a) {
            this._maxConnections = a, !this._paused && this._loadQueue.length > 0 && this._loadNext()
        }, a.loadFile = function(a, b, c) {
            if (null == a) {
                var d = new createjs.ErrorEvent("PRELOAD_NO_FILE");
                return void this._sendError(d)
            }
            this._addItem(a, null, c), this.setPaused(b !== !1 ? !1 : !0)
        }, a.loadManifest = function(a, c, d) {
            var e = null,
                f = null;
            if (Array.isArray(a)) {
                if (0 == a.length) {
                    var g = new createjs.ErrorEvent("PRELOAD_MANIFEST_EMPTY");
                    return void this._sendError(g)
                }
                e = a
            } else if ("string" == typeof a) e = [{
                src: a,
                type: b.MANIFEST
            }];
            else {
                if ("object" != typeof a) {
                    var g = new createjs.ErrorEvent("PRELOAD_MANIFEST_NULL");
                    return void this._sendError(g)
                }
                if (void 0 !== a.src) {
                    if (null == a.type) a.type = b.MANIFEST;
                    else if (a.type != b.MANIFEST) {
                        var g = new createjs.ErrorEvent("PRELOAD_MANIFEST_TYPE");
                        this._sendError(g)
                    }
                    e = [a]
                } else void 0 !== a.manifest && (e = a.manifest, f = a.path)
            }
            for (var h = 0, i = e.length; i > h; h++) this._addItem(e[h], f, d);
            this.setPaused(c !== !1 ? !1 : !0)
        }, a.load = function() {
            this.setPaused(!1)
        }, a.getItem = function(a) {
            return this._loadItemsById[a] || this._loadItemsBySrc[a]
        }, a.getResult = function(a, b) {
            var c = this._loadItemsById[a] || this._loadItemsBySrc[a];
            if (null == c) return null;
            var d = c.id;
            return b && this._loadedRawResults[d] ? this._loadedRawResults[d] : this._loadedResults[d]
        }, a.getItems = function(a) {
            var b = [];
            for (var c in this._loadItemsById) {
                var d = this._loadItemsById[c],
                    e = this.getResult(c);
                (a !== !0 || null != e) && b.push({
                    item: d,
                    result: e,
                    rawResult: this.getResult(c, !0)
                })
            }
            return b
        }, a.setPaused = function(a) {
            this._paused = a, this._paused || this._loadNext()
        }, a.close = function() {
            for (; this._currentLoads.length;) this._currentLoads.pop().cancel();
            this._scriptOrder.length = 0, this._loadedScripts.length = 0, this.loadStartWasDispatched = !1, this._itemCount = 0, this._lastProgress = 0 / 0
        }, a._addItem = function(a, b, c) {
            var d = this._createLoadItem(a, b, c);
            if (null != d) {
                var e = this._createLoader(d);
                null != e && ("plugins" in e && (e.plugins = this._plugins), d._loader = e, this._loadQueue.push(e), this._loadQueueBackup.push(e), this._numItems++, this._updateProgress(), (this.maintainScriptOrder && d.type == createjs.LoadQueue.JAVASCRIPT || d.maintainOrder === !0) && (this._scriptOrder.push(d), this._loadedScripts.push(null)))
            }
        }, a._createLoadItem = function(a, b, c) {
            var d = createjs.LoadItem.create(a);
            if (null == d) return null;
            var e = "",
                f = c || this._basePath;
            if (d.src instanceof Object) {
                if (!d.type) return null;
                if (b) {
                    e = b;
                    var g = createjs.RequestUtils.parseURI(b);
                    null == f || g.absolute || g.relative || (e = f + e)
                } else null != f && (e = f)
            } else {
                var h = createjs.RequestUtils.parseURI(d.src);
                h.extension && (d.ext = h.extension), null == d.type && (d.type = createjs.RequestUtils.getTypeByExtension(d.ext));
                var i = d.src;
                if (!h.absolute && !h.relative)
                    if (b) {
                        e = b;
                        var g = createjs.RequestUtils.parseURI(b);
                        i = b + i, null == f || g.absolute || g.relative || (e = f + e)
                    } else null != f && (e = f);
                d.src = e + d.src
            }
            d.path = e, (void 0 === d.id || null === d.id || "" === d.id) && (d.id = i);
            var j = this._typeCallbacks[d.type] || this._extensionCallbacks[d.ext];
            if (j) {
                var k = j.callback.call(j.scope, d, this);
                if (k === !1) return null;
                k === !0 || null != k && (d._loader = k), h = createjs.RequestUtils.parseURI(d.src), null != h.extension && (d.ext = h.extension)
            }
            return this._loadItemsById[d.id] = d, this._loadItemsBySrc[d.src] = d, null == d.crossOrigin && (d.crossOrigin = this._crossOrigin), d
        }, a._createLoader = function(a) {
            if (null != a._loader) return a._loader;
            for (var b = this.preferXHR, c = 0; c < this._availableLoaders.length; c++) {
                var d = this._availableLoaders[c];
                if (d && d.canLoadItem(a)) return new d(a, b)
            }
            return null
        }, a._loadNext = function() {
            if (!this._paused) {
                this._loadStartWasDispatched || (this._sendLoadStart(), this._loadStartWasDispatched = !0), this._numItems == this._numItemsLoaded ? (this.loaded = !0, this._sendComplete(), this.next && this.next.load && this.next.load()) : this.loaded = !1;
                for (var a = 0; a < this._loadQueue.length && !(this._currentLoads.length >= this._maxConnections); a++) {
                    var b = this._loadQueue[a];
                    this._canStartLoad(b) && (this._loadQueue.splice(a, 1), a--, this._loadItem(b))
                }
            }
        }, a._loadItem = function(a) {
            a.on("fileload", this._handleFileLoad, this), a.on("progress", this._handleProgress, this), a.on("complete", this._handleFileComplete, this), a.on("error", this._handleError, this), a.on("fileerror", this._handleFileError, this), this._currentLoads.push(a), this._sendFileStart(a.getItem()), a.load()
        }, a._handleFileLoad = function(a) {
            a.target = null, this.dispatchEvent(a)
        }, a._handleFileError = function(a) {
            var b = new createjs.ErrorEvent("FILE_LOAD_ERROR", null, a.item);
            this._sendError(b)
        }, a._handleError = function(a) {
            var b = a.target;
            this._numItemsLoaded++, this._finishOrderedItem(b, !0), this._updateProgress();
            var c = new createjs.ErrorEvent("FILE_LOAD_ERROR", null, b.getItem());
            this._sendError(c), this.stopOnError ? this.setPaused(!0) : (this._removeLoadItem(b), this._cleanLoadItem(b), this._loadNext())
        }, a._handleFileComplete = function(a) {
            var b = a.target,
                c = b.getItem(),
                d = b.getResult();
            this._loadedResults[c.id] = d;
            var e = b.getResult(!0);
            null != e && e !== d && (this._loadedRawResults[c.id] = e), this._saveLoadedItems(b), this._removeLoadItem(b), this._finishOrderedItem(b) || this._processFinishedLoad(c, b), this._cleanLoadItem(b)
        }, a._saveLoadedItems = function(a) {
            var b = a.getLoadedItems();
            if (null !== b)
                for (var c = 0; c < b.length; c++) {
                    var d = b[c].item;
                    this._loadItemsBySrc[d.src] = d, this._loadItemsById[d.id] = d, this._loadedResults[d.id] = b[c].result, this._loadedRawResults[d.id] = b[c].rawResult
                }
        }, a._finishOrderedItem = function(a, b) {
            var c = a.getItem();
            if (this.maintainScriptOrder && c.type == createjs.LoadQueue.JAVASCRIPT || c.maintainOrder) {
                a instanceof createjs.JavaScriptLoader && (this._currentlyLoadingScript = !1);
                var d = createjs.indexOf(this._scriptOrder, c);
                return -1 == d ? !1 : (this._loadedScripts[d] = b === !0 ? !0 : c, this._checkScriptLoadOrder(), !0)
            }
            return !1
        }, a._checkScriptLoadOrder = function() {
            for (var a = this._loadedScripts.length, b = 0; a > b; b++) {
                var c = this._loadedScripts[b];
                if (null === c) break;
                if (c !== !0) {
                    var d = this._loadedResults[c.id];
                    c.type == createjs.LoadQueue.JAVASCRIPT && createjs.DomUtils.appendToHead(d);
                    var e = c._loader;
                    this._processFinishedLoad(c, e), this._loadedScripts[b] = !0
                }
            }
        }, a._processFinishedLoad = function(a, b) {
            if (this._numItemsLoaded++, !this.maintainScriptOrder && a.type == createjs.LoadQueue.JAVASCRIPT) {
                var c = b.getTag();
                createjs.DomUtils.appendToHead(c)
            }
            this._updateProgress(), this._sendFileComplete(a, b), this._loadNext()
        }, a._canStartLoad = function(a) {
            if (!this.maintainScriptOrder || a.preferXHR) return !0;
            var b = a.getItem();
            if (b.type != createjs.LoadQueue.JAVASCRIPT) return !0;
            if (this._currentlyLoadingScript) return !1;
            for (var c = this._scriptOrder.indexOf(b), d = 0; c > d;) {
                var e = this._loadedScripts[d];
                if (null == e) return !1;
                d++
            }
            return this._currentlyLoadingScript = !0, !0
        }, a._removeLoadItem = function(a) {
            for (var b = this._currentLoads.length, c = 0; b > c; c++)
                if (this._currentLoads[c] == a) {
                    this._currentLoads.splice(c, 1);
                    break
                }
        }, a._cleanLoadItem = function(a) {
            var b = a.getItem();
            b && delete b._loader
        }, a._handleProgress = function(a) {
            var b = a.target;
            this._sendFileProgress(b.getItem(), b.progress), this._updateProgress()
        }, a._updateProgress = function() {
            var a = this._numItemsLoaded / this._numItems,
                b = this._numItems - this._numItemsLoaded;
            if (b > 0) {
                for (var c = 0, d = 0, e = this._currentLoads.length; e > d; d++) c += this._currentLoads[d].progress;
                a += c / b * (b / this._numItems)
            }
            this._lastProgress != a && (this._sendProgress(a), this._lastProgress = a)
        }, a._disposeItem = function(a) {
            delete this._loadedResults[a.id], delete this._loadedRawResults[a.id], delete this._loadItemsById[a.id], delete this._loadItemsBySrc[a.src]
        }, a._sendFileProgress = function(a, b) {
            if (!this._isCanceled() && !this._paused && this.hasEventListener("fileprogress")) {
                var c = new createjs.Event("fileprogress");
                c.progress = b, c.loaded = b, c.total = 1, c.item = a, this.dispatchEvent(c)
            }
        }, a._sendFileComplete = function(a, b) {
            if (!this._isCanceled() && !this._paused) {
                var c = new createjs.Event("fileload");
                c.loader = b, c.item = a, c.result = this._loadedResults[a.id], c.rawResult = this._loadedRawResults[a.id], a.completeHandler && a.completeHandler(c), this.hasEventListener("fileload") && this.dispatchEvent(c)
            }
        }, a._sendFileStart = function(a) {
            var b = new createjs.Event("filestart");
            b.item = a, this.hasEventListener("filestart") && this.dispatchEvent(b)
        }, a.toString = function() {
            return "[PreloadJS LoadQueue]"
        }, createjs.LoadQueue = createjs.promote(LoadQueue, "AbstractLoader")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function TextLoader(a) {
            this.AbstractLoader_constructor(a, !0, createjs.AbstractLoader.TEXT)
        }
        var a = (createjs.extend(TextLoader, createjs.AbstractLoader), TextLoader);
        a.canLoadItem = function(a) {
            return a.type == createjs.AbstractLoader.TEXT
        }, createjs.TextLoader = createjs.promote(TextLoader, "AbstractLoader")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function BinaryLoader(a) {
            this.AbstractLoader_constructor(a, !0, createjs.AbstractLoader.BINARY), this.on("initialize", this._updateXHR, this)
        }
        var a = createjs.extend(BinaryLoader, createjs.AbstractLoader),
            b = BinaryLoader;
        b.canLoadItem = function(a) {
            return a.type == createjs.AbstractLoader.BINARY
        }, a._updateXHR = function(a) {
            a.loader.setResponseType("arraybuffer")
        }, createjs.BinaryLoader = createjs.promote(BinaryLoader, "AbstractLoader")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function CSSLoader(a, b) {
            this.AbstractLoader_constructor(a, b, createjs.AbstractLoader.CSS), this.resultFormatter = this._formatResult, this._tagSrcAttribute = "href", this._tag = document.createElement(b ? "style" : "link"), this._tag.rel = "stylesheet", this._tag.type = "text/css"
        }
        var a = createjs.extend(CSSLoader, createjs.AbstractLoader),
            b = CSSLoader;
        b.canLoadItem = function(a) {
            return a.type == createjs.AbstractLoader.CSS
        }, a._formatResult = function(a) {
            if (this._preferXHR) {
                var b = a.getTag();
                if (b.styleSheet) b.styleSheet.cssText = a.getResult(!0);
                else {
                    var c = document.createTextNode(a.getResult(!0));
                    b.appendChild(c)
                }
            } else b = this._tag;
            return createjs.DomUtils.appendToHead(b), b
        }, createjs.CSSLoader = createjs.promote(CSSLoader, "AbstractLoader")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function ImageLoader(a, b) {
            this.AbstractLoader_constructor(a, b, createjs.AbstractLoader.IMAGE), this.resultFormatter = this._formatResult, this._tagSrcAttribute = "src", createjs.RequestUtils.isImageTag(a) ? this._tag = a : createjs.RequestUtils.isImageTag(a.src) ? this._tag = a.src : createjs.RequestUtils.isImageTag(a.tag) && (this._tag = a.tag), null != this._tag ? this._preferXHR = !1 : this._tag = document.createElement("img"), this.on("initialize", this._updateXHR, this)
        }
        var a = createjs.extend(ImageLoader, createjs.AbstractLoader),
            b = ImageLoader;
        b.canLoadItem = function(a) {
            return a.type == createjs.AbstractLoader.IMAGE
        }, a.load = function() {
            if ("" != this._tag.src && this._tag.complete) return void this._sendComplete();
            var a = this._item.crossOrigin;
            1 == a && (a = "Anonymous"), null == a || createjs.RequestUtils.isLocal(this._item.src) || (this._tag.crossOrigin = a), this.AbstractLoader_load()
        }, a._updateXHR = function(a) {
            a.loader.mimeType = "text/plain; charset=x-user-defined-binary", a.loader.setResponseType && a.loader.setResponseType("blob")
        }, a._formatResult = function() {
            return this._formatImage
        }, a._formatImage = function(a, b) {
            var c = this._tag,
                d = window.URL || window.webkitURL;
            if (this._preferXHR)
                if (d) {
                    var e = d.createObjectURL(this.getResult(!0));
                    c.src = e, c.addEventListener("load", this._cleanUpURL, !1), c.addEventListener("error", this._cleanUpURL, !1)
                } else c.src = this._item.src;
            else;
            c.complete ? a(c) : (c.onload = createjs.proxy(function() {
                a(this._tag)
            }, this), c.onerror = createjs.proxy(function() {
                b(_this._tag)
            }, this))
        }, a._cleanUpURL = function(a) {
            var b = window.URL || window.webkitURL;
            b.revokeObjectURL(a.target.src)
        }, createjs.ImageLoader = createjs.promote(ImageLoader, "AbstractLoader")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function JavaScriptLoader(a, b) {
            this.AbstractLoader_constructor(a, b, createjs.AbstractLoader.JAVASCRIPT), this.resultFormatter = this._formatResult, this._tagSrcAttribute = "src", this.setTag(document.createElement("script"))
        }
        var a = createjs.extend(JavaScriptLoader, createjs.AbstractLoader),
            b = JavaScriptLoader;
        b.canLoadItem = function(a) {
            return a.type == createjs.AbstractLoader.JAVASCRIPT
        }, a._formatResult = function(a) {
            var b = a.getTag();
            return this._preferXHR && (b.text = a.getResult(!0)), b
        }, createjs.JavaScriptLoader = createjs.promote(JavaScriptLoader, "AbstractLoader")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function JSONLoader(a) {
            this.AbstractLoader_constructor(a, !0, createjs.AbstractLoader.JSON), this.resultFormatter = this._formatResult
        }
        var a = createjs.extend(JSONLoader, createjs.AbstractLoader),
            b = JSONLoader;
        b.canLoadItem = function(a) {
            return a.type == createjs.AbstractLoader.JSON
        }, a._formatResult = function(a) {
            var b = null;
            try {
                b = createjs.DataUtils.parseJSON(a.getResult(!0))
            } catch (c) {
                var d = new createjs.ErrorEvent("JSON_FORMAT", null, c);
                return this._sendError(d), c
            }
            return b
        }, createjs.JSONLoader = createjs.promote(JSONLoader, "AbstractLoader")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function JSONPLoader(a) {
            this.AbstractLoader_constructor(a, !1, createjs.AbstractLoader.JSONP), this.setTag(document.createElement("script")), this.getTag().type = "text/javascript"
        }
        var a = createjs.extend(JSONPLoader, createjs.AbstractLoader),
            b = JSONPLoader;
        b.canLoadItem = function(a) {
            return a.type == createjs.AbstractLoader.JSONP
        }, a.cancel = function() {
            this.AbstractLoader_cancel(), this._dispose()
        }, a.load = function() {
            if (null == this._item.callback) throw new Error("callback is required for loading JSONP requests.");
            if (null != window[this._item.callback]) throw new Error("JSONP callback '" + this._item.callback + "' already exists on window. You need to specify a different callback or re-name the current one.");
            window[this._item.callback] = createjs.proxy(this._handleLoad, this), window.document.body.appendChild(this._tag), this._loadTimeout = setTimeout(createjs.proxy(this._handleTimeout, this), this._item.loadTimeout), this._tag.src = this._item.src
        }, a._handleLoad = function(a) {
            this._result = this._rawResult = a, this._sendComplete(), this._dispose()
        }, a._handleTimeout = function() {
            this._dispose(), this.dispatchEvent(new createjs.ErrorEvent("timeout"))
        }, a._dispose = function() {
            window.document.body.removeChild(this._tag), delete window[this._item.callback], clearTimeout(this._loadTimeout)
        }, createjs.JSONPLoader = createjs.promote(JSONPLoader, "AbstractLoader")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function ManifestLoader(a) {
            this.AbstractLoader_constructor(a, null, createjs.AbstractLoader.MANIFEST), this.plugins = null, this._manifestQueue = null
        }
        var a = createjs.extend(ManifestLoader, createjs.AbstractLoader),
            b = ManifestLoader;
        b.MANIFEST_PROGRESS = .25, b.canLoadItem = function(a) {
            return a.type == createjs.AbstractLoader.MANIFEST
        }, a.load = function() {
            this.AbstractLoader_load()
        }, a._createRequest = function() {
            var a = this._item.callback;
            this._request = null != a ? new createjs.JSONPLoader(this._item) : new createjs.JSONLoader(this._item)
        }, a.handleEvent = function(a) {
            switch (a.type) {
                case "complete":
                    return this._rawResult = a.target.getResult(!0), this._result = a.target.getResult(), this._sendProgress(b.MANIFEST_PROGRESS), void this._loadManifest(this._result);
                case "progress":
                    return a.loaded *= b.MANIFEST_PROGRESS, this.progress = a.loaded / a.total, (isNaN(this.progress) || 1 / 0 == this.progress) && (this.progress = 0), void this._sendProgress(a)
            }
            this.AbstractLoader_handleEvent(a)
        }, a.destroy = function() {
            this.AbstractLoader_destroy(), this._manifestQueue.close()
        }, a._loadManifest = function(a) {
            if (a && a.manifest) {
                var b = this._manifestQueue = new createjs.LoadQueue;
                b.on("fileload", this._handleManifestFileLoad, this), b.on("progress", this._handleManifestProgress, this), b.on("complete", this._handleManifestComplete, this, !0), b.on("error", this._handleManifestError, this, !0);
                for (var c = 0, d = this.plugins.length; d > c; c++) b.installPlugin(this.plugins[c]);
                b.loadManifest(a)
            } else this._sendComplete()
        }, a._handleManifestFileLoad = function(a) {
            a.target = null, this.dispatchEvent(a)
        }, a._handleManifestComplete = function() {
            this._loadedItems = this._manifestQueue.getItems(!0), this._sendComplete()
        }, a._handleManifestProgress = function(a) {
            this.progress = a.progress * (1 - b.MANIFEST_PROGRESS) + b.MANIFEST_PROGRESS, this._sendProgress(this.progress)
        }, a._handleManifestError = function(a) {
            var b = new createjs.Event("fileerror");
            b.item = a.data, this.dispatchEvent(b)
        }, createjs.ManifestLoader = createjs.promote(ManifestLoader, "AbstractLoader")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function SoundLoader(a, b) {
            this.AbstractMediaLoader_constructor(a, b, createjs.AbstractLoader.SOUND), createjs.RequestUtils.isAudioTag(a) ? this._tag = a : createjs.RequestUtils.isAudioTag(a.src) ? this._tag = a : createjs.RequestUtils.isAudioTag(a.tag) && (this._tag = createjs.RequestUtils.isAudioTag(a) ? a : a.src), null != this._tag && (this._preferXHR = !1)
        }
        var a = createjs.extend(SoundLoader, createjs.AbstractMediaLoader),
            b = SoundLoader;
        b.canLoadItem = function(a) {
            return a.type == createjs.AbstractLoader.SOUND
        }, a._createTag = function(a) {
            var b = document.createElement("audio");
            return b.autoplay = !1, b.preload = "none", b.src = a, b
        }, createjs.SoundLoader = createjs.promote(SoundLoader, "AbstractMediaLoader")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function VideoLoader(a, b) {
            this.AbstractMediaLoader_constructor(a, b, createjs.AbstractLoader.VIDEO), createjs.RequestUtils.isVideoTag(a) || createjs.RequestUtils.isVideoTag(a.src) ? (this.setTag(createjs.RequestUtils.isVideoTag(a) ? a : a.src), this._preferXHR = !1) : this.setTag(this._createTag())
        }
        var a = createjs.extend(VideoLoader, createjs.AbstractMediaLoader),
            b = VideoLoader;
        a._createTag = function() {
            return document.createElement("video")
        }, b.canLoadItem = function(a) {
            return a.type == createjs.AbstractLoader.VIDEO
        }, createjs.VideoLoader = createjs.promote(VideoLoader, "AbstractMediaLoader")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function SpriteSheetLoader(a, b) {
            this.AbstractLoader_constructor(a, b, createjs.AbstractLoader.SPRITESHEET), this._manifestQueue = null
        }
        var a = createjs.extend(SpriteSheetLoader, createjs.AbstractLoader),
            b = SpriteSheetLoader;
        b.SPRITESHEET_PROGRESS = .25, b.canLoadItem = function(a) {
            return a.type == createjs.AbstractLoader.SPRITESHEET
        }, a.destroy = function() {
            this.AbstractLoader_destroy, this._manifestQueue.close()
        }, a._createRequest = function() {
            var a = this._item.callback;
            this._request = null != a ? new createjs.JSONPLoader(this._item) : new createjs.JSONLoader(this._item)
        }, a.handleEvent = function(a) {
            switch (a.type) {
                case "complete":
                    return this._rawResult = a.target.getResult(!0), this._result = a.target.getResult(), this._sendProgress(b.SPRITESHEET_PROGRESS), void this._loadManifest(this._result);
                case "progress":
                    return a.loaded *= b.SPRITESHEET_PROGRESS, this.progress = a.loaded / a.total, (isNaN(this.progress) || 1 / 0 == this.progress) && (this.progress = 0), void this._sendProgress(a)
            }
            this.AbstractLoader_handleEvent(a)
        }, a._loadManifest = function(a) {
            if (a && a.images) {
                var b = this._manifestQueue = new createjs.LoadQueue(this._preferXHR, this._item.path, this._item.crossOrigin);
                b.on("complete", this._handleManifestComplete, this, !0), b.on("fileload", this._handleManifestFileLoad, this), b.on("progress", this._handleManifestProgress, this), b.on("error", this._handleManifestError, this, !0), b.loadManifest(a.images)
            }
        }, a._handleManifestFileLoad = function(a) {
            var b = a.result;
            if (null != b) {
                var c = this.getResult().images,
                    d = c.indexOf(a.item.src);
                c[d] = b
            }
        }, a._handleManifestComplete = function() {
            this._result = new createjs.SpriteSheet(this._result), this._loadedItems = this._manifestQueue.getItems(!0), this._sendComplete()
        }, a._handleManifestProgress = function(a) {
            this.progress = a.progress * (1 - b.SPRITESHEET_PROGRESS) + b.SPRITESHEET_PROGRESS, this._sendProgress(this.progress)
        }, a._handleManifestError = function(a) {
            var b = new createjs.Event("fileerror");
            b.item = a.data, this.dispatchEvent(b)
        }, createjs.SpriteSheetLoader = createjs.promote(SpriteSheetLoader, "AbstractLoader")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function SVGLoader(a, b) {
            this.AbstractLoader_constructor(a, b, createjs.AbstractLoader.SVG), this.resultFormatter = this._formatResult, this._tagSrcAttribute = "data", b ? this.setTag(document.createElement("svg")) : (this.setTag(document.createElement("object")), this.getTag().type = "image/svg+xml")
        }
        var a = createjs.extend(SVGLoader, createjs.AbstractLoader),
            b = SVGLoader;
        b.canLoadItem = function(a) {
            return a.type == createjs.AbstractLoader.SVG
        }, a._formatResult = function(a) {
            var b = createjs.DataUtils.parseXML(a.getResult(!0), "text/xml"),
                c = a.getTag();
            return !this._preferXHR && document.body.contains(c) && document.body.removeChild(c), null != b.documentElement ? (c.appendChild(b.documentElement), c.style.visibility = "visible", c) : b
        }, createjs.SVGLoader = createjs.promote(SVGLoader, "AbstractLoader")
    }(), this.createjs = this.createjs || {},
    function() {
        "use strict";

        function XMLLoader(a) {
            this.AbstractLoader_constructor(a, !0, createjs.AbstractLoader.XML), this.resultFormatter = this._formatResult
        }
        var a = createjs.extend(XMLLoader, createjs.AbstractLoader),
            b = XMLLoader;
        b.canLoadItem = function(a) {
            return a.type == createjs.AbstractLoader.XML
        }, a._formatResult = function(a) {
            return createjs.DataUtils.parseXML(a.getResult(!0), "text/xml")
        }, createjs.XMLLoader = createjs.promote(XMLLoader, "AbstractLoader")
    }();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJ2ZW5kb3IvcHJlbG9hZGpzXzAuNi4yLm1pbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJ0aGlzLmNyZWF0ZWpzID0gdGhpcy5jcmVhdGVqcyB8fCB7fSxcbiAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIHZhciBhID0gY3JlYXRlanMuUHJlbG9hZEpTID0gY3JlYXRlanMuUHJlbG9hZEpTIHx8IHt9O1xuICAgICAgICBhLnZlcnNpb24gPSBcIjAuNi4yXCIsIGEuYnVpbGREYXRlID0gXCJUaHUsIDI2IE5vdiAyMDE1IDIwOjQ0OjMxIEdNVFwiXG4gICAgfSgpLCB0aGlzLmNyZWF0ZWpzID0gdGhpcy5jcmVhdGVqcyB8fCB7fSwgY3JlYXRlanMuZXh0ZW5kID0gZnVuY3Rpb24oYSwgYikge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgICAgICBmdW5jdGlvbiBjKCkge1xuICAgICAgICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9IGFcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgYS5wcm90b3R5cGUgPSBuZXcgY1xuICAgIH0sIHRoaXMuY3JlYXRlanMgPSB0aGlzLmNyZWF0ZWpzIHx8IHt9LCBjcmVhdGVqcy5wcm9tb3RlID0gZnVuY3Rpb24oYSwgYikge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIGMgPSBhLnByb3RvdHlwZSxcbiAgICAgICAgICAgIGQgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YgJiYgT2JqZWN0LmdldFByb3RvdHlwZU9mKGMpIHx8IGMuX19wcm90b19fO1xuICAgICAgICBpZiAoZCkge1xuICAgICAgICAgICAgY1soYiArPSBcIl9cIikgKyBcImNvbnN0cnVjdG9yXCJdID0gZC5jb25zdHJ1Y3RvcjtcbiAgICAgICAgICAgIGZvciAodmFyIGUgaW4gZCkgYy5oYXNPd25Qcm9wZXJ0eShlKSAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGRbZV0gJiYgKGNbYiArIGVdID0gZFtlXSlcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYVxuICAgIH0sIHRoaXMuY3JlYXRlanMgPSB0aGlzLmNyZWF0ZWpzIHx8IHt9LFxuICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgY3JlYXRlanMucHJveHkgPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgICB2YXIgYyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMik7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGEuYXBwbHkoYiwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKS5jb25jYXQoYykpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KCksIHRoaXMuY3JlYXRlanMgPSB0aGlzLmNyZWF0ZWpzIHx8IHt9LCBjcmVhdGVqcy5pbmRleE9mID0gZnVuY3Rpb24oYSwgYikge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgZm9yICh2YXIgYyA9IDAsIGQgPSBhLmxlbmd0aDsgZCA+IGM7IGMrKylcbiAgICAgICAgICAgIGlmIChiID09PSBhW2NdKSByZXR1cm4gYztcbiAgICAgICAgcmV0dXJuIC0xXG4gICAgfSwgdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanMgfHwge30sXG4gICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgICAgIGZ1bmN0aW9uIEV2ZW50KGEsIGIsIGMpIHtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IGEsIHRoaXMudGFyZ2V0ID0gbnVsbCwgdGhpcy5jdXJyZW50VGFyZ2V0ID0gbnVsbCwgdGhpcy5ldmVudFBoYXNlID0gMCwgdGhpcy5idWJibGVzID0gISFiLCB0aGlzLmNhbmNlbGFibGUgPSAhIWMsIHRoaXMudGltZVN0YW1wID0gKG5ldyBEYXRlKS5nZXRUaW1lKCksIHRoaXMuZGVmYXVsdFByZXZlbnRlZCA9ICExLCB0aGlzLnByb3BhZ2F0aW9uU3RvcHBlZCA9ICExLCB0aGlzLmltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCA9ICExLCB0aGlzLnJlbW92ZWQgPSAhMVxuICAgICAgICB9XG4gICAgICAgIHZhciBhID0gRXZlbnQucHJvdG90eXBlO1xuICAgICAgICBhLnByZXZlbnREZWZhdWx0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRQcmV2ZW50ZWQgPSB0aGlzLmNhbmNlbGFibGUgJiYgITBcbiAgICAgICAgfSwgYS5zdG9wUHJvcGFnYXRpb24gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMucHJvcGFnYXRpb25TdG9wcGVkID0gITBcbiAgICAgICAgfSwgYS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuaW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gdGhpcy5wcm9wYWdhdGlvblN0b3BwZWQgPSAhMFxuICAgICAgICB9LCBhLnJlbW92ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVkID0gITBcbiAgICAgICAgfSwgYS5jbG9uZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBFdmVudCh0aGlzLnR5cGUsIHRoaXMuYnViYmxlcywgdGhpcy5jYW5jZWxhYmxlKVxuICAgICAgICB9LCBhLnNldCA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGIgaW4gYSkgdGhpc1tiXSA9IGFbYl07XG4gICAgICAgICAgICByZXR1cm4gdGhpc1xuICAgICAgICB9LCBhLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gXCJbRXZlbnQgKHR5cGU9XCIgKyB0aGlzLnR5cGUgKyBcIildXCJcbiAgICAgICAgfSwgY3JlYXRlanMuRXZlbnQgPSBFdmVudFxuICAgIH0oKSwgdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanMgfHwge30sXG4gICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgICAgIGZ1bmN0aW9uIEVycm9yRXZlbnQoYSwgYiwgYykge1xuICAgICAgICAgICAgdGhpcy5FdmVudF9jb25zdHJ1Y3RvcihcImVycm9yXCIpLCB0aGlzLnRpdGxlID0gYSwgdGhpcy5tZXNzYWdlID0gYiwgdGhpcy5kYXRhID0gY1xuICAgICAgICB9XG4gICAgICAgIHZhciBhID0gY3JlYXRlanMuZXh0ZW5kKEVycm9yRXZlbnQsIGNyZWF0ZWpzLkV2ZW50KTtcbiAgICAgICAgYS5jbG9uZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBjcmVhdGVqcy5FcnJvckV2ZW50KHRoaXMudGl0bGUsIHRoaXMubWVzc2FnZSwgdGhpcy5kYXRhKVxuICAgICAgICB9LCBjcmVhdGVqcy5FcnJvckV2ZW50ID0gY3JlYXRlanMucHJvbW90ZShFcnJvckV2ZW50LCBcIkV2ZW50XCIpXG4gICAgfSgpLCB0aGlzLmNyZWF0ZWpzID0gdGhpcy5jcmVhdGVqcyB8fCB7fSxcbiAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAgICAgZnVuY3Rpb24gRXZlbnREaXNwYXRjaGVyKCkge1xuICAgICAgICAgICAgdGhpcy5fbGlzdGVuZXJzID0gbnVsbCwgdGhpcy5fY2FwdHVyZUxpc3RlbmVycyA9IG51bGxcbiAgICAgICAgfVxuICAgICAgICB2YXIgYSA9IEV2ZW50RGlzcGF0Y2hlci5wcm90b3R5cGU7XG4gICAgICAgIEV2ZW50RGlzcGF0Y2hlci5pbml0aWFsaXplID0gZnVuY3Rpb24oYikge1xuICAgICAgICAgICAgYi5hZGRFdmVudExpc3RlbmVyID0gYS5hZGRFdmVudExpc3RlbmVyLCBiLm9uID0gYS5vbiwgYi5yZW1vdmVFdmVudExpc3RlbmVyID0gYi5vZmYgPSBhLnJlbW92ZUV2ZW50TGlzdGVuZXIsIGIucmVtb3ZlQWxsRXZlbnRMaXN0ZW5lcnMgPSBhLnJlbW92ZUFsbEV2ZW50TGlzdGVuZXJzLCBiLmhhc0V2ZW50TGlzdGVuZXIgPSBhLmhhc0V2ZW50TGlzdGVuZXIsIGIuZGlzcGF0Y2hFdmVudCA9IGEuZGlzcGF0Y2hFdmVudCwgYi5fZGlzcGF0Y2hFdmVudCA9IGEuX2Rpc3BhdGNoRXZlbnQsIGIud2lsbFRyaWdnZXIgPSBhLndpbGxUcmlnZ2VyXG4gICAgICAgIH0sIGEuYWRkRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uKGEsIGIsIGMpIHtcbiAgICAgICAgICAgIHZhciBkO1xuICAgICAgICAgICAgZCA9IGMgPyB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzID0gdGhpcy5fY2FwdHVyZUxpc3RlbmVycyB8fCB7fSA6IHRoaXMuX2xpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVycyB8fCB7fTtcbiAgICAgICAgICAgIHZhciBlID0gZFthXTtcbiAgICAgICAgICAgIHJldHVybiBlICYmIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcihhLCBiLCBjKSwgZSA9IGRbYV0sIGUgPyBlLnB1c2goYikgOiBkW2FdID0gW2JdLCBiXG4gICAgICAgIH0sIGEub24gPSBmdW5jdGlvbihhLCBiLCBjLCBkLCBlLCBmKSB7XG4gICAgICAgICAgICByZXR1cm4gYi5oYW5kbGVFdmVudCAmJiAoYyA9IGMgfHwgYiwgYiA9IGIuaGFuZGxlRXZlbnQpLCBjID0gYyB8fCB0aGlzLCB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoYSwgZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgICAgIGIuY2FsbChjLCBhLCBlKSwgZCAmJiBhLnJlbW92ZSgpXG4gICAgICAgICAgICB9LCBmKVxuICAgICAgICB9LCBhLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbihhLCBiLCBjKSB7XG4gICAgICAgICAgICB2YXIgZCA9IGMgPyB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzIDogdGhpcy5fbGlzdGVuZXJzO1xuICAgICAgICAgICAgaWYgKGQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZSA9IGRbYV07XG4gICAgICAgICAgICAgICAgaWYgKGUpXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGYgPSAwLCBnID0gZS5sZW5ndGg7IGcgPiBmOyBmKyspXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZVtmXSA9PSBiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgMSA9PSBnID8gZGVsZXRlIGRbYV0gOiBlLnNwbGljZShmLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCBhLm9mZiA9IGEucmVtb3ZlRXZlbnRMaXN0ZW5lciwgYS5yZW1vdmVBbGxFdmVudExpc3RlbmVycyA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIGEgPyAodGhpcy5fbGlzdGVuZXJzICYmIGRlbGV0ZSB0aGlzLl9saXN0ZW5lcnNbYV0sIHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMgJiYgZGVsZXRlIHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnNbYV0pIDogdGhpcy5fbGlzdGVuZXJzID0gdGhpcy5fY2FwdHVyZUxpc3RlbmVycyA9IG51bGxcbiAgICAgICAgfSwgYS5kaXNwYXRjaEV2ZW50ID0gZnVuY3Rpb24oYSwgYiwgYykge1xuICAgICAgICAgICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9IHRoaXMuX2xpc3RlbmVycztcbiAgICAgICAgICAgICAgICBpZiAoIShiIHx8IGQgJiYgZFthXSkpIHJldHVybiAhMDtcbiAgICAgICAgICAgICAgICBhID0gbmV3IGNyZWF0ZWpzLkV2ZW50KGEsIGIsIGMpXG4gICAgICAgICAgICB9IGVsc2UgYS50YXJnZXQgJiYgYS5jbG9uZSAmJiAoYSA9IGEuY2xvbmUoKSk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGEudGFyZ2V0ID0gdGhpc1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge31cbiAgICAgICAgICAgIGlmIChhLmJ1YmJsZXMgJiYgdGhpcy5wYXJlbnQpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBmID0gdGhpcywgZyA9IFtmXTsgZi5wYXJlbnQ7KSBnLnB1c2goZiA9IGYucGFyZW50KTtcbiAgICAgICAgICAgICAgICB2YXIgaCwgaSA9IGcubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGZvciAoaCA9IGkgLSAxOyBoID49IDAgJiYgIWEucHJvcGFnYXRpb25TdG9wcGVkOyBoLS0pIGdbaF0uX2Rpc3BhdGNoRXZlbnQoYSwgMSArICgwID09IGgpKTtcbiAgICAgICAgICAgICAgICBmb3IgKGggPSAxOyBpID4gaCAmJiAhYS5wcm9wYWdhdGlvblN0b3BwZWQ7IGgrKykgZ1toXS5fZGlzcGF0Y2hFdmVudChhLCAzKVxuICAgICAgICAgICAgfSBlbHNlIHRoaXMuX2Rpc3BhdGNoRXZlbnQoYSwgMik7XG4gICAgICAgICAgICByZXR1cm4gIWEuZGVmYXVsdFByZXZlbnRlZFxuICAgICAgICB9LCBhLmhhc0V2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICB2YXIgYiA9IHRoaXMuX2xpc3RlbmVycyxcbiAgICAgICAgICAgICAgICBjID0gdGhpcy5fY2FwdHVyZUxpc3RlbmVycztcbiAgICAgICAgICAgIHJldHVybiAhIShiICYmIGJbYV0gfHwgYyAmJiBjW2FdKVxuICAgICAgICB9LCBhLndpbGxUcmlnZ2VyID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgZm9yICh2YXIgYiA9IHRoaXM7IGI7KSB7XG4gICAgICAgICAgICAgICAgaWYgKGIuaGFzRXZlbnRMaXN0ZW5lcihhKSkgcmV0dXJuICEwO1xuICAgICAgICAgICAgICAgIGIgPSBiLnBhcmVudFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICExXG4gICAgICAgIH0sIGEudG9TdHJpbmcgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBcIltFdmVudERpc3BhdGNoZXJdXCJcbiAgICAgICAgfSwgYS5fZGlzcGF0Y2hFdmVudCA9IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgICAgIHZhciBjLCBkID0gMSA9PSBiID8gdGhpcy5fY2FwdHVyZUxpc3RlbmVycyA6IHRoaXMuX2xpc3RlbmVycztcbiAgICAgICAgICAgIGlmIChhICYmIGQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZSA9IGRbYS50eXBlXTtcbiAgICAgICAgICAgICAgICBpZiAoIWUgfHwgIShjID0gZS5sZW5ndGgpKSByZXR1cm47XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgYS5jdXJyZW50VGFyZ2V0ID0gdGhpc1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGYpIHt9XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgYS5ldmVudFBoYXNlID0gYlxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGYpIHt9XG4gICAgICAgICAgICAgICAgYS5yZW1vdmVkID0gITEsIGUgPSBlLnNsaWNlKCk7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgZyA9IDA7IGMgPiBnICYmICFhLmltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZDsgZysrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBoID0gZVtnXTtcbiAgICAgICAgICAgICAgICAgICAgaC5oYW5kbGVFdmVudCA/IGguaGFuZGxlRXZlbnQoYSkgOiBoKGEpLCBhLnJlbW92ZWQgJiYgKHRoaXMub2ZmKGEudHlwZSwgaCwgMSA9PSBiKSwgYS5yZW1vdmVkID0gITEpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCBjcmVhdGVqcy5FdmVudERpc3BhdGNoZXIgPSBFdmVudERpc3BhdGNoZXJcbiAgICB9KCksIHRoaXMuY3JlYXRlanMgPSB0aGlzLmNyZWF0ZWpzIHx8IHt9LFxuICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgICAgICBmdW5jdGlvbiBQcm9ncmVzc0V2ZW50KGEsIGIpIHtcbiAgICAgICAgICAgIHRoaXMuRXZlbnRfY29uc3RydWN0b3IoXCJwcm9ncmVzc1wiKSwgdGhpcy5sb2FkZWQgPSBhLCB0aGlzLnRvdGFsID0gbnVsbCA9PSBiID8gMSA6IGIsIHRoaXMucHJvZ3Jlc3MgPSAwID09IGIgPyAwIDogdGhpcy5sb2FkZWQgLyB0aGlzLnRvdGFsXG4gICAgICAgIH1cbiAgICAgICAgdmFyIGEgPSBjcmVhdGVqcy5leHRlbmQoUHJvZ3Jlc3NFdmVudCwgY3JlYXRlanMuRXZlbnQpO1xuICAgICAgICBhLmNsb25lID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IGNyZWF0ZWpzLlByb2dyZXNzRXZlbnQodGhpcy5sb2FkZWQsIHRoaXMudG90YWwpXG4gICAgICAgIH0sIGNyZWF0ZWpzLlByb2dyZXNzRXZlbnQgPSBjcmVhdGVqcy5wcm9tb3RlKFByb2dyZXNzRXZlbnQsIFwiRXZlbnRcIilcbiAgICB9KHdpbmRvdyksXG4gICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIGZ1bmN0aW9uIGEoYiwgZCkge1xuICAgICAgICAgICAgZnVuY3Rpb24gZihhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZbYV0gIT09IHEpIHJldHVybiBmW2FdO1xuICAgICAgICAgICAgICAgIHZhciBiO1xuICAgICAgICAgICAgICAgIGlmIChcImJ1Zy1zdHJpbmctY2hhci1pbmRleFwiID09IGEpIGIgPSBcImFcIiAhPSBcImFcIiBbMF07XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoXCJqc29uXCIgPT0gYSkgYiA9IGYoXCJqc29uLXN0cmluZ2lmeVwiKSAmJiBmKFwianNvbi1wYXJzZVwiKTtcbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGUgPSAne1wiYVwiOlsxLHRydWUsZmFsc2UsbnVsbCxcIlxcXFx1MDAwMFxcXFxiXFxcXG5cXFxcZlxcXFxyXFxcXHRcIl19JztcbiAgICAgICAgICAgICAgICAgICAgaWYgKFwianNvbi1zdHJpbmdpZnlcIiA9PSBhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IGQuc3RyaW5naWZ5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGkgJiYgdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKGMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS50b0pTT04gPSBjO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBcIjBcIiA9PT0gaSgwKSAmJiBcIjBcIiA9PT0gaShuZXcgZykgJiYgJ1wiXCInID09IGkobmV3IGgpICYmIGkocykgPT09IHEgJiYgaShxKSA9PT0gcSAmJiBpKCkgPT09IHEgJiYgXCIxXCIgPT09IGkoYykgJiYgXCJbMV1cIiA9PSBpKFtjXSkgJiYgXCJbbnVsbF1cIiA9PSBpKFtxXSkgJiYgXCJudWxsXCIgPT0gaShudWxsKSAmJiBcIltudWxsLG51bGwsbnVsbF1cIiA9PSBpKFtxLCBzLCBudWxsXSkgJiYgaSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhOiBbYywgITAsICExLCBudWxsLCBcIlxceDAwXFxiXFxuXFxmXFxyXHRcIl1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkgPT0gZSAmJiBcIjFcIiA9PT0gaShudWxsLCBjKSAmJiBcIltcXG4gMSxcXG4gMlxcbl1cIiA9PSBpKFsxLCAyXSwgbnVsbCwgMSkgJiYgJ1wiLTI3MTgyMS0wNC0yMFQwMDowMDowMC4wMDBaXCInID09IGkobmV3IGooLTg2NGUxMykpICYmICdcIisyNzU3NjAtMDktMTNUMDA6MDA6MDAuMDAwWlwiJyA9PSBpKG5ldyBqKDg2NGUxMykpICYmICdcIi0wMDAwMDEtMDEtMDFUMDA6MDA6MDAuMDAwWlwiJyA9PSBpKG5ldyBqKC02MjE5ODc1NTJlNSkpICYmICdcIjE5NjktMTItMzFUMjM6NTk6NTkuOTk5WlwiJyA9PSBpKG5ldyBqKC0xKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSAhMVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBrXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKFwianNvbi1wYXJzZVwiID09IGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtID0gZC5wYXJzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIG0pIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPT09IG0oXCIwXCIpICYmICFtKCExKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gbShlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSA1ID09IGMuYS5sZW5ndGggJiYgMSA9PT0gYy5hWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuID0gIW0oJ1wiXHRcIicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChsKSB7fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG4pIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IDEgIT09IG0oXCIwMVwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAobCkge31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuKSB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSAxICE9PSBtKFwiMS5cIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGwpIHt9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9ICExXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBiID0gblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmW2FdID0gISFiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBiIHx8IChiID0gZS5PYmplY3QoKSksIGQgfHwgKGQgPSBlLk9iamVjdCgpKTtcbiAgICAgICAgICAgIHZhciBnID0gYi5OdW1iZXIgfHwgZS5OdW1iZXIsXG4gICAgICAgICAgICAgICAgaCA9IGIuU3RyaW5nIHx8IGUuU3RyaW5nLFxuICAgICAgICAgICAgICAgIGkgPSBiLk9iamVjdCB8fCBlLk9iamVjdCxcbiAgICAgICAgICAgICAgICBqID0gYi5EYXRlIHx8IGUuRGF0ZSxcbiAgICAgICAgICAgICAgICBrID0gYi5TeW50YXhFcnJvciB8fCBlLlN5bnRheEVycm9yLFxuICAgICAgICAgICAgICAgIGwgPSBiLlR5cGVFcnJvciB8fCBlLlR5cGVFcnJvcixcbiAgICAgICAgICAgICAgICBtID0gYi5NYXRoIHx8IGUuTWF0aCxcbiAgICAgICAgICAgICAgICBuID0gYi5KU09OIHx8IGUuSlNPTjtcbiAgICAgICAgICAgIFwib2JqZWN0XCIgPT0gdHlwZW9mIG4gJiYgbiAmJiAoZC5zdHJpbmdpZnkgPSBuLnN0cmluZ2lmeSwgZC5wYXJzZSA9IG4ucGFyc2UpO1xuICAgICAgICAgICAgdmFyIG8sIHAsIHEsIHIgPSBpLnByb3RvdHlwZSxcbiAgICAgICAgICAgICAgICBzID0gci50b1N0cmluZyxcbiAgICAgICAgICAgICAgICB0ID0gbmV3IGooLTB4Yzc4MmI1YjgwMGNlYyk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHQgPSAtMTA5MjUyID09IHQuZ2V0VVRDRnVsbFllYXIoKSAmJiAwID09PSB0LmdldFVUQ01vbnRoKCkgJiYgMSA9PT0gdC5nZXRVVENEYXRlKCkgJiYgMTAgPT0gdC5nZXRVVENIb3VycygpICYmIDM3ID09IHQuZ2V0VVRDTWludXRlcygpICYmIDYgPT0gdC5nZXRVVENTZWNvbmRzKCkgJiYgNzA4ID09IHQuZ2V0VVRDTWlsbGlzZWNvbmRzKClcbiAgICAgICAgICAgIH0gY2F0Y2ggKHUpIHt9XG4gICAgICAgICAgICBpZiAoIWYoXCJqc29uXCIpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHYgPSBcIltvYmplY3QgRnVuY3Rpb25dXCIsXG4gICAgICAgICAgICAgICAgICAgIHcgPSBcIltvYmplY3QgRGF0ZV1cIixcbiAgICAgICAgICAgICAgICAgICAgeCA9IFwiW29iamVjdCBOdW1iZXJdXCIsXG4gICAgICAgICAgICAgICAgICAgIHkgPSBcIltvYmplY3QgU3RyaW5nXVwiLFxuICAgICAgICAgICAgICAgICAgICB6ID0gXCJbb2JqZWN0IEFycmF5XVwiLFxuICAgICAgICAgICAgICAgICAgICBBID0gXCJbb2JqZWN0IEJvb2xlYW5dXCIsXG4gICAgICAgICAgICAgICAgICAgIEIgPSBmKFwiYnVnLXN0cmluZy1jaGFyLWluZGV4XCIpO1xuICAgICAgICAgICAgICAgIGlmICghdCkgdmFyIEMgPSBtLmZsb29yLFxuICAgICAgICAgICAgICAgICAgICBEID0gWzAsIDMxLCA1OSwgOTAsIDEyMCwgMTUxLCAxODEsIDIxMiwgMjQzLCAyNzMsIDMwNCwgMzM0XSxcbiAgICAgICAgICAgICAgICAgICAgRSA9IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBEW2JdICsgMzY1ICogKGEgLSAxOTcwKSArIEMoKGEgLSAxOTY5ICsgKGIgPSArKGIgPiAxKSkpIC8gNCkgLSBDKChhIC0gMTkwMSArIGIpIC8gMTAwKSArIEMoKGEgLSAxNjAxICsgYikgLyA0MDApXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgaWYgKChvID0gci5oYXNPd25Qcm9wZXJ0eSkgfHwgKG8gPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiwgYyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChjLl9fcHJvdG9fXyA9IG51bGwsIGMuX19wcm90b19fID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvU3RyaW5nOiAxXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBjKS50b1N0cmluZyAhPSBzID8gbyA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMuX19wcm90b19fLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gYSBpbiAodGhpcy5fX3Byb3RvX18gPSBudWxsLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fX3Byb3RvX18gPSBiLCBjXG4gICAgICAgICAgICAgICAgICAgICAgICB9IDogKGIgPSBjLmNvbnN0cnVjdG9yLCBvID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gKHRoaXMuY29uc3RydWN0b3IgfHwgYikucHJvdG90eXBlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhIGluIHRoaXMgJiYgIShhIGluIGMgJiYgdGhpc1thXSA9PT0gY1thXSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBjID0gbnVsbCwgby5jYWxsKHRoaXMsIGEpXG4gICAgICAgICAgICAgICAgICAgIH0pLCBwID0gZnVuY3Rpb24oYSwgYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQsIGUsIGYsIGcgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgKGQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbHVlT2YgPSAwXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5wcm90b3R5cGUudmFsdWVPZiA9IDAsIGUgPSBuZXcgZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZiBpbiBlKSBvLmNhbGwoZSwgZikgJiYgZysrO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQgPSBlID0gbnVsbCwgZyA/IHAgPSAyID09IGcgPyBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGMsIGQgPSB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IHMuY2FsbChhKSA9PSB2O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYyBpbiBhKSBlICYmIFwicHJvdG90eXBlXCIgPT0gYyB8fCBvLmNhbGwoZCwgYykgfHwgIShkW2NdID0gMSkgfHwgIW8uY2FsbChhLCBjKSB8fCBiKGMpXG4gICAgICAgICAgICAgICAgICAgICAgICB9IDogZnVuY3Rpb24oYSwgYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjLCBkLCBlID0gcy5jYWxsKGEpID09IHY7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjIGluIGEpIGUgJiYgXCJwcm90b3R5cGVcIiA9PSBjIHx8ICFvLmNhbGwoYSwgYykgfHwgKGQgPSBcImNvbnN0cnVjdG9yXCIgPT09IGMpIHx8IGIoYyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKGQgfHwgby5jYWxsKGEsIGMgPSBcImNvbnN0cnVjdG9yXCIpKSAmJiBiKGMpXG4gICAgICAgICAgICAgICAgICAgICAgICB9IDogKGUgPSBbXCJ2YWx1ZU9mXCIsIFwidG9TdHJpbmdcIiwgXCJ0b0xvY2FsZVN0cmluZ1wiLCBcInByb3BlcnR5SXNFbnVtZXJhYmxlXCIsIFwiaXNQcm90b3R5cGVPZlwiLCBcImhhc093blByb3BlcnR5XCIsIFwiY29uc3RydWN0b3JcIl0sIHAgPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQsIGYsIGcgPSBzLmNhbGwoYSkgPT0gdixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9ICFnICYmIFwiZnVuY3Rpb25cIiAhPSB0eXBlb2YgYS5jb25zdHJ1Y3RvciAmJiBjW3R5cGVvZiBhLmhhc093blByb3BlcnR5XSAmJiBhLmhhc093blByb3BlcnR5IHx8IG87XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChkIGluIGEpIGcgJiYgXCJwcm90b3R5cGVcIiA9PSBkIHx8ICFoLmNhbGwoYSwgZCkgfHwgYihkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGYgPSBlLmxlbmd0aDsgZCA9IGVbLS1mXTsgaC5jYWxsKGEsIGQpICYmIGIoZCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSksIHAoYSwgYilcbiAgICAgICAgICAgICAgICAgICAgfSwgIWYoXCJqc29uLXN0cmluZ2lmeVwiKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgRiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA5MjogXCJcXFxcXFxcXFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDM0OiAnXFxcXFwiJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA4OiBcIlxcXFxiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgMTI6IFwiXFxcXGZcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMDogXCJcXFxcblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEzOiBcIlxcXFxyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOTogXCJcXFxcdFwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgRyA9IFwiMDAwMDAwXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBIID0gZnVuY3Rpb24oYSwgYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoRyArIChiIHx8IDApKS5zbGljZSgtYSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBJID0gXCJcXFxcdTAwXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBKID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGIgPSAnXCInLCBjID0gMCwgZCA9IGEubGVuZ3RoLCBlID0gIUIgfHwgZCA+IDEwLCBmID0gZSAmJiAoQiA/IGEuc3BsaXQoXCJcIikgOiBhKTsgZCA+IGM7IGMrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IGEuY2hhckNvZGVBdChjKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDg6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDk6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTM6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5MjpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiICs9IEZbZ107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgzMiA+IGcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiArPSBJICsgSCgyLCBnLnRvU3RyaW5nKDE2KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgKz0gZSA/IGZbY10gOiBhLmNoYXJBdChjKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiICsgJ1wiJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIEsgPSBmdW5jdGlvbihhLCBiLCBjLCBkLCBlLCBmLCBnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGgsIGksIGosIGssIG0sIG4sIHIsIHQsIHUsIHYsIEIsIEQsIEYsIEcsIEksIEw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGJbYV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChNKSB7fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcIm9iamVjdFwiID09IHR5cGVvZiBoICYmIGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID0gcy5jYWxsKGgpLCBpICE9IHcgfHwgby5jYWxsKGgsIFwidG9KU09OXCIpKSBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGgudG9KU09OICYmIChpICE9IHggJiYgaSAhPSB5ICYmIGkgIT0geiB8fCBvLmNhbGwoaCwgXCJ0b0pTT05cIikpICYmIChoID0gaC50b0pTT04oYSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChoID4gLTEgLyAwICYmIDEgLyAwID4gaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoRSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChtID0gQyhoIC8gODY0ZTUpLCBqID0gQyhtIC8gMzY1LjI0MjUpICsgMTk3MCAtIDE7IEUoaiArIDEsIDApIDw9IG07IGorKyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGsgPSBDKChtIC0gRShqLCAwKSkgLyAzMC40Mik7IEUoaiwgayArIDEpIDw9IG07IGsrKyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtID0gMSArIG0gLSBFKGosIGspLCBuID0gKGggJSA4NjRlNSArIDg2NGU1KSAlIDg2NGU1LCByID0gQyhuIC8gMzZlNSkgJSAyNCwgdCA9IEMobiAvIDZlNCkgJSA2MCwgdSA9IEMobiAvIDFlMykgJSA2MCwgdiA9IG4gJSAxZTNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGogPSBoLmdldFVUQ0Z1bGxZZWFyKCksIGsgPSBoLmdldFVUQ01vbnRoKCksIG0gPSBoLmdldFVUQ0RhdGUoKSwgciA9IGguZ2V0VVRDSG91cnMoKSwgdCA9IGguZ2V0VVRDTWludXRlcygpLCB1ID0gaC5nZXRVVENTZWNvbmRzKCksIHYgPSBoLmdldFVUQ01pbGxpc2Vjb25kcygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gKDAgPj0gaiB8fCBqID49IDFlNCA/ICgwID4gaiA/IFwiLVwiIDogXCIrXCIpICsgSCg2LCAwID4gaiA/IC1qIDogaikgOiBIKDQsIGopKSArIFwiLVwiICsgSCgyLCBrICsgMSkgKyBcIi1cIiArIEgoMiwgbSkgKyBcIlRcIiArIEgoMiwgcikgKyBcIjpcIiArIEgoMiwgdCkgKyBcIjpcIiArIEgoMiwgdSkgKyBcIi5cIiArIEgoMywgdikgKyBcIlpcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBoID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyAmJiAoaCA9IGMuY2FsbChiLCBhLCBoKSksIG51bGwgPT09IGgpIHJldHVybiBcIm51bGxcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA9IHMuY2FsbChoKSwgaSA9PSBBKSByZXR1cm4gXCJcIiArIGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT0geCkgcmV0dXJuIGggPiAtMSAvIDAgJiYgMSAvIDAgPiBoID8gXCJcIiArIGggOiBcIm51bGxcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PSB5KSByZXR1cm4gSihcIlwiICsgaCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFwib2JqZWN0XCIgPT0gdHlwZW9mIGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChHID0gZy5sZW5ndGg7IEctLTspXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ1tHXSA9PT0gaCkgdGhyb3cgbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZy5wdXNoKGgpLCBCID0gW10sIEkgPSBmLCBmICs9IGUsIGkgPT0geikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChGID0gMCwgRyA9IGgubGVuZ3RoOyBHID4gRjsgRisrKSBEID0gSyhGLCBoLCBjLCBkLCBlLCBmLCBnKSwgQi5wdXNoKEQgPT09IHEgPyBcIm51bGxcIiA6IEQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTCA9IEIubGVuZ3RoID8gZSA/IFwiW1xcblwiICsgZiArIEIuam9pbihcIixcXG5cIiArIGYpICsgXCJcXG5cIiArIEkgKyBcIl1cIiA6IFwiW1wiICsgQi5qb2luKFwiLFwiKSArIFwiXVwiIDogXCJbXVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBwKGQgfHwgaCwgZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBLKGEsIGgsIGMsIGQsIGUsIGYsIGcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiAhPT0gcSAmJiBCLnB1c2goSihhKSArIFwiOlwiICsgKGUgPyBcIiBcIiA6IFwiXCIpICsgYilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIEwgPSBCLmxlbmd0aCA/IGUgPyBcIntcXG5cIiArIGYgKyBCLmpvaW4oXCIsXFxuXCIgKyBmKSArIFwiXFxuXCIgKyBJICsgXCJ9XCIgOiBcIntcIiArIEIuam9pbihcIixcIikgKyBcIn1cIiA6IFwie31cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGcucG9wKCksIExcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBkLnN0cmluZ2lmeSA9IGZ1bmN0aW9uKGEsIGIsIGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlLCBmLCBnLCBoO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNbdHlwZW9mIGJdICYmIGIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChoID0gcy5jYWxsKGIpKSA9PSB2KSBmID0gYjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChoID09IHopIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSwgaiA9IDAsIGsgPSBiLmxlbmd0aDsgayA+IGo7IGkgPSBiW2orK10sIGggPSBzLmNhbGwoaSksIChoID09IHkgfHwgaCA9PSB4KSAmJiAoZ1tpXSA9IDEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoaCA9IHMuY2FsbChkKSkgPT0geCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGQgLT0gZCAlIDEpID4gMClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoZSA9IFwiXCIsIGQgPiAxMCAmJiAoZCA9IDEwKTsgZS5sZW5ndGggPCBkOyBlICs9IFwiIFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaCA9PSB5ICYmIChlID0gZC5sZW5ndGggPD0gMTAgPyBkIDogZC5zbGljZSgwLCAxMCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEsoXCJcIiwgKGkgPSB7fSwgaVtcIlwiXSA9IGEsIGkpLCBmLCBnLCBlLCBcIlwiLCBbXSlcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWYoXCJqc29uLXBhcnNlXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBMLCBNLCBOID0gaC5mcm9tQ2hhckNvZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBPID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDkyOiBcIlxcXFxcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAzNDogJ1wiJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA0NzogXCIvXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOTg6IFwiXFxiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgMTE2OiBcIlx0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgMTEwOiBcIlxcblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwMjogXCJcXGZcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMTQ6IFwiXFxyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBQID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgTCA9IE0gPSBudWxsLCBrKClcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBRID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYSwgYiwgYywgZCwgZSwgZiA9IE0sIGcgPSBmLmxlbmd0aDsgZyA+IEw7KSBzd2l0Y2ggKGUgPSBmLmNoYXJDb2RlQXQoTCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDMyOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTIzOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEyNTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5MTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5MzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1ODpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0NDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhID0gQiA/IGYuY2hhckF0KEwpIDogZltMXSwgTCsrLCBhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChhID0gXCJAXCIsIEwrKzsgZyA+IEw7KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlID0gZi5jaGFyQ29kZUF0KEwpLCAzMiA+IGUpIFAoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICg5MiA9PSBlKSBzd2l0Y2ggKGUgPSBmLmNoYXJDb2RlQXQoKytMKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgOTI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzNDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ3OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgOTg6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTY6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDI6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgKz0gT1tlXSwgTCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDExNzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChiID0gKytMLCBjID0gTCArIDQ7IGMgPiBMOyBMKyspIGUgPSBmLmNoYXJDb2RlQXQoTCksIGUgPj0gNDggJiYgNTcgPj0gZSB8fCBlID49IDk3ICYmIDEwMiA+PSBlIHx8IGUgPj0gNjUgJiYgNzAgPj0gZSB8fCBQKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgKz0gTihcIjB4XCIgKyBmLnNsaWNlKGIsIEwpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgzNCA9PSBlKSBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGUgPSBmLmNoYXJDb2RlQXQoTCksIGIgPSBMOyBlID49IDMyICYmIDkyICE9IGUgJiYgMzQgIT0gZTspIGUgPSBmLmNoYXJDb2RlQXQoKytMKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhICs9IGYuc2xpY2UoYiwgTClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgzNCA9PSBmLmNoYXJDb2RlQXQoTCkpIHJldHVybiBMKyssIGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYiA9IEwsIDQ1ID09IGUgJiYgKGQgPSAhMCwgZSA9IGYuY2hhckNvZGVBdCgrK0wpKSwgZSA+PSA0OCAmJiA1NyA+PSBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICg0OCA9PSBlICYmIChlID0gZi5jaGFyQ29kZUF0KEwgKyAxKSwgZSA+PSA0OCAmJiA1NyA+PSBlKSAmJiBQKCksIGQgPSAhMTsgZyA+IEwgJiYgKGUgPSBmLmNoYXJDb2RlQXQoTCksIGUgPj0gNDggJiYgNTcgPj0gZSk7IEwrKyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDQ2ID09IGYuY2hhckNvZGVBdChMKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGMgPSArK0w7IGcgPiBjICYmIChlID0gZi5jaGFyQ29kZUF0KGMpLCBlID49IDQ4ICYmIDU3ID49IGUpOyBjKyspO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID09IEwgJiYgUCgpLCBMID0gY1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSA9IGYuY2hhckNvZGVBdChMKSwgMTAxID09IGUgfHwgNjkgPT0gZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGUgPSBmLmNoYXJDb2RlQXQoKytMKSwgKDQzID09IGUgfHwgNDUgPT0gZSkgJiYgTCsrLCBjID0gTDsgZyA+IGMgJiYgKGUgPSBmLmNoYXJDb2RlQXQoYyksIGUgPj0gNDggJiYgNTcgPj0gZSk7IGMrKyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPT0gTCAmJiBQKCksIEwgPSBjXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiArZi5zbGljZShiLCBMKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQgJiYgUCgpLCBcInRydWVcIiA9PSBmLnNsaWNlKEwsIEwgKyA0KSkgcmV0dXJuIEwgKz0gNCwgITA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoXCJmYWxzZVwiID09IGYuc2xpY2UoTCwgTCArIDUpKSByZXR1cm4gTCArPSA1LCAhMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcIm51bGxcIiA9PSBmLnNsaWNlKEwsIEwgKyA0KSkgcmV0dXJuIEwgKz0gNCwgbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFAoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCIkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBSID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiLCBjO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcIiRcIiA9PSBhICYmIFAoKSwgXCJzdHJpbmdcIiA9PSB0eXBlb2YgYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoXCJAXCIgPT0gKEIgPyBhLmNoYXJBdCgwKSA6IGFbMF0pKSByZXR1cm4gYS5zbGljZSgxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFwiW1wiID09IGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYiA9IFtdOyBhID0gUSgpLCBcIl1cIiAhPSBhOyBjIHx8IChjID0gITApKSBjICYmIChcIixcIiA9PSBhID8gKGEgPSBRKCksIFwiXVwiID09IGEgJiYgUCgpKSA6IFAoKSksIFwiLFwiID09IGEgJiYgUCgpLCBiLnB1c2goUihhKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcIntcIiA9PSBhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGIgPSB7fTsgYSA9IFEoKSwgXCJ9XCIgIT0gYTsgYyB8fCAoYyA9ICEwKSkgYyAmJiAoXCIsXCIgPT0gYSA/IChhID0gUSgpLCBcIn1cIiA9PSBhICYmIFAoKSkgOiBQKCkpLCAoXCIsXCIgPT0gYSB8fCBcInN0cmluZ1wiICE9IHR5cGVvZiBhIHx8IFwiQFwiICE9IChCID8gYS5jaGFyQXQoMCkgOiBhWzBdKSB8fCBcIjpcIiAhPSBRKCkpICYmIFAoKSwgYlthLnNsaWNlKDEpXSA9IFIoUSgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgUyA9IGZ1bmN0aW9uKGEsIGIsIGMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IFQoYSwgYiwgYyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9PT0gcSA/IGRlbGV0ZSBhW2JdIDogYVtiXSA9IGRcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBUID0gZnVuY3Rpb24oYSwgYiwgYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkLCBlID0gYVtiXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoXCJvYmplY3RcIiA9PSB0eXBlb2YgZSAmJiBlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocy5jYWxsKGUpID09IHopXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGQgPSBlLmxlbmd0aDsgZC0tOykgUyhlLCBkLCBjKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBwKGUsIGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFMoZSwgYSwgYylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMuY2FsbChhLCBiLCBlKVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgZC5wYXJzZSA9IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjLCBkO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEwgPSAwLCBNID0gXCJcIiArIGEsIGMgPSBSKFEoKSksIFwiJFwiICE9IFEoKSAmJiBQKCksIEwgPSBNID0gbnVsbCwgYiAmJiBzLmNhbGwoYikgPT0gdiA/IFQoKGQgPSB7fSwgZFtcIlwiXSA9IGMsIGQpLCBcIlwiLCBiKSA6IGNcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBkLnJ1bkluQ29udGV4dCA9IGEsIGRcbiAgICAgICAgfVxuICAgICAgICB2YXIgYiA9IFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgZGVmaW5lICYmIGRlZmluZS5hbWQsXG4gICAgICAgICAgICBjID0ge1xuICAgICAgICAgICAgICAgIFwiZnVuY3Rpb25cIjogITAsXG4gICAgICAgICAgICAgICAgb2JqZWN0OiAhMFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGQgPSBjW3R5cGVvZiBleHBvcnRzXSAmJiBleHBvcnRzICYmICFleHBvcnRzLm5vZGVUeXBlICYmIGV4cG9ydHMsXG4gICAgICAgICAgICBlID0gY1t0eXBlb2Ygd2luZG93XSAmJiB3aW5kb3cgfHwgdGhpcyxcbiAgICAgICAgICAgIGYgPSBkICYmIGNbdHlwZW9mIG1vZHVsZV0gJiYgbW9kdWxlICYmICFtb2R1bGUubm9kZVR5cGUgJiYgXCJvYmplY3RcIiA9PSB0eXBlb2YgZ2xvYmFsICYmIGdsb2JhbDtcbiAgICAgICAgaWYgKCFmIHx8IGYuZ2xvYmFsICE9PSBmICYmIGYud2luZG93ICE9PSBmICYmIGYuc2VsZiAhPT0gZiB8fCAoZSA9IGYpLCBkICYmICFiKSBhKGUsIGQpO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBnID0gZS5KU09OLFxuICAgICAgICAgICAgICAgIGggPSBlLkpTT04zLFxuICAgICAgICAgICAgICAgIGkgPSAhMSxcbiAgICAgICAgICAgICAgICBqID0gYShlLCBlLkpTT04zID0ge1xuICAgICAgICAgICAgICAgICAgICBub0NvbmZsaWN0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpIHx8IChpID0gITAsIGUuSlNPTiA9IGcsIGUuSlNPTjMgPSBoLCBnID0gaCA9IG51bGwpLCBqXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGUuSlNPTiA9IHtcbiAgICAgICAgICAgICAgICBwYXJzZTogai5wYXJzZSxcbiAgICAgICAgICAgICAgICBzdHJpbmdpZnk6IGouc3RyaW5naWZ5XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYiAmJiBkZWZpbmUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4galxuICAgICAgICB9KVxuICAgIH0uY2FsbCh0aGlzKSxcbiAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGEgPSB7fTtcbiAgICAgICAgYS5hcHBlbmRUb0hlYWQgPSBmdW5jdGlvbihiKSB7XG4gICAgICAgICAgICBhLmdldEhlYWQoKS5hcHBlbmRDaGlsZChiKVxuICAgICAgICB9LCBhLmdldEhlYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaGVhZFwiKVswXVxuICAgICAgICB9LCBhLmdldEJvZHkgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5ib2R5IHx8IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiYm9keVwiKVswXVxuICAgICAgICB9LCBjcmVhdGVqcy5Eb21VdGlscyA9IGFcbiAgICB9KCksXG4gICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhID0ge307XG4gICAgICAgIGEucGFyc2VYTUwgPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgICB2YXIgYyA9IG51bGw7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuRE9NUGFyc2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gbmV3IERPTVBhcnNlcjtcbiAgICAgICAgICAgICAgICAgICAgYyA9IGQucGFyc2VGcm9tU3RyaW5nKGEsIGIpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaCAoZSkge31cbiAgICAgICAgICAgIGlmICghYykgdHJ5IHtcbiAgICAgICAgICAgICAgICBjID0gbmV3IEFjdGl2ZVhPYmplY3QoXCJNaWNyb3NvZnQuWE1MRE9NXCIpLCBjLmFzeW5jID0gITEsIGMubG9hZFhNTChhKVxuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGMgPSBudWxsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY1xuICAgICAgICB9LCBhLnBhcnNlSlNPTiA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIGlmIChudWxsID09IGEpIHJldHVybiBudWxsO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShhKVxuICAgICAgICAgICAgfSBjYXRjaCAoYikge1xuICAgICAgICAgICAgICAgIHRocm93IGJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgY3JlYXRlanMuRGF0YVV0aWxzID0gYVxuICAgIH0oKSwgdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanMgfHwge30sXG4gICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgICAgIGZ1bmN0aW9uIExvYWRJdGVtKCkge1xuICAgICAgICAgICAgdGhpcy5zcmMgPSBudWxsLCB0aGlzLnR5cGUgPSBudWxsLCB0aGlzLmlkID0gbnVsbCwgdGhpcy5tYWludGFpbk9yZGVyID0gITEsIHRoaXMuY2FsbGJhY2sgPSBudWxsLCB0aGlzLmRhdGEgPSBudWxsLCB0aGlzLm1ldGhvZCA9IGNyZWF0ZWpzLkxvYWRJdGVtLkdFVCwgdGhpcy52YWx1ZXMgPSBudWxsLCB0aGlzLmhlYWRlcnMgPSBudWxsLCB0aGlzLndpdGhDcmVkZW50aWFscyA9ICExLCB0aGlzLm1pbWVUeXBlID0gbnVsbCwgdGhpcy5jcm9zc09yaWdpbiA9IG51bGwsIHRoaXMubG9hZFRpbWVvdXQgPSBiLkxPQURfVElNRU9VVF9ERUZBVUxUXG4gICAgICAgIH1cbiAgICAgICAgdmFyIGEgPSBMb2FkSXRlbS5wcm90b3R5cGUgPSB7fSxcbiAgICAgICAgICAgIGIgPSBMb2FkSXRlbTtcbiAgICAgICAgYi5MT0FEX1RJTUVPVVRfREVGQVVMVCA9IDhlMywgYi5jcmVhdGUgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICBpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgYSkge1xuICAgICAgICAgICAgICAgIHZhciBjID0gbmV3IExvYWRJdGVtO1xuICAgICAgICAgICAgICAgIHJldHVybiBjLnNyYyA9IGEsIGNcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhIGluc3RhbmNlb2YgYikgcmV0dXJuIGE7XG4gICAgICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIE9iamVjdCAmJiBhLnNyYykgcmV0dXJuIG51bGwgPT0gYS5sb2FkVGltZW91dCAmJiAoYS5sb2FkVGltZW91dCA9IGIuTE9BRF9USU1FT1VUX0RFRkFVTFQpLCBhO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVHlwZSBub3QgcmVjb2duaXplZC5cIilcbiAgICAgICAgfSwgYS5zZXQgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBiIGluIGEpIHRoaXNbYl0gPSBhW2JdO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgfSwgY3JlYXRlanMuTG9hZEl0ZW0gPSBiXG4gICAgfSgpLFxuICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYSA9IHt9O1xuICAgICAgICBhLkFCU09MVVRFX1BBVFQgPSAvXig/Olxcdys6KT9cXC97Mn0vaSwgYS5SRUxBVElWRV9QQVRUID0gL15bLlxcL10qP1xcLy9pLCBhLkVYVEVOU0lPTl9QQVRUID0gL1xcLz9bXlxcL10rXFwuKFxcd3sxLDV9KSQvaSwgYS5wYXJzZVVSSSA9IGZ1bmN0aW9uKGIpIHtcbiAgICAgICAgICAgIHZhciBjID0ge1xuICAgICAgICAgICAgICAgIGFic29sdXRlOiAhMSxcbiAgICAgICAgICAgICAgICByZWxhdGl2ZTogITFcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAobnVsbCA9PSBiKSByZXR1cm4gYztcbiAgICAgICAgICAgIHZhciBkID0gYi5pbmRleE9mKFwiP1wiKTtcbiAgICAgICAgICAgIGQgPiAtMSAmJiAoYiA9IGIuc3Vic3RyKDAsIGQpKTtcbiAgICAgICAgICAgIHZhciBlO1xuICAgICAgICAgICAgcmV0dXJuIGEuQUJTT0xVVEVfUEFUVC50ZXN0KGIpID8gYy5hYnNvbHV0ZSA9ICEwIDogYS5SRUxBVElWRV9QQVRULnRlc3QoYikgJiYgKGMucmVsYXRpdmUgPSAhMCksIChlID0gYi5tYXRjaChhLkVYVEVOU0lPTl9QQVRUKSkgJiYgKGMuZXh0ZW5zaW9uID0gZVsxXS50b0xvd2VyQ2FzZSgpKSwgY1xuICAgICAgICB9LCBhLmZvcm1hdFF1ZXJ5U3RyaW5nID0gZnVuY3Rpb24oYSwgYikge1xuICAgICAgICAgICAgaWYgKG51bGwgPT0gYSkgdGhyb3cgbmV3IEVycm9yKFwiWW91IG11c3Qgc3BlY2lmeSBkYXRhLlwiKTtcbiAgICAgICAgICAgIHZhciBjID0gW107XG4gICAgICAgICAgICBmb3IgKHZhciBkIGluIGEpIGMucHVzaChkICsgXCI9XCIgKyBlc2NhcGUoYVtkXSkpO1xuICAgICAgICAgICAgcmV0dXJuIGIgJiYgKGMgPSBjLmNvbmNhdChiKSksIGMuam9pbihcIiZcIilcbiAgICAgICAgfSwgYS5idWlsZFBhdGggPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgICBpZiAobnVsbCA9PSBiKSByZXR1cm4gYTtcbiAgICAgICAgICAgIHZhciBjID0gW10sXG4gICAgICAgICAgICAgICAgZCA9IGEuaW5kZXhPZihcIj9cIik7XG4gICAgICAgICAgICBpZiAoLTEgIT0gZCkge1xuICAgICAgICAgICAgICAgIHZhciBlID0gYS5zbGljZShkICsgMSk7XG4gICAgICAgICAgICAgICAgYyA9IGMuY29uY2F0KGUuc3BsaXQoXCImXCIpKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIC0xICE9IGQgPyBhLnNsaWNlKDAsIGQpICsgXCI/XCIgKyB0aGlzLmZvcm1hdFF1ZXJ5U3RyaW5nKGIsIGMpIDogYSArIFwiP1wiICsgdGhpcy5mb3JtYXRRdWVyeVN0cmluZyhiLCBjKVxuICAgICAgICB9LCBhLmlzQ3Jvc3NEb21haW4gPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICB2YXIgYiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xuICAgICAgICAgICAgYi5ocmVmID0gYS5zcmM7XG4gICAgICAgICAgICB2YXIgYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xuICAgICAgICAgICAgYy5ocmVmID0gbG9jYXRpb24uaHJlZjtcbiAgICAgICAgICAgIHZhciBkID0gXCJcIiAhPSBiLmhvc3RuYW1lICYmIChiLnBvcnQgIT0gYy5wb3J0IHx8IGIucHJvdG9jb2wgIT0gYy5wcm90b2NvbCB8fCBiLmhvc3RuYW1lICE9IGMuaG9zdG5hbWUpO1xuICAgICAgICAgICAgcmV0dXJuIGRcbiAgICAgICAgfSwgYS5pc0xvY2FsID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgdmFyIGIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcbiAgICAgICAgICAgIHJldHVybiBiLmhyZWYgPSBhLnNyYywgXCJcIiA9PSBiLmhvc3RuYW1lICYmIFwiZmlsZTpcIiA9PSBiLnByb3RvY29sXG4gICAgICAgIH0sIGEuaXNCaW5hcnkgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKGEpIHtcbiAgICAgICAgICAgICAgICBjYXNlIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLklNQUdFOlxuICAgICAgICAgICAgICAgIGNhc2UgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuQklOQVJZOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gITA7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGEuaXNJbWFnZVRhZyA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudFxuICAgICAgICB9LCBhLmlzQXVkaW9UYWcgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICByZXR1cm4gd2luZG93LkhUTUxBdWRpb0VsZW1lbnQgPyBhIGluc3RhbmNlb2YgSFRNTEF1ZGlvRWxlbWVudCA6ICExXG4gICAgICAgIH0sIGEuaXNWaWRlb1RhZyA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIHJldHVybiB3aW5kb3cuSFRNTFZpZGVvRWxlbWVudCA/IGEgaW5zdGFuY2VvZiBIVE1MVmlkZW9FbGVtZW50IDogITFcbiAgICAgICAgfSwgYS5pc1RleHQgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKGEpIHtcbiAgICAgICAgICAgICAgICBjYXNlIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlRFWFQ6XG4gICAgICAgICAgICAgICAgY2FzZSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5KU09OOlxuICAgICAgICAgICAgICAgIGNhc2UgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuTUFOSUZFU1Q6XG4gICAgICAgICAgICAgICAgY2FzZSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5YTUw6XG4gICAgICAgICAgICAgICAgY2FzZSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5DU1M6XG4gICAgICAgICAgICAgICAgY2FzZSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5TVkc6XG4gICAgICAgICAgICAgICAgY2FzZSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5KQVZBU0NSSVBUOlxuICAgICAgICAgICAgICAgIGNhc2UgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuU1BSSVRFU0hFRVQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAhMDtcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gITFcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgYS5nZXRUeXBlQnlFeHRlbnNpb24gPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICBpZiAobnVsbCA9PSBhKSByZXR1cm4gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuVEVYVDtcbiAgICAgICAgICAgIHN3aXRjaCAoYS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcImpwZWdcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwianBnXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcImdpZlwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJwbmdcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwid2VicFwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJibXBcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLklNQUdFO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJvZ2dcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwibXAzXCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcIndlYm1cIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlNPVU5EO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJtcDRcIjpcbiAgICAgICAgICAgICAgICBjYXNlIFwid2VibVwiOlxuICAgICAgICAgICAgICAgIGNhc2UgXCJ0c1wiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuVklERU87XG4gICAgICAgICAgICAgICAgY2FzZSBcImpzb25cIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkpTT047XG4gICAgICAgICAgICAgICAgY2FzZSBcInhtbFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuWE1MO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJjc3NcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkNTUztcbiAgICAgICAgICAgICAgICBjYXNlIFwianNcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkpBVkFTQ1JJUFQ7XG4gICAgICAgICAgICAgICAgY2FzZSBcInN2Z1wiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuU1ZHO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5URVhUXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGNyZWF0ZWpzLlJlcXVlc3RVdGlscyA9IGFcbiAgICB9KCksIHRoaXMuY3JlYXRlanMgPSB0aGlzLmNyZWF0ZWpzIHx8IHt9LFxuICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgICAgICBmdW5jdGlvbiBBYnN0cmFjdExvYWRlcihhLCBiLCBjKSB7XG4gICAgICAgICAgICB0aGlzLkV2ZW50RGlzcGF0Y2hlcl9jb25zdHJ1Y3RvcigpLCB0aGlzLmxvYWRlZCA9ICExLCB0aGlzLmNhbmNlbGVkID0gITEsIHRoaXMucHJvZ3Jlc3MgPSAwLCB0aGlzLnR5cGUgPSBjLCB0aGlzLnJlc3VsdEZvcm1hdHRlciA9IG51bGwsIHRoaXMuX2l0ZW0gPSBhID8gY3JlYXRlanMuTG9hZEl0ZW0uY3JlYXRlKGEpIDogbnVsbCwgdGhpcy5fcHJlZmVyWEhSID0gYiwgdGhpcy5fcmVzdWx0ID0gbnVsbCwgdGhpcy5fcmF3UmVzdWx0ID0gbnVsbCwgdGhpcy5fbG9hZGVkSXRlbXMgPSBudWxsLCB0aGlzLl90YWdTcmNBdHRyaWJ1dGUgPSBudWxsLCB0aGlzLl90YWcgPSBudWxsXG4gICAgICAgIH1cbiAgICAgICAgdmFyIGEgPSBjcmVhdGVqcy5leHRlbmQoQWJzdHJhY3RMb2FkZXIsIGNyZWF0ZWpzLkV2ZW50RGlzcGF0Y2hlciksXG4gICAgICAgICAgICBiID0gQWJzdHJhY3RMb2FkZXI7XG4gICAgICAgIGIuUE9TVCA9IFwiUE9TVFwiLCBiLkdFVCA9IFwiR0VUXCIsIGIuQklOQVJZID0gXCJiaW5hcnlcIiwgYi5DU1MgPSBcImNzc1wiLCBiLklNQUdFID0gXCJpbWFnZVwiLCBiLkpBVkFTQ1JJUFQgPSBcImphdmFzY3JpcHRcIiwgYi5KU09OID0gXCJqc29uXCIsIGIuSlNPTlAgPSBcImpzb25wXCIsIGIuTUFOSUZFU1QgPSBcIm1hbmlmZXN0XCIsIGIuU09VTkQgPSBcInNvdW5kXCIsIGIuVklERU8gPSBcInZpZGVvXCIsIGIuU1BSSVRFU0hFRVQgPSBcInNwcml0ZXNoZWV0XCIsIGIuU1ZHID0gXCJzdmdcIiwgYi5URVhUID0gXCJ0ZXh0XCIsIGIuWE1MID0gXCJ4bWxcIiwgYS5nZXRJdGVtID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5faXRlbVxuICAgICAgICB9LCBhLmdldFJlc3VsdCA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIHJldHVybiBhID8gdGhpcy5fcmF3UmVzdWx0IDogdGhpcy5fcmVzdWx0XG4gICAgICAgIH0sIGEuZ2V0VGFnID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdGFnXG4gICAgICAgIH0sIGEuc2V0VGFnID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgdGhpcy5fdGFnID0gYVxuICAgICAgICB9LCBhLmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVJlcXVlc3QoKSwgdGhpcy5fcmVxdWVzdC5vbihcImNvbXBsZXRlXCIsIHRoaXMsIHRoaXMpLCB0aGlzLl9yZXF1ZXN0Lm9uKFwicHJvZ3Jlc3NcIiwgdGhpcywgdGhpcyksIHRoaXMuX3JlcXVlc3Qub24oXCJsb2FkU3RhcnRcIiwgdGhpcywgdGhpcyksIHRoaXMuX3JlcXVlc3Qub24oXCJhYm9ydFwiLCB0aGlzLCB0aGlzKSwgdGhpcy5fcmVxdWVzdC5vbihcInRpbWVvdXRcIiwgdGhpcywgdGhpcyksIHRoaXMuX3JlcXVlc3Qub24oXCJlcnJvclwiLCB0aGlzLCB0aGlzKTtcbiAgICAgICAgICAgIHZhciBhID0gbmV3IGNyZWF0ZWpzLkV2ZW50KFwiaW5pdGlhbGl6ZVwiKTtcbiAgICAgICAgICAgIGEubG9hZGVyID0gdGhpcy5fcmVxdWVzdCwgdGhpcy5kaXNwYXRjaEV2ZW50KGEpLCB0aGlzLl9yZXF1ZXN0LmxvYWQoKVxuICAgICAgICB9LCBhLmNhbmNlbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5jYW5jZWxlZCA9ICEwLCB0aGlzLmRlc3Ryb3koKVxuICAgICAgICB9LCBhLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuX3JlcXVlc3QgJiYgKHRoaXMuX3JlcXVlc3QucmVtb3ZlQWxsRXZlbnRMaXN0ZW5lcnMoKSwgdGhpcy5fcmVxdWVzdC5kZXN0cm95KCkpLCB0aGlzLl9yZXF1ZXN0ID0gbnVsbCwgdGhpcy5faXRlbSA9IG51bGwsIHRoaXMuX3Jhd1Jlc3VsdCA9IG51bGwsIHRoaXMuX3Jlc3VsdCA9IG51bGwsIHRoaXMuX2xvYWRJdGVtcyA9IG51bGwsIHRoaXMucmVtb3ZlQWxsRXZlbnRMaXN0ZW5lcnMoKVxuICAgICAgICB9LCBhLmdldExvYWRlZEl0ZW1zID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbG9hZGVkSXRlbXNcbiAgICAgICAgfSwgYS5fY3JlYXRlUmVxdWVzdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5fcmVxdWVzdCA9IHRoaXMuX3ByZWZlclhIUiA/IG5ldyBjcmVhdGVqcy5YSFJSZXF1ZXN0KHRoaXMuX2l0ZW0pIDogbmV3IGNyZWF0ZWpzLlRhZ1JlcXVlc3QodGhpcy5faXRlbSwgdGhpcy5fdGFnIHx8IHRoaXMuX2NyZWF0ZVRhZygpLCB0aGlzLl90YWdTcmNBdHRyaWJ1dGUpXG4gICAgICAgIH0sIGEuX2NyZWF0ZVRhZyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgfSwgYS5fc2VuZExvYWRTdGFydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5faXNDYW5jZWxlZCgpIHx8IHRoaXMuZGlzcGF0Y2hFdmVudChcImxvYWRzdGFydFwiKVxuICAgICAgICB9LCBhLl9zZW5kUHJvZ3Jlc3MgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2lzQ2FuY2VsZWQoKSkge1xuICAgICAgICAgICAgICAgIHZhciBiID0gbnVsbDtcbiAgICAgICAgICAgICAgICBcIm51bWJlclwiID09IHR5cGVvZiBhID8gKHRoaXMucHJvZ3Jlc3MgPSBhLCBiID0gbmV3IGNyZWF0ZWpzLlByb2dyZXNzRXZlbnQodGhpcy5wcm9ncmVzcykpIDogKGIgPSBhLCB0aGlzLnByb2dyZXNzID0gYS5sb2FkZWQgLyBhLnRvdGFsLCBiLnByb2dyZXNzID0gdGhpcy5wcm9ncmVzcywgKGlzTmFOKHRoaXMucHJvZ3Jlc3MpIHx8IDEgLyAwID09IHRoaXMucHJvZ3Jlc3MpICYmICh0aGlzLnByb2dyZXNzID0gMCkpLCB0aGlzLmhhc0V2ZW50TGlzdGVuZXIoXCJwcm9ncmVzc1wiKSAmJiB0aGlzLmRpc3BhdGNoRXZlbnQoYilcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgYS5fc2VuZENvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2lzQ2FuY2VsZWQoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9hZGVkID0gITA7XG4gICAgICAgICAgICAgICAgdmFyIGEgPSBuZXcgY3JlYXRlanMuRXZlbnQoXCJjb21wbGV0ZVwiKTtcbiAgICAgICAgICAgICAgICBhLnJhd1Jlc3VsdCA9IHRoaXMuX3Jhd1Jlc3VsdCwgbnVsbCAhPSB0aGlzLl9yZXN1bHQgJiYgKGEucmVzdWx0ID0gdGhpcy5fcmVzdWx0KSwgdGhpcy5kaXNwYXRjaEV2ZW50KGEpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGEuX3NlbmRFcnJvciA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgICF0aGlzLl9pc0NhbmNlbGVkKCkgJiYgdGhpcy5oYXNFdmVudExpc3RlbmVyKFwiZXJyb3JcIikgJiYgKG51bGwgPT0gYSAmJiAoYSA9IG5ldyBjcmVhdGVqcy5FcnJvckV2ZW50KFwiUFJFTE9BRF9FUlJPUl9FTVBUWVwiKSksIHRoaXMuZGlzcGF0Y2hFdmVudChhKSlcbiAgICAgICAgfSwgYS5faXNDYW5jZWxlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGwgPT0gd2luZG93LmNyZWF0ZWpzIHx8IHRoaXMuY2FuY2VsZWQgPyAhMCA6ICExXG4gICAgICAgIH0sIGEucmVzdWx0Rm9ybWF0dGVyID0gbnVsbCwgYS5oYW5kbGVFdmVudCA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoYS50eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcImNvbXBsZXRlXCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jhd1Jlc3VsdCA9IGEudGFyZ2V0Ll9yZXNwb25zZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnJlc3VsdEZvcm1hdHRlciAmJiB0aGlzLnJlc3VsdEZvcm1hdHRlcih0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgYiBpbnN0YW5jZW9mIEZ1bmN0aW9uID8gYi5jYWxsKHRoaXMsIGNyZWF0ZWpzLnByb3h5KHRoaXMuX3Jlc3VsdEZvcm1hdFN1Y2Nlc3MsIHRoaXMpLCBjcmVhdGVqcy5wcm94eSh0aGlzLl9yZXN1bHRGb3JtYXRGYWlsZWQsIHRoaXMpKSA6ICh0aGlzLl9yZXN1bHQgPSBiIHx8IHRoaXMuX3Jhd1Jlc3VsdCwgdGhpcy5fc2VuZENvbXBsZXRlKCkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwicHJvZ3Jlc3NcIjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VuZFByb2dyZXNzKGEpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiZXJyb3JcIjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VuZEVycm9yKGEpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwibG9hZHN0YXJ0XCI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbmRMb2FkU3RhcnQoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcImFib3J0XCI6XG4gICAgICAgICAgICAgICAgY2FzZSBcInRpbWVvdXRcIjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNDYW5jZWxlZCgpIHx8IHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgY3JlYXRlanMuRXJyb3JFdmVudChcIlBSRUxPQURfXCIgKyBhLnR5cGUudG9VcHBlckNhc2UoKSArIFwiX0VSUk9SXCIpKVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCBhLl9yZXN1bHRGb3JtYXRTdWNjZXNzID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgdGhpcy5fcmVzdWx0ID0gYSwgdGhpcy5fc2VuZENvbXBsZXRlKClcbiAgICAgICAgfSwgYS5fcmVzdWx0Rm9ybWF0RmFpbGVkID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgdGhpcy5fc2VuZEVycm9yKGEpXG4gICAgICAgIH0sIGEuYnVpbGRQYXRoID0gZnVuY3Rpb24oYSwgYikge1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZWpzLlJlcXVlc3RVdGlscy5idWlsZFBhdGgoYSwgYilcbiAgICAgICAgfSwgYS50b1N0cmluZyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIFwiW1ByZWxvYWRKUyBBYnN0cmFjdExvYWRlcl1cIlxuICAgICAgICB9LCBjcmVhdGVqcy5BYnN0cmFjdExvYWRlciA9IGNyZWF0ZWpzLnByb21vdGUoQWJzdHJhY3RMb2FkZXIsIFwiRXZlbnREaXNwYXRjaGVyXCIpXG4gICAgfSgpLCB0aGlzLmNyZWF0ZWpzID0gdGhpcy5jcmVhdGVqcyB8fCB7fSxcbiAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAgICAgZnVuY3Rpb24gQWJzdHJhY3RNZWRpYUxvYWRlcihhLCBiLCBjKSB7XG4gICAgICAgICAgICB0aGlzLkFic3RyYWN0TG9hZGVyX2NvbnN0cnVjdG9yKGEsIGIsIGMpLCB0aGlzLnJlc3VsdEZvcm1hdHRlciA9IHRoaXMuX2Zvcm1hdFJlc3VsdCwgdGhpcy5fdGFnU3JjQXR0cmlidXRlID0gXCJzcmNcIiwgdGhpcy5vbihcImluaXRpYWxpemVcIiwgdGhpcy5fdXBkYXRlWEhSLCB0aGlzKVxuICAgICAgICB9XG4gICAgICAgIHZhciBhID0gY3JlYXRlanMuZXh0ZW5kKEFic3RyYWN0TWVkaWFMb2FkZXIsIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyKTtcbiAgICAgICAgYS5sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLl90YWcgfHwgKHRoaXMuX3RhZyA9IHRoaXMuX2NyZWF0ZVRhZyh0aGlzLl9pdGVtLnNyYykpLCB0aGlzLl90YWcucHJlbG9hZCA9IFwiYXV0b1wiLCB0aGlzLl90YWcubG9hZCgpLCB0aGlzLkFic3RyYWN0TG9hZGVyX2xvYWQoKVxuICAgICAgICB9LCBhLl9jcmVhdGVUYWcgPSBmdW5jdGlvbigpIHt9LCBhLl9jcmVhdGVSZXF1ZXN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLl9yZXF1ZXN0ID0gdGhpcy5fcHJlZmVyWEhSID8gbmV3IGNyZWF0ZWpzLlhIUlJlcXVlc3QodGhpcy5faXRlbSkgOiBuZXcgY3JlYXRlanMuTWVkaWFUYWdSZXF1ZXN0KHRoaXMuX2l0ZW0sIHRoaXMuX3RhZyB8fCB0aGlzLl9jcmVhdGVUYWcoKSwgdGhpcy5fdGFnU3JjQXR0cmlidXRlKVxuICAgICAgICB9LCBhLl91cGRhdGVYSFIgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICBhLmxvYWRlci5zZXRSZXNwb25zZVR5cGUgJiYgYS5sb2FkZXIuc2V0UmVzcG9uc2VUeXBlKFwiYmxvYlwiKVxuICAgICAgICB9LCBhLl9mb3JtYXRSZXN1bHQgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fdGFnLnJlbW92ZUV2ZW50TGlzdGVuZXIgJiYgdGhpcy5fdGFnLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjYW5wbGF5dGhyb3VnaFwiLCB0aGlzLl9sb2FkZWRIYW5kbGVyKSwgdGhpcy5fdGFnLm9uc3RhbGxlZCA9IG51bGwsIHRoaXMuX3ByZWZlclhIUikge1xuICAgICAgICAgICAgICAgIHZhciBiID0gd2luZG93LlVSTCB8fCB3aW5kb3cud2Via2l0VVJMLFxuICAgICAgICAgICAgICAgICAgICBjID0gYS5nZXRSZXN1bHQoITApO1xuICAgICAgICAgICAgICAgIGEuZ2V0VGFnKCkuc3JjID0gYi5jcmVhdGVPYmplY3RVUkwoYylcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhLmdldFRhZygpXG4gICAgICAgIH0sIGNyZWF0ZWpzLkFic3RyYWN0TWVkaWFMb2FkZXIgPSBjcmVhdGVqcy5wcm9tb3RlKEFic3RyYWN0TWVkaWFMb2FkZXIsIFwiQWJzdHJhY3RMb2FkZXJcIilcbiAgICB9KCksIHRoaXMuY3JlYXRlanMgPSB0aGlzLmNyZWF0ZWpzIHx8IHt9LFxuICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgdmFyIEFic3RyYWN0UmVxdWVzdCA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pdGVtID0gYVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGEgPSBjcmVhdGVqcy5leHRlbmQoQWJzdHJhY3RSZXF1ZXN0LCBjcmVhdGVqcy5FdmVudERpc3BhdGNoZXIpO1xuICAgICAgICBhLmxvYWQgPSBmdW5jdGlvbigpIHt9LCBhLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHt9LCBhLmNhbmNlbCA9IGZ1bmN0aW9uKCkge30sIGNyZWF0ZWpzLkFic3RyYWN0UmVxdWVzdCA9IGNyZWF0ZWpzLnByb21vdGUoQWJzdHJhY3RSZXF1ZXN0LCBcIkV2ZW50RGlzcGF0Y2hlclwiKVxuICAgIH0oKSwgdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanMgfHwge30sXG4gICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgICAgIGZ1bmN0aW9uIFRhZ1JlcXVlc3QoYSwgYiwgYykge1xuICAgICAgICAgICAgdGhpcy5BYnN0cmFjdFJlcXVlc3RfY29uc3RydWN0b3IoYSksIHRoaXMuX3RhZyA9IGIsIHRoaXMuX3RhZ1NyY0F0dHJpYnV0ZSA9IGMsIHRoaXMuX2xvYWRlZEhhbmRsZXIgPSBjcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVUYWdDb21wbGV0ZSwgdGhpcyksIHRoaXMuX2FkZGVkVG9ET00gPSAhMSwgdGhpcy5fc3RhcnRUYWdWaXNpYmlsaXR5ID0gbnVsbFxuICAgICAgICB9XG4gICAgICAgIHZhciBhID0gY3JlYXRlanMuZXh0ZW5kKFRhZ1JlcXVlc3QsIGNyZWF0ZWpzLkFic3RyYWN0UmVxdWVzdCk7XG4gICAgICAgIGEubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5fdGFnLm9ubG9hZCA9IGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZVRhZ0NvbXBsZXRlLCB0aGlzKSwgdGhpcy5fdGFnLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZVJlYWR5U3RhdGVDaGFuZ2UsIHRoaXMpLCB0aGlzLl90YWcub25lcnJvciA9IGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZUVycm9yLCB0aGlzKTtcbiAgICAgICAgICAgIHZhciBhID0gbmV3IGNyZWF0ZWpzLkV2ZW50KFwiaW5pdGlhbGl6ZVwiKTtcbiAgICAgICAgICAgIGEubG9hZGVyID0gdGhpcy5fdGFnLCB0aGlzLmRpc3BhdGNoRXZlbnQoYSksIHRoaXMuX2hpZGVUYWcoKSwgdGhpcy5fbG9hZFRpbWVvdXQgPSBzZXRUaW1lb3V0KGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZVRpbWVvdXQsIHRoaXMpLCB0aGlzLl9pdGVtLmxvYWRUaW1lb3V0KSwgdGhpcy5fdGFnW3RoaXMuX3RhZ1NyY0F0dHJpYnV0ZV0gPSB0aGlzLl9pdGVtLnNyYywgbnVsbCA9PSB0aGlzLl90YWcucGFyZW50Tm9kZSAmJiAod2luZG93LmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5fdGFnKSwgdGhpcy5fYWRkZWRUb0RPTSA9ICEwKVxuICAgICAgICB9LCBhLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuX2NsZWFuKCksIHRoaXMuX3RhZyA9IG51bGwsIHRoaXMuQWJzdHJhY3RSZXF1ZXN0X2Rlc3Ryb3koKVxuICAgICAgICB9LCBhLl9oYW5kbGVSZWFkeVN0YXRlQ2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5fbG9hZFRpbWVvdXQpO1xuICAgICAgICAgICAgdmFyIGEgPSB0aGlzLl90YWc7XG4gICAgICAgICAgICAoXCJsb2FkZWRcIiA9PSBhLnJlYWR5U3RhdGUgfHwgXCJjb21wbGV0ZVwiID09IGEucmVhZHlTdGF0ZSkgJiYgdGhpcy5faGFuZGxlVGFnQ29tcGxldGUoKVxuICAgICAgICB9LCBhLl9oYW5kbGVFcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5fY2xlYW4oKSwgdGhpcy5kaXNwYXRjaEV2ZW50KFwiZXJyb3JcIilcbiAgICAgICAgfSwgYS5faGFuZGxlVGFnQ29tcGxldGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuX3Jhd1Jlc3VsdCA9IHRoaXMuX3RhZywgdGhpcy5fcmVzdWx0ID0gdGhpcy5yZXN1bHRGb3JtYXR0ZXIgJiYgdGhpcy5yZXN1bHRGb3JtYXR0ZXIodGhpcykgfHwgdGhpcy5fcmF3UmVzdWx0LCB0aGlzLl9jbGVhbigpLCB0aGlzLl9zaG93VGFnKCksIHRoaXMuZGlzcGF0Y2hFdmVudChcImNvbXBsZXRlXCIpXG4gICAgICAgIH0sIGEuX2hhbmRsZVRpbWVvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuX2NsZWFuKCksIHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgY3JlYXRlanMuRXZlbnQoXCJ0aW1lb3V0XCIpKVxuICAgICAgICB9LCBhLl9jbGVhbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5fdGFnLm9ubG9hZCA9IG51bGwsIHRoaXMuX3RhZy5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBudWxsLCB0aGlzLl90YWcub25lcnJvciA9IG51bGwsIHRoaXMuX2FkZGVkVG9ET00gJiYgbnVsbCAhPSB0aGlzLl90YWcucGFyZW50Tm9kZSAmJiB0aGlzLl90YWcucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLl90YWcpLCBjbGVhclRpbWVvdXQodGhpcy5fbG9hZFRpbWVvdXQpXG4gICAgICAgIH0sIGEuX2hpZGVUYWcgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuX3N0YXJ0VGFnVmlzaWJpbGl0eSA9IHRoaXMuX3RhZy5zdHlsZS52aXNpYmlsaXR5LCB0aGlzLl90YWcuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCJcbiAgICAgICAgfSwgYS5fc2hvd1RhZyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5fdGFnLnN0eWxlLnZpc2liaWxpdHkgPSB0aGlzLl9zdGFydFRhZ1Zpc2liaWxpdHlcbiAgICAgICAgfSwgYS5faGFuZGxlU3RhbGxlZCA9IGZ1bmN0aW9uKCkge30sIGNyZWF0ZWpzLlRhZ1JlcXVlc3QgPSBjcmVhdGVqcy5wcm9tb3RlKFRhZ1JlcXVlc3QsIFwiQWJzdHJhY3RSZXF1ZXN0XCIpXG4gICAgfSgpLCB0aGlzLmNyZWF0ZWpzID0gdGhpcy5jcmVhdGVqcyB8fCB7fSxcbiAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAgICAgZnVuY3Rpb24gTWVkaWFUYWdSZXF1ZXN0KGEsIGIsIGMpIHtcbiAgICAgICAgICAgIHRoaXMuQWJzdHJhY3RSZXF1ZXN0X2NvbnN0cnVjdG9yKGEpLCB0aGlzLl90YWcgPSBiLCB0aGlzLl90YWdTcmNBdHRyaWJ1dGUgPSBjLCB0aGlzLl9sb2FkZWRIYW5kbGVyID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlVGFnQ29tcGxldGUsIHRoaXMpXG4gICAgICAgIH1cbiAgICAgICAgdmFyIGEgPSBjcmVhdGVqcy5leHRlbmQoTWVkaWFUYWdSZXF1ZXN0LCBjcmVhdGVqcy5UYWdSZXF1ZXN0KTtcbiAgICAgICAgYS5sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgYSA9IGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZVN0YWxsZWQsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5fc3RhbGxlZENhbGxiYWNrID0gYTtcbiAgICAgICAgICAgIHZhciBiID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlUHJvZ3Jlc3MsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlUHJvZ3Jlc3MgPSBiLCB0aGlzLl90YWcuYWRkRXZlbnRMaXN0ZW5lcihcInN0YWxsZWRcIiwgYSksIHRoaXMuX3RhZy5hZGRFdmVudExpc3RlbmVyKFwicHJvZ3Jlc3NcIiwgYiksIHRoaXMuX3RhZy5hZGRFdmVudExpc3RlbmVyICYmIHRoaXMuX3RhZy5hZGRFdmVudExpc3RlbmVyKFwiY2FucGxheXRocm91Z2hcIiwgdGhpcy5fbG9hZGVkSGFuZGxlciwgITEpLCB0aGlzLlRhZ1JlcXVlc3RfbG9hZCgpXG4gICAgICAgIH0sIGEuX2hhbmRsZVJlYWR5U3RhdGVDaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9sb2FkVGltZW91dCk7XG4gICAgICAgICAgICB2YXIgYSA9IHRoaXMuX3RhZztcbiAgICAgICAgICAgIChcImxvYWRlZFwiID09IGEucmVhZHlTdGF0ZSB8fCBcImNvbXBsZXRlXCIgPT0gYS5yZWFkeVN0YXRlKSAmJiB0aGlzLl9oYW5kbGVUYWdDb21wbGV0ZSgpXG4gICAgICAgIH0sIGEuX2hhbmRsZVN0YWxsZWQgPSBmdW5jdGlvbigpIHt9LCBhLl9oYW5kbGVQcm9ncmVzcyA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIGlmIChhICYmICEoYS5sb2FkZWQgPiAwICYmIDAgPT0gYS50b3RhbCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgYiA9IG5ldyBjcmVhdGVqcy5Qcm9ncmVzc0V2ZW50KGEubG9hZGVkLCBhLnRvdGFsKTtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYilcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgYS5fY2xlYW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuX3RhZy5yZW1vdmVFdmVudExpc3RlbmVyICYmIHRoaXMuX3RhZy5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2FucGxheXRocm91Z2hcIiwgdGhpcy5fbG9hZGVkSGFuZGxlciksIHRoaXMuX3RhZy5yZW1vdmVFdmVudExpc3RlbmVyKFwic3RhbGxlZFwiLCB0aGlzLl9zdGFsbGVkQ2FsbGJhY2spLCB0aGlzLl90YWcucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInByb2dyZXNzXCIsIHRoaXMuX3Byb2dyZXNzQ2FsbGJhY2spLCB0aGlzLlRhZ1JlcXVlc3RfX2NsZWFuKClcbiAgICAgICAgfSwgY3JlYXRlanMuTWVkaWFUYWdSZXF1ZXN0ID0gY3JlYXRlanMucHJvbW90ZShNZWRpYVRhZ1JlcXVlc3QsIFwiVGFnUmVxdWVzdFwiKVxuICAgIH0oKSwgdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanMgfHwge30sXG4gICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgICAgIGZ1bmN0aW9uIFhIUlJlcXVlc3QoYSkge1xuICAgICAgICAgICAgdGhpcy5BYnN0cmFjdFJlcXVlc3RfY29uc3RydWN0b3IoYSksIHRoaXMuX3JlcXVlc3QgPSBudWxsLCB0aGlzLl9sb2FkVGltZW91dCA9IG51bGwsIHRoaXMuX3hockxldmVsID0gMSwgdGhpcy5fcmVzcG9uc2UgPSBudWxsLCB0aGlzLl9yYXdSZXNwb25zZSA9IG51bGwsIHRoaXMuX2NhbmNlbGVkID0gITEsIHRoaXMuX2hhbmRsZUxvYWRTdGFydFByb3h5ID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlTG9hZFN0YXJ0LCB0aGlzKSwgdGhpcy5faGFuZGxlUHJvZ3Jlc3NQcm94eSA9IGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZVByb2dyZXNzLCB0aGlzKSwgdGhpcy5faGFuZGxlQWJvcnRQcm94eSA9IGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZUFib3J0LCB0aGlzKSwgdGhpcy5faGFuZGxlRXJyb3JQcm94eSA9IGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZUVycm9yLCB0aGlzKSwgdGhpcy5faGFuZGxlVGltZW91dFByb3h5ID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlVGltZW91dCwgdGhpcyksIHRoaXMuX2hhbmRsZUxvYWRQcm94eSA9IGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZUxvYWQsIHRoaXMpLCB0aGlzLl9oYW5kbGVSZWFkeVN0YXRlQ2hhbmdlUHJveHkgPSBjcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVSZWFkeVN0YXRlQ2hhbmdlLCB0aGlzKSwgIXRoaXMuX2NyZWF0ZVhIUihhKVxuICAgICAgICB9XG4gICAgICAgIHZhciBhID0gY3JlYXRlanMuZXh0ZW5kKFhIUlJlcXVlc3QsIGNyZWF0ZWpzLkFic3RyYWN0UmVxdWVzdCk7XG4gICAgICAgIFhIUlJlcXVlc3QuQUNUSVZFWF9WRVJTSU9OUyA9IFtcIk1zeG1sMi5YTUxIVFRQLjYuMFwiLCBcIk1zeG1sMi5YTUxIVFRQLjUuMFwiLCBcIk1zeG1sMi5YTUxIVFRQLjQuMFwiLCBcIk1TWE1MMi5YTUxIVFRQLjMuMFwiLCBcIk1TWE1MMi5YTUxIVFRQXCIsIFwiTWljcm9zb2Z0LlhNTEhUVFBcIl0sIGEuZ2V0UmVzdWx0ID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgcmV0dXJuIGEgJiYgdGhpcy5fcmF3UmVzcG9uc2UgPyB0aGlzLl9yYXdSZXNwb25zZSA6IHRoaXMuX3Jlc3BvbnNlXG4gICAgICAgIH0sIGEuY2FuY2VsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmNhbmNlbGVkID0gITAsIHRoaXMuX2NsZWFuKCksIHRoaXMuX3JlcXVlc3QuYWJvcnQoKVxuICAgICAgICB9LCBhLmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChudWxsID09IHRoaXMuX3JlcXVlc3QpIHJldHVybiB2b2lkIHRoaXMuX2hhbmRsZUVycm9yKCk7XG4gICAgICAgICAgICBudWxsICE9IHRoaXMuX3JlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lciA/ICh0aGlzLl9yZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2Fkc3RhcnRcIiwgdGhpcy5faGFuZGxlTG9hZFN0YXJ0UHJveHksICExKSwgdGhpcy5fcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKFwicHJvZ3Jlc3NcIiwgdGhpcy5faGFuZGxlUHJvZ3Jlc3NQcm94eSwgITEpLCB0aGlzLl9yZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJhYm9ydFwiLCB0aGlzLl9oYW5kbGVBYm9ydFByb3h5LCAhMSksIHRoaXMuX3JlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsIHRoaXMuX2hhbmRsZUVycm9yUHJveHksICExKSwgdGhpcy5fcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKFwidGltZW91dFwiLCB0aGlzLl9oYW5kbGVUaW1lb3V0UHJveHksICExKSwgdGhpcy5fcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCB0aGlzLl9oYW5kbGVMb2FkUHJveHksICExKSwgdGhpcy5fcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKFwicmVhZHlzdGF0ZWNoYW5nZVwiLCB0aGlzLl9oYW5kbGVSZWFkeVN0YXRlQ2hhbmdlUHJveHksICExKSkgOiAodGhpcy5fcmVxdWVzdC5vbmxvYWRzdGFydCA9IHRoaXMuX2hhbmRsZUxvYWRTdGFydFByb3h5LCB0aGlzLl9yZXF1ZXN0Lm9ucHJvZ3Jlc3MgPSB0aGlzLl9oYW5kbGVQcm9ncmVzc1Byb3h5LCB0aGlzLl9yZXF1ZXN0Lm9uYWJvcnQgPSB0aGlzLl9oYW5kbGVBYm9ydFByb3h5LCB0aGlzLl9yZXF1ZXN0Lm9uZXJyb3IgPSB0aGlzLl9oYW5kbGVFcnJvclByb3h5LCB0aGlzLl9yZXF1ZXN0Lm9udGltZW91dCA9IHRoaXMuX2hhbmRsZVRpbWVvdXRQcm94eSwgdGhpcy5fcmVxdWVzdC5vbmxvYWQgPSB0aGlzLl9oYW5kbGVMb2FkUHJveHksIHRoaXMuX3JlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gdGhpcy5faGFuZGxlUmVhZHlTdGF0ZUNoYW5nZVByb3h5KSwgMSA9PSB0aGlzLl94aHJMZXZlbCAmJiAodGhpcy5fbG9hZFRpbWVvdXQgPSBzZXRUaW1lb3V0KGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZVRpbWVvdXQsIHRoaXMpLCB0aGlzLl9pdGVtLmxvYWRUaW1lb3V0KSk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW0udmFsdWVzICYmIHRoaXMuX2l0ZW0ubWV0aG9kICE9IGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkdFVCA/IHRoaXMuX2l0ZW0ubWV0aG9kID09IGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlBPU1QgJiYgdGhpcy5fcmVxdWVzdC5zZW5kKGNyZWF0ZWpzLlJlcXVlc3RVdGlscy5mb3JtYXRRdWVyeVN0cmluZyh0aGlzLl9pdGVtLnZhbHVlcykpIDogdGhpcy5fcmVxdWVzdC5zZW5kKClcbiAgICAgICAgICAgIH0gY2F0Y2ggKGEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQobmV3IGNyZWF0ZWpzLkVycm9yRXZlbnQoXCJYSFJfU0VORFwiLCBudWxsLCBhKSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgYS5zZXRSZXNwb25zZVR5cGUgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICBcImJsb2JcIiA9PT0gYSAmJiAoYSA9IHdpbmRvdy5VUkwgPyBcImJsb2JcIiA6IFwiYXJyYXlidWZmZXJcIiwgdGhpcy5fcmVzcG9uc2VUeXBlID0gYSksIHRoaXMuX3JlcXVlc3QucmVzcG9uc2VUeXBlID0gYVxuICAgICAgICB9LCBhLmdldEFsbFJlc3BvbnNlSGVhZGVycyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzIGluc3RhbmNlb2YgRnVuY3Rpb24gPyB0aGlzLl9yZXF1ZXN0LmdldEFsbFJlc3BvbnNlSGVhZGVycygpIDogbnVsbFxuICAgICAgICB9LCBhLmdldFJlc3BvbnNlSGVhZGVyID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QuZ2V0UmVzcG9uc2VIZWFkZXIgaW5zdGFuY2VvZiBGdW5jdGlvbiA/IHRoaXMuX3JlcXVlc3QuZ2V0UmVzcG9uc2VIZWFkZXIoYSkgOiBudWxsXG4gICAgICAgIH0sIGEuX2hhbmRsZVByb2dyZXNzID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgaWYgKGEgJiYgIShhLmxvYWRlZCA+IDAgJiYgMCA9PSBhLnRvdGFsKSkge1xuICAgICAgICAgICAgICAgIHZhciBiID0gbmV3IGNyZWF0ZWpzLlByb2dyZXNzRXZlbnQoYS5sb2FkZWQsIGEudG90YWwpO1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiKVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCBhLl9oYW5kbGVMb2FkU3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9sb2FkVGltZW91dCksIHRoaXMuZGlzcGF0Y2hFdmVudChcImxvYWRzdGFydFwiKVxuICAgICAgICB9LCBhLl9oYW5kbGVBYm9ydCA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIHRoaXMuX2NsZWFuKCksIHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgY3JlYXRlanMuRXJyb3JFdmVudChcIlhIUl9BQk9SVEVEXCIsIG51bGwsIGEpKVxuICAgICAgICB9LCBhLl9oYW5kbGVFcnJvciA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIHRoaXMuX2NsZWFuKCksIHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgY3JlYXRlanMuRXJyb3JFdmVudChhLm1lc3NhZ2UpKVxuICAgICAgICB9LCBhLl9oYW5kbGVSZWFkeVN0YXRlQ2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICA0ID09IHRoaXMuX3JlcXVlc3QucmVhZHlTdGF0ZSAmJiB0aGlzLl9oYW5kbGVMb2FkKClcbiAgICAgICAgfSwgYS5faGFuZGxlTG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmxvYWRlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9hZGVkID0gITA7XG4gICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzLl9jaGVja0Vycm9yKCk7XG4gICAgICAgICAgICAgICAgaWYgKGEpIHJldHVybiB2b2lkIHRoaXMuX2hhbmRsZUVycm9yKGEpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yZXNwb25zZSA9IHRoaXMuX2dldFJlc3BvbnNlKCksIFwiYXJyYXlidWZmZXJcIiA9PT0gdGhpcy5fcmVzcG9uc2VUeXBlKSB0cnkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXNwb25zZSA9IG5ldyBCbG9iKFt0aGlzLl9yZXNwb25zZV0pXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoYikge1xuICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LkJsb2JCdWlsZGVyID0gd2luZG93LkJsb2JCdWlsZGVyIHx8IHdpbmRvdy5XZWJLaXRCbG9iQnVpbGRlciB8fCB3aW5kb3cuTW96QmxvYkJ1aWxkZXIgfHwgd2luZG93Lk1TQmxvYkJ1aWxkZXIsIFwiVHlwZUVycm9yXCIgPT09IGIubmFtZSAmJiB3aW5kb3cuQmxvYkJ1aWxkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjID0gbmV3IEJsb2JCdWlsZGVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgYy5hcHBlbmQodGhpcy5fcmVzcG9uc2UpLCB0aGlzLl9yZXNwb25zZSA9IGMuZ2V0QmxvYigpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fY2xlYW4oKSwgdGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBjcmVhdGVqcy5FdmVudChcImNvbXBsZXRlXCIpKVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCBhLl9oYW5kbGVUaW1lb3V0ID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgdGhpcy5fY2xlYW4oKSwgdGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBjcmVhdGVqcy5FcnJvckV2ZW50KFwiUFJFTE9BRF9USU1FT1VUXCIsIG51bGwsIGEpKVxuICAgICAgICB9LCBhLl9jaGVja0Vycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgYSA9IHBhcnNlSW50KHRoaXMuX3JlcXVlc3Quc3RhdHVzKTtcbiAgICAgICAgICAgIHN3aXRjaCAoYSkge1xuICAgICAgICAgICAgICAgIGNhc2UgNDA0OlxuICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFcnJvcihhKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgfSwgYS5fZ2V0UmVzcG9uc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChudWxsICE9IHRoaXMuX3Jlc3BvbnNlKSByZXR1cm4gdGhpcy5fcmVzcG9uc2U7XG4gICAgICAgICAgICBpZiAobnVsbCAhPSB0aGlzLl9yZXF1ZXN0LnJlc3BvbnNlKSByZXR1cm4gdGhpcy5fcmVxdWVzdC5yZXNwb25zZTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gdGhpcy5fcmVxdWVzdC5yZXNwb25zZVRleHQpIHJldHVybiB0aGlzLl9yZXF1ZXN0LnJlc3BvbnNlVGV4dFxuICAgICAgICAgICAgfSBjYXRjaCAoYSkge31cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gdGhpcy5fcmVxdWVzdC5yZXNwb25zZVhNTCkgcmV0dXJuIHRoaXMuX3JlcXVlc3QucmVzcG9uc2VYTUxcbiAgICAgICAgICAgIH0gY2F0Y2ggKGEpIHt9XG4gICAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICB9LCBhLl9jcmVhdGVYSFIgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICB2YXIgYiA9IGNyZWF0ZWpzLlJlcXVlc3RVdGlscy5pc0Nyb3NzRG9tYWluKGEpLFxuICAgICAgICAgICAgICAgIGMgPSB7fSxcbiAgICAgICAgICAgICAgICBkID0gbnVsbDtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuWE1MSHR0cFJlcXVlc3QpIGQgPSBuZXcgWE1MSHR0cFJlcXVlc3QsIGIgJiYgdm9pZCAwID09PSBkLndpdGhDcmVkZW50aWFscyAmJiB3aW5kb3cuWERvbWFpblJlcXVlc3QgJiYgKGQgPSBuZXcgWERvbWFpblJlcXVlc3QpO1xuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgZSA9IDAsIGYgPSBzLkFDVElWRVhfVkVSU0lPTlMubGVuZ3RoOyBmID4gZTsgZSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBnID0gcy5BQ1RJVkVYX1ZFUlNJT05TW2VdO1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZCA9IG5ldyBBY3RpdmVYT2JqZWN0KGcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoaCkge31cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gZCkgcmV0dXJuICExXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBudWxsID09IGEubWltZVR5cGUgJiYgY3JlYXRlanMuUmVxdWVzdFV0aWxzLmlzVGV4dChhLnR5cGUpICYmIChhLm1pbWVUeXBlID0gXCJ0ZXh0L3BsYWluOyBjaGFyc2V0PXV0Zi04XCIpLCBhLm1pbWVUeXBlICYmIGQub3ZlcnJpZGVNaW1lVHlwZSAmJiBkLm92ZXJyaWRlTWltZVR5cGUoYS5taW1lVHlwZSksIHRoaXMuX3hockxldmVsID0gXCJzdHJpbmdcIiA9PSB0eXBlb2YgZC5yZXNwb25zZVR5cGUgPyAyIDogMTtcbiAgICAgICAgICAgIHZhciBpID0gbnVsbDtcbiAgICAgICAgICAgIGlmIChpID0gYS5tZXRob2QgPT0gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuR0VUID8gY3JlYXRlanMuUmVxdWVzdFV0aWxzLmJ1aWxkUGF0aChhLnNyYywgYS52YWx1ZXMpIDogYS5zcmMsIGQub3BlbihhLm1ldGhvZCB8fCBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5HRVQsIGksICEwKSwgYiAmJiBkIGluc3RhbmNlb2YgWE1MSHR0cFJlcXVlc3QgJiYgMSA9PSB0aGlzLl94aHJMZXZlbCAmJiAoYy5PcmlnaW4gPSBsb2NhdGlvbi5vcmlnaW4pLCBhLnZhbHVlcyAmJiBhLm1ldGhvZCA9PSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5QT1NUICYmIChjW1wiQ29udGVudC1UeXBlXCJdID0gXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIiksIGIgfHwgY1tcIlgtUmVxdWVzdGVkLVdpdGhcIl0gfHwgKGNbXCJYLVJlcXVlc3RlZC1XaXRoXCJdID0gXCJYTUxIdHRwUmVxdWVzdFwiKSwgYS5oZWFkZXJzKVxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogaW4gYS5oZWFkZXJzKSBjW2pdID0gYS5oZWFkZXJzW2pdO1xuICAgICAgICAgICAgZm9yIChqIGluIGMpIGQuc2V0UmVxdWVzdEhlYWRlcihqLCBjW2pdKTtcbiAgICAgICAgICAgIHJldHVybiBkIGluc3RhbmNlb2YgWE1MSHR0cFJlcXVlc3QgJiYgdm9pZCAwICE9PSBhLndpdGhDcmVkZW50aWFscyAmJiAoZC53aXRoQ3JlZGVudGlhbHMgPSBhLndpdGhDcmVkZW50aWFscyksIHRoaXMuX3JlcXVlc3QgPSBkLCAhMFxuICAgICAgICB9LCBhLl9jbGVhbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX2xvYWRUaW1lb3V0KSwgbnVsbCAhPSB0aGlzLl9yZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIgPyAodGhpcy5fcmVxdWVzdC5yZW1vdmVFdmVudExpc3RlbmVyKFwibG9hZHN0YXJ0XCIsIHRoaXMuX2hhbmRsZUxvYWRTdGFydFByb3h5KSwgdGhpcy5fcmVxdWVzdC5yZW1vdmVFdmVudExpc3RlbmVyKFwicHJvZ3Jlc3NcIiwgdGhpcy5faGFuZGxlUHJvZ3Jlc3NQcm94eSksIHRoaXMuX3JlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImFib3J0XCIsIHRoaXMuX2hhbmRsZUFib3J0UHJveHkpLCB0aGlzLl9yZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJlcnJvclwiLCB0aGlzLl9oYW5kbGVFcnJvclByb3h5KSwgdGhpcy5fcmVxdWVzdC5yZW1vdmVFdmVudExpc3RlbmVyKFwidGltZW91dFwiLCB0aGlzLl9oYW5kbGVUaW1lb3V0UHJveHkpLCB0aGlzLl9yZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIHRoaXMuX2hhbmRsZUxvYWRQcm94eSksIHRoaXMuX3JlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInJlYWR5c3RhdGVjaGFuZ2VcIiwgdGhpcy5faGFuZGxlUmVhZHlTdGF0ZUNoYW5nZVByb3h5KSkgOiAodGhpcy5fcmVxdWVzdC5vbmxvYWRzdGFydCA9IG51bGwsIHRoaXMuX3JlcXVlc3Qub25wcm9ncmVzcyA9IG51bGwsIHRoaXMuX3JlcXVlc3Qub25hYm9ydCA9IG51bGwsIHRoaXMuX3JlcXVlc3Qub25lcnJvciA9IG51bGwsIHRoaXMuX3JlcXVlc3Qub250aW1lb3V0ID0gbnVsbCwgdGhpcy5fcmVxdWVzdC5vbmxvYWQgPSBudWxsLCB0aGlzLl9yZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGwpXG4gICAgICAgIH0sIGEudG9TdHJpbmcgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBcIltQcmVsb2FkSlMgWEhSUmVxdWVzdF1cIlxuICAgICAgICB9LCBjcmVhdGVqcy5YSFJSZXF1ZXN0ID0gY3JlYXRlanMucHJvbW90ZShYSFJSZXF1ZXN0LCBcIkFic3RyYWN0UmVxdWVzdFwiKVxuICAgIH0oKSwgdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanMgfHwge30sXG4gICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgICAgIGZ1bmN0aW9uIExvYWRRdWV1ZShhLCBiLCBjKSB7XG4gICAgICAgICAgICB0aGlzLkFic3RyYWN0TG9hZGVyX2NvbnN0cnVjdG9yKCksIHRoaXMuX3BsdWdpbnMgPSBbXSwgdGhpcy5fdHlwZUNhbGxiYWNrcyA9IHt9LCB0aGlzLl9leHRlbnNpb25DYWxsYmFja3MgPSB7fSwgdGhpcy5uZXh0ID0gbnVsbCwgdGhpcy5tYWludGFpblNjcmlwdE9yZGVyID0gITAsIHRoaXMuc3RvcE9uRXJyb3IgPSAhMSwgdGhpcy5fbWF4Q29ubmVjdGlvbnMgPSAxLCB0aGlzLl9hdmFpbGFibGVMb2FkZXJzID0gW2NyZWF0ZWpzLkltYWdlTG9hZGVyLCBjcmVhdGVqcy5KYXZhU2NyaXB0TG9hZGVyLCBjcmVhdGVqcy5DU1NMb2FkZXIsIGNyZWF0ZWpzLkpTT05Mb2FkZXIsIGNyZWF0ZWpzLkpTT05QTG9hZGVyLCBjcmVhdGVqcy5Tb3VuZExvYWRlciwgY3JlYXRlanMuTWFuaWZlc3RMb2FkZXIsIGNyZWF0ZWpzLlNwcml0ZVNoZWV0TG9hZGVyLCBjcmVhdGVqcy5YTUxMb2FkZXIsIGNyZWF0ZWpzLlNWR0xvYWRlciwgY3JlYXRlanMuQmluYXJ5TG9hZGVyLCBjcmVhdGVqcy5WaWRlb0xvYWRlciwgY3JlYXRlanMuVGV4dExvYWRlcl0sIHRoaXMuX2RlZmF1bHRMb2FkZXJMZW5ndGggPSB0aGlzLl9hdmFpbGFibGVMb2FkZXJzLmxlbmd0aCwgdGhpcy5pbml0KGEsIGIsIGMpXG4gICAgICAgIH1cbiAgICAgICAgdmFyIGEgPSBjcmVhdGVqcy5leHRlbmQoTG9hZFF1ZXVlLCBjcmVhdGVqcy5BYnN0cmFjdExvYWRlciksXG4gICAgICAgICAgICBiID0gTG9hZFF1ZXVlO1xuICAgICAgICBhLmluaXQgPSBmdW5jdGlvbihhLCBiLCBjKSB7XG4gICAgICAgICAgICB0aGlzLnVzZVhIUiA9ICEwLCB0aGlzLnByZWZlclhIUiA9ICEwLCB0aGlzLl9wcmVmZXJYSFIgPSAhMCwgdGhpcy5zZXRQcmVmZXJYSFIoYSksIHRoaXMuX3BhdXNlZCA9ICExLCB0aGlzLl9iYXNlUGF0aCA9IGIsIHRoaXMuX2Nyb3NzT3JpZ2luID0gYywgdGhpcy5fbG9hZFN0YXJ0V2FzRGlzcGF0Y2hlZCA9ICExLCB0aGlzLl9jdXJyZW50bHlMb2FkaW5nU2NyaXB0ID0gbnVsbCwgdGhpcy5fY3VycmVudExvYWRzID0gW10sIHRoaXMuX2xvYWRRdWV1ZSA9IFtdLCB0aGlzLl9sb2FkUXVldWVCYWNrdXAgPSBbXSwgdGhpcy5fbG9hZEl0ZW1zQnlJZCA9IHt9LCB0aGlzLl9sb2FkSXRlbXNCeVNyYyA9IHt9LCB0aGlzLl9sb2FkZWRSZXN1bHRzID0ge30sIHRoaXMuX2xvYWRlZFJhd1Jlc3VsdHMgPSB7fSwgdGhpcy5fbnVtSXRlbXMgPSAwLCB0aGlzLl9udW1JdGVtc0xvYWRlZCA9IDAsIHRoaXMuX3NjcmlwdE9yZGVyID0gW10sIHRoaXMuX2xvYWRlZFNjcmlwdHMgPSBbXSwgdGhpcy5fbGFzdFByb2dyZXNzID0gMCAvIDBcbiAgICAgICAgfSwgYi5sb2FkVGltZW91dCA9IDhlMywgYi5MT0FEX1RJTUVPVVQgPSAwLCBiLkJJTkFSWSA9IGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkJJTkFSWSwgYi5DU1MgPSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5DU1MsIGIuSU1BR0UgPSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5JTUFHRSwgYi5KQVZBU0NSSVBUID0gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuSkFWQVNDUklQVCwgYi5KU09OID0gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuSlNPTiwgYi5KU09OUCA9IGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkpTT05QLCBiLk1BTklGRVNUID0gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuTUFOSUZFU1QsIGIuU09VTkQgPSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5TT1VORCwgYi5WSURFTyA9IGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlZJREVPLCBiLlNWRyA9IGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlNWRywgYi5URVhUID0gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuVEVYVCwgYi5YTUwgPSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5YTUwsIGIuUE9TVCA9IGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlBPU1QsIGIuR0VUID0gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuR0VULCBhLnJlZ2lzdGVyTG9hZGVyID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgaWYgKCFhIHx8ICFhLmNhbkxvYWRJdGVtKSB0aHJvdyBuZXcgRXJyb3IoXCJsb2FkZXIgaXMgb2YgYW4gaW5jb3JyZWN0IHR5cGUuXCIpO1xuICAgICAgICAgICAgaWYgKC0xICE9IHRoaXMuX2F2YWlsYWJsZUxvYWRlcnMuaW5kZXhPZihhKSkgdGhyb3cgbmV3IEVycm9yKFwibG9hZGVyIGFscmVhZHkgZXhpc3RzLlwiKTtcbiAgICAgICAgICAgIHRoaXMuX2F2YWlsYWJsZUxvYWRlcnMudW5zaGlmdChhKVxuICAgICAgICB9LCBhLnVucmVnaXN0ZXJMb2FkZXIgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICB2YXIgYiA9IHRoaXMuX2F2YWlsYWJsZUxvYWRlcnMuaW5kZXhPZihhKTsgLSAxICE9IGIgJiYgYiA8IHRoaXMuX2RlZmF1bHRMb2FkZXJMZW5ndGggLSAxICYmIHRoaXMuX2F2YWlsYWJsZUxvYWRlcnMuc3BsaWNlKGIsIDEpXG4gICAgICAgIH0sIGEuc2V0VXNlWEhSID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2V0UHJlZmVyWEhSKGEpXG4gICAgICAgIH0sIGEuc2V0UHJlZmVyWEhSID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJlZmVyWEhSID0gMCAhPSBhICYmIG51bGwgIT0gd2luZG93LlhNTEh0dHBSZXF1ZXN0LCB0aGlzLnByZWZlclhIUlxuICAgICAgICB9LCBhLnJlbW92ZUFsbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmUoKVxuICAgICAgICB9LCBhLnJlbW92ZSA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIHZhciBiID0gbnVsbDtcbiAgICAgICAgICAgIGlmIChhICYmICFBcnJheS5pc0FycmF5KGEpKSBiID0gW2FdO1xuICAgICAgICAgICAgZWxzZSBpZiAoYSkgYiA9IGE7XG4gICAgICAgICAgICBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMCkgcmV0dXJuO1xuICAgICAgICAgICAgdmFyIGMgPSAhMTtcbiAgICAgICAgICAgIGlmIChiKSB7XG4gICAgICAgICAgICAgICAgZm9yICg7IGIubGVuZ3RoOykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IGIucG9wKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBlID0gdGhpcy5nZXRSZXN1bHQoZCk7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IHRoaXMuX2xvYWRRdWV1ZS5sZW5ndGggLSAxOyBmID49IDA7IGYtLSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnID0gdGhpcy5fbG9hZFF1ZXVlW2ZdLmdldEl0ZW0oKSwgZy5pZCA9PSBkIHx8IGcuc3JjID09IGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9sb2FkUXVldWUuc3BsaWNlKGYsIDEpWzBdLmNhbmNlbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZvciAoZiA9IHRoaXMuX2xvYWRRdWV1ZUJhY2t1cC5sZW5ndGggLSAxOyBmID49IDA7IGYtLSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnID0gdGhpcy5fbG9hZFF1ZXVlQmFja3VwW2ZdLmdldEl0ZW0oKSwgZy5pZCA9PSBkIHx8IGcuc3JjID09IGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9sb2FkUXVldWVCYWNrdXAuc3BsaWNlKGYsIDEpWzBdLmNhbmNlbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChlKSB0aGlzLl9kaXNwb3NlSXRlbSh0aGlzLmdldEl0ZW0oZCkpO1xuICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBmID0gdGhpcy5fY3VycmVudExvYWRzLmxlbmd0aCAtIDE7IGYgPj0gMDsgZi0tKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSB0aGlzLl9jdXJyZW50TG9hZHNbZl0uZ2V0SXRlbSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnLmlkID09IGQgfHwgZy5zcmMgPT0gZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50TG9hZHMuc3BsaWNlKGYsIDEpWzBdLmNhbmNlbCgpLCBjID0gITA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjICYmIHRoaXMuX2xvYWROZXh0KClcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGggaW4gdGhpcy5fbG9hZEl0ZW1zQnlJZCkgdGhpcy5fZGlzcG9zZUl0ZW0odGhpcy5fbG9hZEl0ZW1zQnlJZFtoXSk7XG4gICAgICAgICAgICAgICAgdGhpcy5pbml0KHRoaXMucHJlZmVyWEhSLCB0aGlzLl9iYXNlUGF0aClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgYS5yZXNldCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgZm9yICh2YXIgYSBpbiB0aGlzLl9sb2FkSXRlbXNCeUlkKSB0aGlzLl9kaXNwb3NlSXRlbSh0aGlzLl9sb2FkSXRlbXNCeUlkW2FdKTtcbiAgICAgICAgICAgIGZvciAodmFyIGIgPSBbXSwgYyA9IDAsIGQgPSB0aGlzLl9sb2FkUXVldWVCYWNrdXAubGVuZ3RoOyBkID4gYzsgYysrKSBiLnB1c2godGhpcy5fbG9hZFF1ZXVlQmFja3VwW2NdLmdldEl0ZW0oKSk7XG4gICAgICAgICAgICB0aGlzLmxvYWRNYW5pZmVzdChiLCAhMSlcbiAgICAgICAgfSwgYS5pbnN0YWxsUGx1Z2luID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgaWYgKG51bGwgIT0gYSAmJiBudWxsICE9IGEuZ2V0UHJlbG9hZEhhbmRsZXJzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGx1Z2lucy5wdXNoKGEpO1xuICAgICAgICAgICAgICAgIHZhciBiID0gYS5nZXRQcmVsb2FkSGFuZGxlcnMoKTtcbiAgICAgICAgICAgICAgICBpZiAoYi5zY29wZSA9IGEsIG51bGwgIT0gYi50eXBlcylcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IDAsIGQgPSBiLnR5cGVzLmxlbmd0aDsgZCA+IGM7IGMrKykgdGhpcy5fdHlwZUNhbGxiYWNrc1tiLnR5cGVzW2NdXSA9IGI7XG4gICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gYi5leHRlbnNpb25zKVxuICAgICAgICAgICAgICAgICAgICBmb3IgKGMgPSAwLCBkID0gYi5leHRlbnNpb25zLmxlbmd0aDsgZCA+IGM7IGMrKykgdGhpcy5fZXh0ZW5zaW9uQ2FsbGJhY2tzW2IuZXh0ZW5zaW9uc1tjXV0gPSBiXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGEuc2V0TWF4Q29ubmVjdGlvbnMgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICB0aGlzLl9tYXhDb25uZWN0aW9ucyA9IGEsICF0aGlzLl9wYXVzZWQgJiYgdGhpcy5fbG9hZFF1ZXVlLmxlbmd0aCA+IDAgJiYgdGhpcy5fbG9hZE5leHQoKVxuICAgICAgICB9LCBhLmxvYWRGaWxlID0gZnVuY3Rpb24oYSwgYiwgYykge1xuICAgICAgICAgICAgaWYgKG51bGwgPT0gYSkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gbmV3IGNyZWF0ZWpzLkVycm9yRXZlbnQoXCJQUkVMT0FEX05PX0ZJTEVcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdGhpcy5fc2VuZEVycm9yKGQpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9hZGRJdGVtKGEsIG51bGwsIGMpLCB0aGlzLnNldFBhdXNlZChiICE9PSAhMSA/ICExIDogITApXG4gICAgICAgIH0sIGEubG9hZE1hbmlmZXN0ID0gZnVuY3Rpb24oYSwgYywgZCkge1xuICAgICAgICAgICAgdmFyIGUgPSBudWxsLFxuICAgICAgICAgICAgICAgIGYgPSBudWxsO1xuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoMCA9PSBhLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IG5ldyBjcmVhdGVqcy5FcnJvckV2ZW50KFwiUFJFTE9BRF9NQU5JRkVTVF9FTVBUWVwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdGhpcy5fc2VuZEVycm9yKGcpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGUgPSBhXG4gICAgICAgICAgICB9IGVsc2UgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIGEpIGUgPSBbe1xuICAgICAgICAgICAgICAgIHNyYzogYSxcbiAgICAgICAgICAgICAgICB0eXBlOiBiLk1BTklGRVNUXG4gICAgICAgICAgICB9XTtcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChcIm9iamVjdFwiICE9IHR5cGVvZiBhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBnID0gbmV3IGNyZWF0ZWpzLkVycm9yRXZlbnQoXCJQUkVMT0FEX01BTklGRVNUX05VTExcIik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHRoaXMuX3NlbmRFcnJvcihnKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodm9pZCAwICE9PSBhLnNyYykge1xuICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSBhLnR5cGUpIGEudHlwZSA9IGIuTUFOSUZFU1Q7XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGEudHlwZSAhPSBiLk1BTklGRVNUKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZyA9IG5ldyBjcmVhdGVqcy5FcnJvckV2ZW50KFwiUFJFTE9BRF9NQU5JRkVTVF9UWVBFXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VuZEVycm9yKGcpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZSA9IFthXVxuICAgICAgICAgICAgICAgIH0gZWxzZSB2b2lkIDAgIT09IGEubWFuaWZlc3QgJiYgKGUgPSBhLm1hbmlmZXN0LCBmID0gYS5wYXRoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIgaCA9IDAsIGkgPSBlLmxlbmd0aDsgaSA+IGg7IGgrKykgdGhpcy5fYWRkSXRlbShlW2hdLCBmLCBkKTtcbiAgICAgICAgICAgIHRoaXMuc2V0UGF1c2VkKGMgIT09ICExID8gITEgOiAhMClcbiAgICAgICAgfSwgYS5sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnNldFBhdXNlZCghMSlcbiAgICAgICAgfSwgYS5nZXRJdGVtID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xvYWRJdGVtc0J5SWRbYV0gfHwgdGhpcy5fbG9hZEl0ZW1zQnlTcmNbYV1cbiAgICAgICAgfSwgYS5nZXRSZXN1bHQgPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgICB2YXIgYyA9IHRoaXMuX2xvYWRJdGVtc0J5SWRbYV0gfHwgdGhpcy5fbG9hZEl0ZW1zQnlTcmNbYV07XG4gICAgICAgICAgICBpZiAobnVsbCA9PSBjKSByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIHZhciBkID0gYy5pZDtcbiAgICAgICAgICAgIHJldHVybiBiICYmIHRoaXMuX2xvYWRlZFJhd1Jlc3VsdHNbZF0gPyB0aGlzLl9sb2FkZWRSYXdSZXN1bHRzW2RdIDogdGhpcy5fbG9hZGVkUmVzdWx0c1tkXVxuICAgICAgICB9LCBhLmdldEl0ZW1zID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgdmFyIGIgPSBbXTtcbiAgICAgICAgICAgIGZvciAodmFyIGMgaW4gdGhpcy5fbG9hZEl0ZW1zQnlJZCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gdGhpcy5fbG9hZEl0ZW1zQnlJZFtjXSxcbiAgICAgICAgICAgICAgICAgICAgZSA9IHRoaXMuZ2V0UmVzdWx0KGMpO1xuICAgICAgICAgICAgICAgIChhICE9PSAhMCB8fCBudWxsICE9IGUpICYmIGIucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW06IGQsXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdDogZSxcbiAgICAgICAgICAgICAgICAgICAgcmF3UmVzdWx0OiB0aGlzLmdldFJlc3VsdChjLCAhMClcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGJcbiAgICAgICAgfSwgYS5zZXRQYXVzZWQgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICB0aGlzLl9wYXVzZWQgPSBhLCB0aGlzLl9wYXVzZWQgfHwgdGhpcy5fbG9hZE5leHQoKVxuICAgICAgICB9LCBhLmNsb3NlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBmb3IgKDsgdGhpcy5fY3VycmVudExvYWRzLmxlbmd0aDspIHRoaXMuX2N1cnJlbnRMb2Fkcy5wb3AoKS5jYW5jZWwoKTtcbiAgICAgICAgICAgIHRoaXMuX3NjcmlwdE9yZGVyLmxlbmd0aCA9IDAsIHRoaXMuX2xvYWRlZFNjcmlwdHMubGVuZ3RoID0gMCwgdGhpcy5sb2FkU3RhcnRXYXNEaXNwYXRjaGVkID0gITEsIHRoaXMuX2l0ZW1Db3VudCA9IDAsIHRoaXMuX2xhc3RQcm9ncmVzcyA9IDAgLyAwXG4gICAgICAgIH0sIGEuX2FkZEl0ZW0gPSBmdW5jdGlvbihhLCBiLCBjKSB7XG4gICAgICAgICAgICB2YXIgZCA9IHRoaXMuX2NyZWF0ZUxvYWRJdGVtKGEsIGIsIGMpO1xuICAgICAgICAgICAgaWYgKG51bGwgIT0gZCkge1xuICAgICAgICAgICAgICAgIHZhciBlID0gdGhpcy5fY3JlYXRlTG9hZGVyKGQpO1xuICAgICAgICAgICAgICAgIG51bGwgIT0gZSAmJiAoXCJwbHVnaW5zXCIgaW4gZSAmJiAoZS5wbHVnaW5zID0gdGhpcy5fcGx1Z2lucyksIGQuX2xvYWRlciA9IGUsIHRoaXMuX2xvYWRRdWV1ZS5wdXNoKGUpLCB0aGlzLl9sb2FkUXVldWVCYWNrdXAucHVzaChlKSwgdGhpcy5fbnVtSXRlbXMrKywgdGhpcy5fdXBkYXRlUHJvZ3Jlc3MoKSwgKHRoaXMubWFpbnRhaW5TY3JpcHRPcmRlciAmJiBkLnR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLkpBVkFTQ1JJUFQgfHwgZC5tYWludGFpbk9yZGVyID09PSAhMCkgJiYgKHRoaXMuX3NjcmlwdE9yZGVyLnB1c2goZCksIHRoaXMuX2xvYWRlZFNjcmlwdHMucHVzaChudWxsKSkpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGEuX2NyZWF0ZUxvYWRJdGVtID0gZnVuY3Rpb24oYSwgYiwgYykge1xuICAgICAgICAgICAgdmFyIGQgPSBjcmVhdGVqcy5Mb2FkSXRlbS5jcmVhdGUoYSk7XG4gICAgICAgICAgICBpZiAobnVsbCA9PSBkKSByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIHZhciBlID0gXCJcIixcbiAgICAgICAgICAgICAgICBmID0gYyB8fCB0aGlzLl9iYXNlUGF0aDtcbiAgICAgICAgICAgIGlmIChkLnNyYyBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgICAgICAgICAgICAgIGlmICghZC50eXBlKSByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICBpZiAoYikge1xuICAgICAgICAgICAgICAgICAgICBlID0gYjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSBjcmVhdGVqcy5SZXF1ZXN0VXRpbHMucGFyc2VVUkkoYik7XG4gICAgICAgICAgICAgICAgICAgIG51bGwgPT0gZiB8fCBnLmFic29sdXRlIHx8IGcucmVsYXRpdmUgfHwgKGUgPSBmICsgZSlcbiAgICAgICAgICAgICAgICB9IGVsc2UgbnVsbCAhPSBmICYmIChlID0gZilcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGggPSBjcmVhdGVqcy5SZXF1ZXN0VXRpbHMucGFyc2VVUkkoZC5zcmMpO1xuICAgICAgICAgICAgICAgIGguZXh0ZW5zaW9uICYmIChkLmV4dCA9IGguZXh0ZW5zaW9uKSwgbnVsbCA9PSBkLnR5cGUgJiYgKGQudHlwZSA9IGNyZWF0ZWpzLlJlcXVlc3RVdGlscy5nZXRUeXBlQnlFeHRlbnNpb24oZC5leHQpKTtcbiAgICAgICAgICAgICAgICB2YXIgaSA9IGQuc3JjO1xuICAgICAgICAgICAgICAgIGlmICghaC5hYnNvbHV0ZSAmJiAhaC5yZWxhdGl2ZSlcbiAgICAgICAgICAgICAgICAgICAgaWYgKGIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBiO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSBjcmVhdGVqcy5SZXF1ZXN0VXRpbHMucGFyc2VVUkkoYik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpID0gYiArIGksIG51bGwgPT0gZiB8fCBnLmFic29sdXRlIHx8IGcucmVsYXRpdmUgfHwgKGUgPSBmICsgZSlcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIG51bGwgIT0gZiAmJiAoZSA9IGYpO1xuICAgICAgICAgICAgICAgIGQuc3JjID0gZSArIGQuc3JjXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkLnBhdGggPSBlLCAodm9pZCAwID09PSBkLmlkIHx8IG51bGwgPT09IGQuaWQgfHwgXCJcIiA9PT0gZC5pZCkgJiYgKGQuaWQgPSBpKTtcbiAgICAgICAgICAgIHZhciBqID0gdGhpcy5fdHlwZUNhbGxiYWNrc1tkLnR5cGVdIHx8IHRoaXMuX2V4dGVuc2lvbkNhbGxiYWNrc1tkLmV4dF07XG4gICAgICAgICAgICBpZiAoaikge1xuICAgICAgICAgICAgICAgIHZhciBrID0gai5jYWxsYmFjay5jYWxsKGouc2NvcGUsIGQsIHRoaXMpO1xuICAgICAgICAgICAgICAgIGlmIChrID09PSAhMSkgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgayA9PT0gITAgfHwgbnVsbCAhPSBrICYmIChkLl9sb2FkZXIgPSBrKSwgaCA9IGNyZWF0ZWpzLlJlcXVlc3RVdGlscy5wYXJzZVVSSShkLnNyYyksIG51bGwgIT0gaC5leHRlbnNpb24gJiYgKGQuZXh0ID0gaC5leHRlbnNpb24pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbG9hZEl0ZW1zQnlJZFtkLmlkXSA9IGQsIHRoaXMuX2xvYWRJdGVtc0J5U3JjW2Quc3JjXSA9IGQsIG51bGwgPT0gZC5jcm9zc09yaWdpbiAmJiAoZC5jcm9zc09yaWdpbiA9IHRoaXMuX2Nyb3NzT3JpZ2luKSwgZFxuICAgICAgICB9LCBhLl9jcmVhdGVMb2FkZXIgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICBpZiAobnVsbCAhPSBhLl9sb2FkZXIpIHJldHVybiBhLl9sb2FkZXI7XG4gICAgICAgICAgICBmb3IgKHZhciBiID0gdGhpcy5wcmVmZXJYSFIsIGMgPSAwOyBjIDwgdGhpcy5fYXZhaWxhYmxlTG9hZGVycy5sZW5ndGg7IGMrKykge1xuICAgICAgICAgICAgICAgIHZhciBkID0gdGhpcy5fYXZhaWxhYmxlTG9hZGVyc1tjXTtcbiAgICAgICAgICAgICAgICBpZiAoZCAmJiBkLmNhbkxvYWRJdGVtKGEpKSByZXR1cm4gbmV3IGQoYSwgYilcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIH0sIGEuX2xvYWROZXh0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX3BhdXNlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2xvYWRTdGFydFdhc0Rpc3BhdGNoZWQgfHwgKHRoaXMuX3NlbmRMb2FkU3RhcnQoKSwgdGhpcy5fbG9hZFN0YXJ0V2FzRGlzcGF0Y2hlZCA9ICEwKSwgdGhpcy5fbnVtSXRlbXMgPT0gdGhpcy5fbnVtSXRlbXNMb2FkZWQgPyAodGhpcy5sb2FkZWQgPSAhMCwgdGhpcy5fc2VuZENvbXBsZXRlKCksIHRoaXMubmV4dCAmJiB0aGlzLm5leHQubG9hZCAmJiB0aGlzLm5leHQubG9hZCgpKSA6IHRoaXMubG9hZGVkID0gITE7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgYSA9IDA7IGEgPCB0aGlzLl9sb2FkUXVldWUubGVuZ3RoICYmICEodGhpcy5fY3VycmVudExvYWRzLmxlbmd0aCA+PSB0aGlzLl9tYXhDb25uZWN0aW9ucyk7IGErKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMuX2xvYWRRdWV1ZVthXTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2FuU3RhcnRMb2FkKGIpICYmICh0aGlzLl9sb2FkUXVldWUuc3BsaWNlKGEsIDEpLCBhLS0sIHRoaXMuX2xvYWRJdGVtKGIpKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgYS5fbG9hZEl0ZW0gPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICBhLm9uKFwiZmlsZWxvYWRcIiwgdGhpcy5faGFuZGxlRmlsZUxvYWQsIHRoaXMpLCBhLm9uKFwicHJvZ3Jlc3NcIiwgdGhpcy5faGFuZGxlUHJvZ3Jlc3MsIHRoaXMpLCBhLm9uKFwiY29tcGxldGVcIiwgdGhpcy5faGFuZGxlRmlsZUNvbXBsZXRlLCB0aGlzKSwgYS5vbihcImVycm9yXCIsIHRoaXMuX2hhbmRsZUVycm9yLCB0aGlzKSwgYS5vbihcImZpbGVlcnJvclwiLCB0aGlzLl9oYW5kbGVGaWxlRXJyb3IsIHRoaXMpLCB0aGlzLl9jdXJyZW50TG9hZHMucHVzaChhKSwgdGhpcy5fc2VuZEZpbGVTdGFydChhLmdldEl0ZW0oKSksIGEubG9hZCgpXG4gICAgICAgIH0sIGEuX2hhbmRsZUZpbGVMb2FkID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgYS50YXJnZXQgPSBudWxsLCB0aGlzLmRpc3BhdGNoRXZlbnQoYSlcbiAgICAgICAgfSwgYS5faGFuZGxlRmlsZUVycm9yID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgdmFyIGIgPSBuZXcgY3JlYXRlanMuRXJyb3JFdmVudChcIkZJTEVfTE9BRF9FUlJPUlwiLCBudWxsLCBhLml0ZW0pO1xuICAgICAgICAgICAgdGhpcy5fc2VuZEVycm9yKGIpXG4gICAgICAgIH0sIGEuX2hhbmRsZUVycm9yID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgdmFyIGIgPSBhLnRhcmdldDtcbiAgICAgICAgICAgIHRoaXMuX251bUl0ZW1zTG9hZGVkKyssIHRoaXMuX2ZpbmlzaE9yZGVyZWRJdGVtKGIsICEwKSwgdGhpcy5fdXBkYXRlUHJvZ3Jlc3MoKTtcbiAgICAgICAgICAgIHZhciBjID0gbmV3IGNyZWF0ZWpzLkVycm9yRXZlbnQoXCJGSUxFX0xPQURfRVJST1JcIiwgbnVsbCwgYi5nZXRJdGVtKCkpO1xuICAgICAgICAgICAgdGhpcy5fc2VuZEVycm9yKGMpLCB0aGlzLnN0b3BPbkVycm9yID8gdGhpcy5zZXRQYXVzZWQoITApIDogKHRoaXMuX3JlbW92ZUxvYWRJdGVtKGIpLCB0aGlzLl9jbGVhbkxvYWRJdGVtKGIpLCB0aGlzLl9sb2FkTmV4dCgpKVxuICAgICAgICB9LCBhLl9oYW5kbGVGaWxlQ29tcGxldGUgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICB2YXIgYiA9IGEudGFyZ2V0LFxuICAgICAgICAgICAgICAgIGMgPSBiLmdldEl0ZW0oKSxcbiAgICAgICAgICAgICAgICBkID0gYi5nZXRSZXN1bHQoKTtcbiAgICAgICAgICAgIHRoaXMuX2xvYWRlZFJlc3VsdHNbYy5pZF0gPSBkO1xuICAgICAgICAgICAgdmFyIGUgPSBiLmdldFJlc3VsdCghMCk7XG4gICAgICAgICAgICBudWxsICE9IGUgJiYgZSAhPT0gZCAmJiAodGhpcy5fbG9hZGVkUmF3UmVzdWx0c1tjLmlkXSA9IGUpLCB0aGlzLl9zYXZlTG9hZGVkSXRlbXMoYiksIHRoaXMuX3JlbW92ZUxvYWRJdGVtKGIpLCB0aGlzLl9maW5pc2hPcmRlcmVkSXRlbShiKSB8fCB0aGlzLl9wcm9jZXNzRmluaXNoZWRMb2FkKGMsIGIpLCB0aGlzLl9jbGVhbkxvYWRJdGVtKGIpXG4gICAgICAgIH0sIGEuX3NhdmVMb2FkZWRJdGVtcyA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIHZhciBiID0gYS5nZXRMb2FkZWRJdGVtcygpO1xuICAgICAgICAgICAgaWYgKG51bGwgIT09IGIpXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBiLmxlbmd0aDsgYysrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gYltjXS5pdGVtO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9sb2FkSXRlbXNCeVNyY1tkLnNyY10gPSBkLCB0aGlzLl9sb2FkSXRlbXNCeUlkW2QuaWRdID0gZCwgdGhpcy5fbG9hZGVkUmVzdWx0c1tkLmlkXSA9IGJbY10ucmVzdWx0LCB0aGlzLl9sb2FkZWRSYXdSZXN1bHRzW2QuaWRdID0gYltjXS5yYXdSZXN1bHRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH0sIGEuX2ZpbmlzaE9yZGVyZWRJdGVtID0gZnVuY3Rpb24oYSwgYikge1xuICAgICAgICAgICAgdmFyIGMgPSBhLmdldEl0ZW0oKTtcbiAgICAgICAgICAgIGlmICh0aGlzLm1haW50YWluU2NyaXB0T3JkZXIgJiYgYy50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5KQVZBU0NSSVBUIHx8IGMubWFpbnRhaW5PcmRlcikge1xuICAgICAgICAgICAgICAgIGEgaW5zdGFuY2VvZiBjcmVhdGVqcy5KYXZhU2NyaXB0TG9hZGVyICYmICh0aGlzLl9jdXJyZW50bHlMb2FkaW5nU2NyaXB0ID0gITEpO1xuICAgICAgICAgICAgICAgIHZhciBkID0gY3JlYXRlanMuaW5kZXhPZih0aGlzLl9zY3JpcHRPcmRlciwgYyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xID09IGQgPyAhMSA6ICh0aGlzLl9sb2FkZWRTY3JpcHRzW2RdID0gYiA9PT0gITAgPyAhMCA6IGMsIHRoaXMuX2NoZWNrU2NyaXB0TG9hZE9yZGVyKCksICEwKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICExXG4gICAgICAgIH0sIGEuX2NoZWNrU2NyaXB0TG9hZE9yZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBhID0gdGhpcy5fbG9hZGVkU2NyaXB0cy5sZW5ndGgsIGIgPSAwOyBhID4gYjsgYisrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLl9sb2FkZWRTY3JpcHRzW2JdO1xuICAgICAgICAgICAgICAgIGlmIChudWxsID09PSBjKSBicmVhaztcbiAgICAgICAgICAgICAgICBpZiAoYyAhPT0gITApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSB0aGlzLl9sb2FkZWRSZXN1bHRzW2MuaWRdO1xuICAgICAgICAgICAgICAgICAgICBjLnR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLkpBVkFTQ1JJUFQgJiYgY3JlYXRlanMuRG9tVXRpbHMuYXBwZW5kVG9IZWFkKGQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGMuX2xvYWRlcjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc0ZpbmlzaGVkTG9hZChjLCBlKSwgdGhpcy5fbG9hZGVkU2NyaXB0c1tiXSA9ICEwXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCBhLl9wcm9jZXNzRmluaXNoZWRMb2FkID0gZnVuY3Rpb24oYSwgYikge1xuICAgICAgICAgICAgaWYgKHRoaXMuX251bUl0ZW1zTG9hZGVkKyssICF0aGlzLm1haW50YWluU2NyaXB0T3JkZXIgJiYgYS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5KQVZBU0NSSVBUKSB7XG4gICAgICAgICAgICAgICAgdmFyIGMgPSBiLmdldFRhZygpO1xuICAgICAgICAgICAgICAgIGNyZWF0ZWpzLkRvbVV0aWxzLmFwcGVuZFRvSGVhZChjKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fdXBkYXRlUHJvZ3Jlc3MoKSwgdGhpcy5fc2VuZEZpbGVDb21wbGV0ZShhLCBiKSwgdGhpcy5fbG9hZE5leHQoKVxuICAgICAgICB9LCBhLl9jYW5TdGFydExvYWQgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMubWFpbnRhaW5TY3JpcHRPcmRlciB8fCBhLnByZWZlclhIUikgcmV0dXJuICEwO1xuICAgICAgICAgICAgdmFyIGIgPSBhLmdldEl0ZW0oKTtcbiAgICAgICAgICAgIGlmIChiLnR5cGUgIT0gY3JlYXRlanMuTG9hZFF1ZXVlLkpBVkFTQ1JJUFQpIHJldHVybiAhMDtcbiAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50bHlMb2FkaW5nU2NyaXB0KSByZXR1cm4gITE7XG4gICAgICAgICAgICBmb3IgKHZhciBjID0gdGhpcy5fc2NyaXB0T3JkZXIuaW5kZXhPZihiKSwgZCA9IDA7IGMgPiBkOykge1xuICAgICAgICAgICAgICAgIHZhciBlID0gdGhpcy5fbG9hZGVkU2NyaXB0c1tkXTtcbiAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSBlKSByZXR1cm4gITE7XG4gICAgICAgICAgICAgICAgZCsrXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudGx5TG9hZGluZ1NjcmlwdCA9ICEwLCAhMFxuICAgICAgICB9LCBhLl9yZW1vdmVMb2FkSXRlbSA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGIgPSB0aGlzLl9jdXJyZW50TG9hZHMubGVuZ3RoLCBjID0gMDsgYiA+IGM7IGMrKylcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3VycmVudExvYWRzW2NdID09IGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudExvYWRzLnNwbGljZShjLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH0sIGEuX2NsZWFuTG9hZEl0ZW0gPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICB2YXIgYiA9IGEuZ2V0SXRlbSgpO1xuICAgICAgICAgICAgYiAmJiBkZWxldGUgYi5fbG9hZGVyXG4gICAgICAgIH0sIGEuX2hhbmRsZVByb2dyZXNzID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgdmFyIGIgPSBhLnRhcmdldDtcbiAgICAgICAgICAgIHRoaXMuX3NlbmRGaWxlUHJvZ3Jlc3MoYi5nZXRJdGVtKCksIGIucHJvZ3Jlc3MpLCB0aGlzLl91cGRhdGVQcm9ncmVzcygpXG4gICAgICAgIH0sIGEuX3VwZGF0ZVByb2dyZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgYSA9IHRoaXMuX251bUl0ZW1zTG9hZGVkIC8gdGhpcy5fbnVtSXRlbXMsXG4gICAgICAgICAgICAgICAgYiA9IHRoaXMuX251bUl0ZW1zIC0gdGhpcy5fbnVtSXRlbXNMb2FkZWQ7XG4gICAgICAgICAgICBpZiAoYiA+IDApIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBjID0gMCwgZCA9IDAsIGUgPSB0aGlzLl9jdXJyZW50TG9hZHMubGVuZ3RoOyBlID4gZDsgZCsrKSBjICs9IHRoaXMuX2N1cnJlbnRMb2Fkc1tkXS5wcm9ncmVzcztcbiAgICAgICAgICAgICAgICBhICs9IGMgLyBiICogKGIgLyB0aGlzLl9udW1JdGVtcylcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2xhc3RQcm9ncmVzcyAhPSBhICYmICh0aGlzLl9zZW5kUHJvZ3Jlc3MoYSksIHRoaXMuX2xhc3RQcm9ncmVzcyA9IGEpXG4gICAgICAgIH0sIGEuX2Rpc3Bvc2VJdGVtID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2xvYWRlZFJlc3VsdHNbYS5pZF0sIGRlbGV0ZSB0aGlzLl9sb2FkZWRSYXdSZXN1bHRzW2EuaWRdLCBkZWxldGUgdGhpcy5fbG9hZEl0ZW1zQnlJZFthLmlkXSwgZGVsZXRlIHRoaXMuX2xvYWRJdGVtc0J5U3JjW2Euc3JjXVxuICAgICAgICB9LCBhLl9zZW5kRmlsZVByb2dyZXNzID0gZnVuY3Rpb24oYSwgYikge1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0NhbmNlbGVkKCkgJiYgIXRoaXMuX3BhdXNlZCAmJiB0aGlzLmhhc0V2ZW50TGlzdGVuZXIoXCJmaWxlcHJvZ3Jlc3NcIikpIHtcbiAgICAgICAgICAgICAgICB2YXIgYyA9IG5ldyBjcmVhdGVqcy5FdmVudChcImZpbGVwcm9ncmVzc1wiKTtcbiAgICAgICAgICAgICAgICBjLnByb2dyZXNzID0gYiwgYy5sb2FkZWQgPSBiLCBjLnRvdGFsID0gMSwgYy5pdGVtID0gYSwgdGhpcy5kaXNwYXRjaEV2ZW50KGMpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGEuX3NlbmRGaWxlQ29tcGxldGUgPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2lzQ2FuY2VsZWQoKSAmJiAhdGhpcy5fcGF1c2VkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGMgPSBuZXcgY3JlYXRlanMuRXZlbnQoXCJmaWxlbG9hZFwiKTtcbiAgICAgICAgICAgICAgICBjLmxvYWRlciA9IGIsIGMuaXRlbSA9IGEsIGMucmVzdWx0ID0gdGhpcy5fbG9hZGVkUmVzdWx0c1thLmlkXSwgYy5yYXdSZXN1bHQgPSB0aGlzLl9sb2FkZWRSYXdSZXN1bHRzW2EuaWRdLCBhLmNvbXBsZXRlSGFuZGxlciAmJiBhLmNvbXBsZXRlSGFuZGxlcihjKSwgdGhpcy5oYXNFdmVudExpc3RlbmVyKFwiZmlsZWxvYWRcIikgJiYgdGhpcy5kaXNwYXRjaEV2ZW50KGMpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGEuX3NlbmRGaWxlU3RhcnQgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICB2YXIgYiA9IG5ldyBjcmVhdGVqcy5FdmVudChcImZpbGVzdGFydFwiKTtcbiAgICAgICAgICAgIGIuaXRlbSA9IGEsIHRoaXMuaGFzRXZlbnRMaXN0ZW5lcihcImZpbGVzdGFydFwiKSAmJiB0aGlzLmRpc3BhdGNoRXZlbnQoYilcbiAgICAgICAgfSwgYS50b1N0cmluZyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIFwiW1ByZWxvYWRKUyBMb2FkUXVldWVdXCJcbiAgICAgICAgfSwgY3JlYXRlanMuTG9hZFF1ZXVlID0gY3JlYXRlanMucHJvbW90ZShMb2FkUXVldWUsIFwiQWJzdHJhY3RMb2FkZXJcIilcbiAgICB9KCksIHRoaXMuY3JlYXRlanMgPSB0aGlzLmNyZWF0ZWpzIHx8IHt9LFxuICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgICAgICBmdW5jdGlvbiBUZXh0TG9hZGVyKGEpIHtcbiAgICAgICAgICAgIHRoaXMuQWJzdHJhY3RMb2FkZXJfY29uc3RydWN0b3IoYSwgITAsIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlRFWFQpXG4gICAgICAgIH1cbiAgICAgICAgdmFyIGEgPSAoY3JlYXRlanMuZXh0ZW5kKFRleHRMb2FkZXIsIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyKSwgVGV4dExvYWRlcik7XG4gICAgICAgIGEuY2FuTG9hZEl0ZW0gPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICByZXR1cm4gYS50eXBlID09IGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlRFWFRcbiAgICAgICAgfSwgY3JlYXRlanMuVGV4dExvYWRlciA9IGNyZWF0ZWpzLnByb21vdGUoVGV4dExvYWRlciwgXCJBYnN0cmFjdExvYWRlclwiKVxuICAgIH0oKSwgdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanMgfHwge30sXG4gICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgICAgIGZ1bmN0aW9uIEJpbmFyeUxvYWRlcihhKSB7XG4gICAgICAgICAgICB0aGlzLkFic3RyYWN0TG9hZGVyX2NvbnN0cnVjdG9yKGEsICEwLCBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5CSU5BUlkpLCB0aGlzLm9uKFwiaW5pdGlhbGl6ZVwiLCB0aGlzLl91cGRhdGVYSFIsIHRoaXMpXG4gICAgICAgIH1cbiAgICAgICAgdmFyIGEgPSBjcmVhdGVqcy5leHRlbmQoQmluYXJ5TG9hZGVyLCBjcmVhdGVqcy5BYnN0cmFjdExvYWRlciksXG4gICAgICAgICAgICBiID0gQmluYXJ5TG9hZGVyO1xuICAgICAgICBiLmNhbkxvYWRJdGVtID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgcmV0dXJuIGEudHlwZSA9PSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5CSU5BUllcbiAgICAgICAgfSwgYS5fdXBkYXRlWEhSID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgYS5sb2FkZXIuc2V0UmVzcG9uc2VUeXBlKFwiYXJyYXlidWZmZXJcIilcbiAgICAgICAgfSwgY3JlYXRlanMuQmluYXJ5TG9hZGVyID0gY3JlYXRlanMucHJvbW90ZShCaW5hcnlMb2FkZXIsIFwiQWJzdHJhY3RMb2FkZXJcIilcbiAgICB9KCksIHRoaXMuY3JlYXRlanMgPSB0aGlzLmNyZWF0ZWpzIHx8IHt9LFxuICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgICAgICBmdW5jdGlvbiBDU1NMb2FkZXIoYSwgYikge1xuICAgICAgICAgICAgdGhpcy5BYnN0cmFjdExvYWRlcl9jb25zdHJ1Y3RvcihhLCBiLCBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5DU1MpLCB0aGlzLnJlc3VsdEZvcm1hdHRlciA9IHRoaXMuX2Zvcm1hdFJlc3VsdCwgdGhpcy5fdGFnU3JjQXR0cmlidXRlID0gXCJocmVmXCIsIHRoaXMuX3RhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYiA/IFwic3R5bGVcIiA6IFwibGlua1wiKSwgdGhpcy5fdGFnLnJlbCA9IFwic3R5bGVzaGVldFwiLCB0aGlzLl90YWcudHlwZSA9IFwidGV4dC9jc3NcIlxuICAgICAgICB9XG4gICAgICAgIHZhciBhID0gY3JlYXRlanMuZXh0ZW5kKENTU0xvYWRlciwgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpLFxuICAgICAgICAgICAgYiA9IENTU0xvYWRlcjtcbiAgICAgICAgYi5jYW5Mb2FkSXRlbSA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIHJldHVybiBhLnR5cGUgPT0gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuQ1NTXG4gICAgICAgIH0sIGEuX2Zvcm1hdFJlc3VsdCA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9wcmVmZXJYSFIpIHtcbiAgICAgICAgICAgICAgICB2YXIgYiA9IGEuZ2V0VGFnKCk7XG4gICAgICAgICAgICAgICAgaWYgKGIuc3R5bGVTaGVldCkgYi5zdHlsZVNoZWV0LmNzc1RleHQgPSBhLmdldFJlc3VsdCghMCk7XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoYS5nZXRSZXN1bHQoITApKTtcbiAgICAgICAgICAgICAgICAgICAgYi5hcHBlbmRDaGlsZChjKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBiID0gdGhpcy5fdGFnO1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZWpzLkRvbVV0aWxzLmFwcGVuZFRvSGVhZChiKSwgYlxuICAgICAgICB9LCBjcmVhdGVqcy5DU1NMb2FkZXIgPSBjcmVhdGVqcy5wcm9tb3RlKENTU0xvYWRlciwgXCJBYnN0cmFjdExvYWRlclwiKVxuICAgIH0oKSwgdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanMgfHwge30sXG4gICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgICAgIGZ1bmN0aW9uIEltYWdlTG9hZGVyKGEsIGIpIHtcbiAgICAgICAgICAgIHRoaXMuQWJzdHJhY3RMb2FkZXJfY29uc3RydWN0b3IoYSwgYiwgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuSU1BR0UpLCB0aGlzLnJlc3VsdEZvcm1hdHRlciA9IHRoaXMuX2Zvcm1hdFJlc3VsdCwgdGhpcy5fdGFnU3JjQXR0cmlidXRlID0gXCJzcmNcIiwgY3JlYXRlanMuUmVxdWVzdFV0aWxzLmlzSW1hZ2VUYWcoYSkgPyB0aGlzLl90YWcgPSBhIDogY3JlYXRlanMuUmVxdWVzdFV0aWxzLmlzSW1hZ2VUYWcoYS5zcmMpID8gdGhpcy5fdGFnID0gYS5zcmMgOiBjcmVhdGVqcy5SZXF1ZXN0VXRpbHMuaXNJbWFnZVRhZyhhLnRhZykgJiYgKHRoaXMuX3RhZyA9IGEudGFnKSwgbnVsbCAhPSB0aGlzLl90YWcgPyB0aGlzLl9wcmVmZXJYSFIgPSAhMSA6IHRoaXMuX3RhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIiksIHRoaXMub24oXCJpbml0aWFsaXplXCIsIHRoaXMuX3VwZGF0ZVhIUiwgdGhpcylcbiAgICAgICAgfVxuICAgICAgICB2YXIgYSA9IGNyZWF0ZWpzLmV4dGVuZChJbWFnZUxvYWRlciwgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpLFxuICAgICAgICAgICAgYiA9IEltYWdlTG9hZGVyO1xuICAgICAgICBiLmNhbkxvYWRJdGVtID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgcmV0dXJuIGEudHlwZSA9PSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5JTUFHRVxuICAgICAgICB9LCBhLmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChcIlwiICE9IHRoaXMuX3RhZy5zcmMgJiYgdGhpcy5fdGFnLmNvbXBsZXRlKSByZXR1cm4gdm9pZCB0aGlzLl9zZW5kQ29tcGxldGUoKTtcbiAgICAgICAgICAgIHZhciBhID0gdGhpcy5faXRlbS5jcm9zc09yaWdpbjtcbiAgICAgICAgICAgIDEgPT0gYSAmJiAoYSA9IFwiQW5vbnltb3VzXCIpLCBudWxsID09IGEgfHwgY3JlYXRlanMuUmVxdWVzdFV0aWxzLmlzTG9jYWwodGhpcy5faXRlbS5zcmMpIHx8ICh0aGlzLl90YWcuY3Jvc3NPcmlnaW4gPSBhKSwgdGhpcy5BYnN0cmFjdExvYWRlcl9sb2FkKClcbiAgICAgICAgfSwgYS5fdXBkYXRlWEhSID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgYS5sb2FkZXIubWltZVR5cGUgPSBcInRleHQvcGxhaW47IGNoYXJzZXQ9eC11c2VyLWRlZmluZWQtYmluYXJ5XCIsIGEubG9hZGVyLnNldFJlc3BvbnNlVHlwZSAmJiBhLmxvYWRlci5zZXRSZXNwb25zZVR5cGUoXCJibG9iXCIpXG4gICAgICAgIH0sIGEuX2Zvcm1hdFJlc3VsdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zvcm1hdEltYWdlXG4gICAgICAgIH0sIGEuX2Zvcm1hdEltYWdlID0gZnVuY3Rpb24oYSwgYikge1xuICAgICAgICAgICAgdmFyIGMgPSB0aGlzLl90YWcsXG4gICAgICAgICAgICAgICAgZCA9IHdpbmRvdy5VUkwgfHwgd2luZG93LndlYmtpdFVSTDtcbiAgICAgICAgICAgIGlmICh0aGlzLl9wcmVmZXJYSFIpXG4gICAgICAgICAgICAgICAgaWYgKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBkLmNyZWF0ZU9iamVjdFVSTCh0aGlzLmdldFJlc3VsdCghMCkpO1xuICAgICAgICAgICAgICAgICAgICBjLnNyYyA9IGUsIGMuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgdGhpcy5fY2xlYW5VcFVSTCwgITEpLCBjLmFkZEV2ZW50TGlzdGVuZXIoXCJlcnJvclwiLCB0aGlzLl9jbGVhblVwVVJMLCAhMSlcbiAgICAgICAgICAgICAgICB9IGVsc2UgYy5zcmMgPSB0aGlzLl9pdGVtLnNyYztcbiAgICAgICAgICAgIGVsc2U7XG4gICAgICAgICAgICBjLmNvbXBsZXRlID8gYShjKSA6IChjLm9ubG9hZCA9IGNyZWF0ZWpzLnByb3h5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGEodGhpcy5fdGFnKVxuICAgICAgICAgICAgfSwgdGhpcyksIGMub25lcnJvciA9IGNyZWF0ZWpzLnByb3h5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGIoX3RoaXMuX3RhZylcbiAgICAgICAgICAgIH0sIHRoaXMpKVxuICAgICAgICB9LCBhLl9jbGVhblVwVVJMID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgdmFyIGIgPSB3aW5kb3cuVVJMIHx8IHdpbmRvdy53ZWJraXRVUkw7XG4gICAgICAgICAgICBiLnJldm9rZU9iamVjdFVSTChhLnRhcmdldC5zcmMpXG4gICAgICAgIH0sIGNyZWF0ZWpzLkltYWdlTG9hZGVyID0gY3JlYXRlanMucHJvbW90ZShJbWFnZUxvYWRlciwgXCJBYnN0cmFjdExvYWRlclwiKVxuICAgIH0oKSwgdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanMgfHwge30sXG4gICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgICAgIGZ1bmN0aW9uIEphdmFTY3JpcHRMb2FkZXIoYSwgYikge1xuICAgICAgICAgICAgdGhpcy5BYnN0cmFjdExvYWRlcl9jb25zdHJ1Y3RvcihhLCBiLCBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5KQVZBU0NSSVBUKSwgdGhpcy5yZXN1bHRGb3JtYXR0ZXIgPSB0aGlzLl9mb3JtYXRSZXN1bHQsIHRoaXMuX3RhZ1NyY0F0dHJpYnV0ZSA9IFwic3JjXCIsIHRoaXMuc2V0VGFnKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIikpXG4gICAgICAgIH1cbiAgICAgICAgdmFyIGEgPSBjcmVhdGVqcy5leHRlbmQoSmF2YVNjcmlwdExvYWRlciwgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpLFxuICAgICAgICAgICAgYiA9IEphdmFTY3JpcHRMb2FkZXI7XG4gICAgICAgIGIuY2FuTG9hZEl0ZW0gPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICByZXR1cm4gYS50eXBlID09IGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkpBVkFTQ1JJUFRcbiAgICAgICAgfSwgYS5fZm9ybWF0UmVzdWx0ID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgdmFyIGIgPSBhLmdldFRhZygpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ByZWZlclhIUiAmJiAoYi50ZXh0ID0gYS5nZXRSZXN1bHQoITApKSwgYlxuICAgICAgICB9LCBjcmVhdGVqcy5KYXZhU2NyaXB0TG9hZGVyID0gY3JlYXRlanMucHJvbW90ZShKYXZhU2NyaXB0TG9hZGVyLCBcIkFic3RyYWN0TG9hZGVyXCIpXG4gICAgfSgpLCB0aGlzLmNyZWF0ZWpzID0gdGhpcy5jcmVhdGVqcyB8fCB7fSxcbiAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAgICAgZnVuY3Rpb24gSlNPTkxvYWRlcihhKSB7XG4gICAgICAgICAgICB0aGlzLkFic3RyYWN0TG9hZGVyX2NvbnN0cnVjdG9yKGEsICEwLCBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5KU09OKSwgdGhpcy5yZXN1bHRGb3JtYXR0ZXIgPSB0aGlzLl9mb3JtYXRSZXN1bHRcbiAgICAgICAgfVxuICAgICAgICB2YXIgYSA9IGNyZWF0ZWpzLmV4dGVuZChKU09OTG9hZGVyLCBjcmVhdGVqcy5BYnN0cmFjdExvYWRlciksXG4gICAgICAgICAgICBiID0gSlNPTkxvYWRlcjtcbiAgICAgICAgYi5jYW5Mb2FkSXRlbSA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIHJldHVybiBhLnR5cGUgPT0gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuSlNPTlxuICAgICAgICB9LCBhLl9mb3JtYXRSZXN1bHQgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICB2YXIgYiA9IG51bGw7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGIgPSBjcmVhdGVqcy5EYXRhVXRpbHMucGFyc2VKU09OKGEuZ2V0UmVzdWx0KCEwKSlcbiAgICAgICAgICAgIH0gY2F0Y2ggKGMpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9IG5ldyBjcmVhdGVqcy5FcnJvckV2ZW50KFwiSlNPTl9GT1JNQVRcIiwgbnVsbCwgYyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NlbmRFcnJvcihkKSwgY1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGJcbiAgICAgICAgfSwgY3JlYXRlanMuSlNPTkxvYWRlciA9IGNyZWF0ZWpzLnByb21vdGUoSlNPTkxvYWRlciwgXCJBYnN0cmFjdExvYWRlclwiKVxuICAgIH0oKSwgdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanMgfHwge30sXG4gICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgICAgIGZ1bmN0aW9uIEpTT05QTG9hZGVyKGEpIHtcbiAgICAgICAgICAgIHRoaXMuQWJzdHJhY3RMb2FkZXJfY29uc3RydWN0b3IoYSwgITEsIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLkpTT05QKSwgdGhpcy5zZXRUYWcoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKSksIHRoaXMuZ2V0VGFnKCkudHlwZSA9IFwidGV4dC9qYXZhc2NyaXB0XCJcbiAgICAgICAgfVxuICAgICAgICB2YXIgYSA9IGNyZWF0ZWpzLmV4dGVuZChKU09OUExvYWRlciwgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpLFxuICAgICAgICAgICAgYiA9IEpTT05QTG9hZGVyO1xuICAgICAgICBiLmNhbkxvYWRJdGVtID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgcmV0dXJuIGEudHlwZSA9PSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5KU09OUFxuICAgICAgICB9LCBhLmNhbmNlbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5BYnN0cmFjdExvYWRlcl9jYW5jZWwoKSwgdGhpcy5fZGlzcG9zZSgpXG4gICAgICAgIH0sIGEubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKG51bGwgPT0gdGhpcy5faXRlbS5jYWxsYmFjaykgdGhyb3cgbmV3IEVycm9yKFwiY2FsbGJhY2sgaXMgcmVxdWlyZWQgZm9yIGxvYWRpbmcgSlNPTlAgcmVxdWVzdHMuXCIpO1xuICAgICAgICAgICAgaWYgKG51bGwgIT0gd2luZG93W3RoaXMuX2l0ZW0uY2FsbGJhY2tdKSB0aHJvdyBuZXcgRXJyb3IoXCJKU09OUCBjYWxsYmFjayAnXCIgKyB0aGlzLl9pdGVtLmNhbGxiYWNrICsgXCInIGFscmVhZHkgZXhpc3RzIG9uIHdpbmRvdy4gWW91IG5lZWQgdG8gc3BlY2lmeSBhIGRpZmZlcmVudCBjYWxsYmFjayBvciByZS1uYW1lIHRoZSBjdXJyZW50IG9uZS5cIik7XG4gICAgICAgICAgICB3aW5kb3dbdGhpcy5faXRlbS5jYWxsYmFja10gPSBjcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVMb2FkLCB0aGlzKSwgd2luZG93LmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5fdGFnKSwgdGhpcy5fbG9hZFRpbWVvdXQgPSBzZXRUaW1lb3V0KGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZVRpbWVvdXQsIHRoaXMpLCB0aGlzLl9pdGVtLmxvYWRUaW1lb3V0KSwgdGhpcy5fdGFnLnNyYyA9IHRoaXMuX2l0ZW0uc3JjXG4gICAgICAgIH0sIGEuX2hhbmRsZUxvYWQgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICB0aGlzLl9yZXN1bHQgPSB0aGlzLl9yYXdSZXN1bHQgPSBhLCB0aGlzLl9zZW5kQ29tcGxldGUoKSwgdGhpcy5fZGlzcG9zZSgpXG4gICAgICAgIH0sIGEuX2hhbmRsZVRpbWVvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuX2Rpc3Bvc2UoKSwgdGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBjcmVhdGVqcy5FcnJvckV2ZW50KFwidGltZW91dFwiKSlcbiAgICAgICAgfSwgYS5fZGlzcG9zZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgd2luZG93LmRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5fdGFnKSwgZGVsZXRlIHdpbmRvd1t0aGlzLl9pdGVtLmNhbGxiYWNrXSwgY2xlYXJUaW1lb3V0KHRoaXMuX2xvYWRUaW1lb3V0KVxuICAgICAgICB9LCBjcmVhdGVqcy5KU09OUExvYWRlciA9IGNyZWF0ZWpzLnByb21vdGUoSlNPTlBMb2FkZXIsIFwiQWJzdHJhY3RMb2FkZXJcIilcbiAgICB9KCksIHRoaXMuY3JlYXRlanMgPSB0aGlzLmNyZWF0ZWpzIHx8IHt9LFxuICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgICAgICBmdW5jdGlvbiBNYW5pZmVzdExvYWRlcihhKSB7XG4gICAgICAgICAgICB0aGlzLkFic3RyYWN0TG9hZGVyX2NvbnN0cnVjdG9yKGEsIG51bGwsIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLk1BTklGRVNUKSwgdGhpcy5wbHVnaW5zID0gbnVsbCwgdGhpcy5fbWFuaWZlc3RRdWV1ZSA9IG51bGxcbiAgICAgICAgfVxuICAgICAgICB2YXIgYSA9IGNyZWF0ZWpzLmV4dGVuZChNYW5pZmVzdExvYWRlciwgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIpLFxuICAgICAgICAgICAgYiA9IE1hbmlmZXN0TG9hZGVyO1xuICAgICAgICBiLk1BTklGRVNUX1BST0dSRVNTID0gLjI1LCBiLmNhbkxvYWRJdGVtID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgcmV0dXJuIGEudHlwZSA9PSBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5NQU5JRkVTVFxuICAgICAgICB9LCBhLmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuQWJzdHJhY3RMb2FkZXJfbG9hZCgpXG4gICAgICAgIH0sIGEuX2NyZWF0ZVJlcXVlc3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBhID0gdGhpcy5faXRlbS5jYWxsYmFjaztcbiAgICAgICAgICAgIHRoaXMuX3JlcXVlc3QgPSBudWxsICE9IGEgPyBuZXcgY3JlYXRlanMuSlNPTlBMb2FkZXIodGhpcy5faXRlbSkgOiBuZXcgY3JlYXRlanMuSlNPTkxvYWRlcih0aGlzLl9pdGVtKVxuICAgICAgICB9LCBhLmhhbmRsZUV2ZW50ID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgc3dpdGNoIChhLnR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiY29tcGxldGVcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Jhd1Jlc3VsdCA9IGEudGFyZ2V0LmdldFJlc3VsdCghMCksIHRoaXMuX3Jlc3VsdCA9IGEudGFyZ2V0LmdldFJlc3VsdCgpLCB0aGlzLl9zZW5kUHJvZ3Jlc3MoYi5NQU5JRkVTVF9QUk9HUkVTUyksIHZvaWQgdGhpcy5fbG9hZE1hbmlmZXN0KHRoaXMuX3Jlc3VsdCk7XG4gICAgICAgICAgICAgICAgY2FzZSBcInByb2dyZXNzXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmxvYWRlZCAqPSBiLk1BTklGRVNUX1BST0dSRVNTLCB0aGlzLnByb2dyZXNzID0gYS5sb2FkZWQgLyBhLnRvdGFsLCAoaXNOYU4odGhpcy5wcm9ncmVzcykgfHwgMSAvIDAgPT0gdGhpcy5wcm9ncmVzcykgJiYgKHRoaXMucHJvZ3Jlc3MgPSAwKSwgdm9pZCB0aGlzLl9zZW5kUHJvZ3Jlc3MoYSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuQWJzdHJhY3RMb2FkZXJfaGFuZGxlRXZlbnQoYSlcbiAgICAgICAgfSwgYS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLkFic3RyYWN0TG9hZGVyX2Rlc3Ryb3koKSwgdGhpcy5fbWFuaWZlc3RRdWV1ZS5jbG9zZSgpXG4gICAgICAgIH0sIGEuX2xvYWRNYW5pZmVzdCA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIGlmIChhICYmIGEubWFuaWZlc3QpIHtcbiAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMuX21hbmlmZXN0UXVldWUgPSBuZXcgY3JlYXRlanMuTG9hZFF1ZXVlO1xuICAgICAgICAgICAgICAgIGIub24oXCJmaWxlbG9hZFwiLCB0aGlzLl9oYW5kbGVNYW5pZmVzdEZpbGVMb2FkLCB0aGlzKSwgYi5vbihcInByb2dyZXNzXCIsIHRoaXMuX2hhbmRsZU1hbmlmZXN0UHJvZ3Jlc3MsIHRoaXMpLCBiLm9uKFwiY29tcGxldGVcIiwgdGhpcy5faGFuZGxlTWFuaWZlc3RDb21wbGV0ZSwgdGhpcywgITApLCBiLm9uKFwiZXJyb3JcIiwgdGhpcy5faGFuZGxlTWFuaWZlc3RFcnJvciwgdGhpcywgITApO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGMgPSAwLCBkID0gdGhpcy5wbHVnaW5zLmxlbmd0aDsgZCA+IGM7IGMrKykgYi5pbnN0YWxsUGx1Z2luKHRoaXMucGx1Z2luc1tjXSk7XG4gICAgICAgICAgICAgICAgYi5sb2FkTWFuaWZlc3QoYSlcbiAgICAgICAgICAgIH0gZWxzZSB0aGlzLl9zZW5kQ29tcGxldGUoKVxuICAgICAgICB9LCBhLl9oYW5kbGVNYW5pZmVzdEZpbGVMb2FkID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgYS50YXJnZXQgPSBudWxsLCB0aGlzLmRpc3BhdGNoRXZlbnQoYSlcbiAgICAgICAgfSwgYS5faGFuZGxlTWFuaWZlc3RDb21wbGV0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5fbG9hZGVkSXRlbXMgPSB0aGlzLl9tYW5pZmVzdFF1ZXVlLmdldEl0ZW1zKCEwKSwgdGhpcy5fc2VuZENvbXBsZXRlKClcbiAgICAgICAgfSwgYS5faGFuZGxlTWFuaWZlc3RQcm9ncmVzcyA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3MgPSBhLnByb2dyZXNzICogKDEgLSBiLk1BTklGRVNUX1BST0dSRVNTKSArIGIuTUFOSUZFU1RfUFJPR1JFU1MsIHRoaXMuX3NlbmRQcm9ncmVzcyh0aGlzLnByb2dyZXNzKVxuICAgICAgICB9LCBhLl9oYW5kbGVNYW5pZmVzdEVycm9yID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgdmFyIGIgPSBuZXcgY3JlYXRlanMuRXZlbnQoXCJmaWxlZXJyb3JcIik7XG4gICAgICAgICAgICBiLml0ZW0gPSBhLmRhdGEsIHRoaXMuZGlzcGF0Y2hFdmVudChiKVxuICAgICAgICB9LCBjcmVhdGVqcy5NYW5pZmVzdExvYWRlciA9IGNyZWF0ZWpzLnByb21vdGUoTWFuaWZlc3RMb2FkZXIsIFwiQWJzdHJhY3RMb2FkZXJcIilcbiAgICB9KCksIHRoaXMuY3JlYXRlanMgPSB0aGlzLmNyZWF0ZWpzIHx8IHt9LFxuICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgICAgICBmdW5jdGlvbiBTb3VuZExvYWRlcihhLCBiKSB7XG4gICAgICAgICAgICB0aGlzLkFic3RyYWN0TWVkaWFMb2FkZXJfY29uc3RydWN0b3IoYSwgYiwgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuU09VTkQpLCBjcmVhdGVqcy5SZXF1ZXN0VXRpbHMuaXNBdWRpb1RhZyhhKSA/IHRoaXMuX3RhZyA9IGEgOiBjcmVhdGVqcy5SZXF1ZXN0VXRpbHMuaXNBdWRpb1RhZyhhLnNyYykgPyB0aGlzLl90YWcgPSBhIDogY3JlYXRlanMuUmVxdWVzdFV0aWxzLmlzQXVkaW9UYWcoYS50YWcpICYmICh0aGlzLl90YWcgPSBjcmVhdGVqcy5SZXF1ZXN0VXRpbHMuaXNBdWRpb1RhZyhhKSA/IGEgOiBhLnNyYyksIG51bGwgIT0gdGhpcy5fdGFnICYmICh0aGlzLl9wcmVmZXJYSFIgPSAhMSlcbiAgICAgICAgfVxuICAgICAgICB2YXIgYSA9IGNyZWF0ZWpzLmV4dGVuZChTb3VuZExvYWRlciwgY3JlYXRlanMuQWJzdHJhY3RNZWRpYUxvYWRlciksXG4gICAgICAgICAgICBiID0gU291bmRMb2FkZXI7XG4gICAgICAgIGIuY2FuTG9hZEl0ZW0gPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICByZXR1cm4gYS50eXBlID09IGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlNPVU5EXG4gICAgICAgIH0sIGEuX2NyZWF0ZVRhZyA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIHZhciBiID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImF1ZGlvXCIpO1xuICAgICAgICAgICAgcmV0dXJuIGIuYXV0b3BsYXkgPSAhMSwgYi5wcmVsb2FkID0gXCJub25lXCIsIGIuc3JjID0gYSwgYlxuICAgICAgICB9LCBjcmVhdGVqcy5Tb3VuZExvYWRlciA9IGNyZWF0ZWpzLnByb21vdGUoU291bmRMb2FkZXIsIFwiQWJzdHJhY3RNZWRpYUxvYWRlclwiKVxuICAgIH0oKSwgdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanMgfHwge30sXG4gICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgICAgIGZ1bmN0aW9uIFZpZGVvTG9hZGVyKGEsIGIpIHtcbiAgICAgICAgICAgIHRoaXMuQWJzdHJhY3RNZWRpYUxvYWRlcl9jb25zdHJ1Y3RvcihhLCBiLCBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5WSURFTyksIGNyZWF0ZWpzLlJlcXVlc3RVdGlscy5pc1ZpZGVvVGFnKGEpIHx8IGNyZWF0ZWpzLlJlcXVlc3RVdGlscy5pc1ZpZGVvVGFnKGEuc3JjKSA/ICh0aGlzLnNldFRhZyhjcmVhdGVqcy5SZXF1ZXN0VXRpbHMuaXNWaWRlb1RhZyhhKSA/IGEgOiBhLnNyYyksIHRoaXMuX3ByZWZlclhIUiA9ICExKSA6IHRoaXMuc2V0VGFnKHRoaXMuX2NyZWF0ZVRhZygpKVxuICAgICAgICB9XG4gICAgICAgIHZhciBhID0gY3JlYXRlanMuZXh0ZW5kKFZpZGVvTG9hZGVyLCBjcmVhdGVqcy5BYnN0cmFjdE1lZGlhTG9hZGVyKSxcbiAgICAgICAgICAgIGIgPSBWaWRlb0xvYWRlcjtcbiAgICAgICAgYS5fY3JlYXRlVGFnID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInZpZGVvXCIpXG4gICAgICAgIH0sIGIuY2FuTG9hZEl0ZW0gPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICByZXR1cm4gYS50eXBlID09IGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlZJREVPXG4gICAgICAgIH0sIGNyZWF0ZWpzLlZpZGVvTG9hZGVyID0gY3JlYXRlanMucHJvbW90ZShWaWRlb0xvYWRlciwgXCJBYnN0cmFjdE1lZGlhTG9hZGVyXCIpXG4gICAgfSgpLCB0aGlzLmNyZWF0ZWpzID0gdGhpcy5jcmVhdGVqcyB8fCB7fSxcbiAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAgICAgZnVuY3Rpb24gU3ByaXRlU2hlZXRMb2FkZXIoYSwgYikge1xuICAgICAgICAgICAgdGhpcy5BYnN0cmFjdExvYWRlcl9jb25zdHJ1Y3RvcihhLCBiLCBjcmVhdGVqcy5BYnN0cmFjdExvYWRlci5TUFJJVEVTSEVFVCksIHRoaXMuX21hbmlmZXN0UXVldWUgPSBudWxsXG4gICAgICAgIH1cbiAgICAgICAgdmFyIGEgPSBjcmVhdGVqcy5leHRlbmQoU3ByaXRlU2hlZXRMb2FkZXIsIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyKSxcbiAgICAgICAgICAgIGIgPSBTcHJpdGVTaGVldExvYWRlcjtcbiAgICAgICAgYi5TUFJJVEVTSEVFVF9QUk9HUkVTUyA9IC4yNSwgYi5jYW5Mb2FkSXRlbSA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIHJldHVybiBhLnR5cGUgPT0gY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuU1BSSVRFU0hFRVRcbiAgICAgICAgfSwgYS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLkFic3RyYWN0TG9hZGVyX2Rlc3Ryb3ksIHRoaXMuX21hbmlmZXN0UXVldWUuY2xvc2UoKVxuICAgICAgICB9LCBhLl9jcmVhdGVSZXF1ZXN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgYSA9IHRoaXMuX2l0ZW0uY2FsbGJhY2s7XG4gICAgICAgICAgICB0aGlzLl9yZXF1ZXN0ID0gbnVsbCAhPSBhID8gbmV3IGNyZWF0ZWpzLkpTT05QTG9hZGVyKHRoaXMuX2l0ZW0pIDogbmV3IGNyZWF0ZWpzLkpTT05Mb2FkZXIodGhpcy5faXRlbSlcbiAgICAgICAgfSwgYS5oYW5kbGVFdmVudCA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoYS50eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcImNvbXBsZXRlXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yYXdSZXN1bHQgPSBhLnRhcmdldC5nZXRSZXN1bHQoITApLCB0aGlzLl9yZXN1bHQgPSBhLnRhcmdldC5nZXRSZXN1bHQoKSwgdGhpcy5fc2VuZFByb2dyZXNzKGIuU1BSSVRFU0hFRVRfUFJPR1JFU1MpLCB2b2lkIHRoaXMuX2xvYWRNYW5pZmVzdCh0aGlzLl9yZXN1bHQpO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJwcm9ncmVzc1wiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5sb2FkZWQgKj0gYi5TUFJJVEVTSEVFVF9QUk9HUkVTUywgdGhpcy5wcm9ncmVzcyA9IGEubG9hZGVkIC8gYS50b3RhbCwgKGlzTmFOKHRoaXMucHJvZ3Jlc3MpIHx8IDEgLyAwID09IHRoaXMucHJvZ3Jlc3MpICYmICh0aGlzLnByb2dyZXNzID0gMCksIHZvaWQgdGhpcy5fc2VuZFByb2dyZXNzKGEpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLkFic3RyYWN0TG9hZGVyX2hhbmRsZUV2ZW50KGEpXG4gICAgICAgIH0sIGEuX2xvYWRNYW5pZmVzdCA9IGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICAgIGlmIChhICYmIGEuaW1hZ2VzKSB7XG4gICAgICAgICAgICAgICAgdmFyIGIgPSB0aGlzLl9tYW5pZmVzdFF1ZXVlID0gbmV3IGNyZWF0ZWpzLkxvYWRRdWV1ZSh0aGlzLl9wcmVmZXJYSFIsIHRoaXMuX2l0ZW0ucGF0aCwgdGhpcy5faXRlbS5jcm9zc09yaWdpbik7XG4gICAgICAgICAgICAgICAgYi5vbihcImNvbXBsZXRlXCIsIHRoaXMuX2hhbmRsZU1hbmlmZXN0Q29tcGxldGUsIHRoaXMsICEwKSwgYi5vbihcImZpbGVsb2FkXCIsIHRoaXMuX2hhbmRsZU1hbmlmZXN0RmlsZUxvYWQsIHRoaXMpLCBiLm9uKFwicHJvZ3Jlc3NcIiwgdGhpcy5faGFuZGxlTWFuaWZlc3RQcm9ncmVzcywgdGhpcyksIGIub24oXCJlcnJvclwiLCB0aGlzLl9oYW5kbGVNYW5pZmVzdEVycm9yLCB0aGlzLCAhMCksIGIubG9hZE1hbmlmZXN0KGEuaW1hZ2VzKVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCBhLl9oYW5kbGVNYW5pZmVzdEZpbGVMb2FkID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgdmFyIGIgPSBhLnJlc3VsdDtcbiAgICAgICAgICAgIGlmIChudWxsICE9IGIpIHtcbiAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMuZ2V0UmVzdWx0KCkuaW1hZ2VzLFxuICAgICAgICAgICAgICAgICAgICBkID0gYy5pbmRleE9mKGEuaXRlbS5zcmMpO1xuICAgICAgICAgICAgICAgIGNbZF0gPSBiXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGEuX2hhbmRsZU1hbmlmZXN0Q29tcGxldGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuX3Jlc3VsdCA9IG5ldyBjcmVhdGVqcy5TcHJpdGVTaGVldCh0aGlzLl9yZXN1bHQpLCB0aGlzLl9sb2FkZWRJdGVtcyA9IHRoaXMuX21hbmlmZXN0UXVldWUuZ2V0SXRlbXMoITApLCB0aGlzLl9zZW5kQ29tcGxldGUoKVxuICAgICAgICB9LCBhLl9oYW5kbGVNYW5pZmVzdFByb2dyZXNzID0gZnVuY3Rpb24oYSkge1xuICAgICAgICAgICAgdGhpcy5wcm9ncmVzcyA9IGEucHJvZ3Jlc3MgKiAoMSAtIGIuU1BSSVRFU0hFRVRfUFJPR1JFU1MpICsgYi5TUFJJVEVTSEVFVF9QUk9HUkVTUywgdGhpcy5fc2VuZFByb2dyZXNzKHRoaXMucHJvZ3Jlc3MpXG4gICAgICAgIH0sIGEuX2hhbmRsZU1hbmlmZXN0RXJyb3IgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICB2YXIgYiA9IG5ldyBjcmVhdGVqcy5FdmVudChcImZpbGVlcnJvclwiKTtcbiAgICAgICAgICAgIGIuaXRlbSA9IGEuZGF0YSwgdGhpcy5kaXNwYXRjaEV2ZW50KGIpXG4gICAgICAgIH0sIGNyZWF0ZWpzLlNwcml0ZVNoZWV0TG9hZGVyID0gY3JlYXRlanMucHJvbW90ZShTcHJpdGVTaGVldExvYWRlciwgXCJBYnN0cmFjdExvYWRlclwiKVxuICAgIH0oKSwgdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanMgfHwge30sXG4gICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgICAgIGZ1bmN0aW9uIFNWR0xvYWRlcihhLCBiKSB7XG4gICAgICAgICAgICB0aGlzLkFic3RyYWN0TG9hZGVyX2NvbnN0cnVjdG9yKGEsIGIsIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlNWRyksIHRoaXMucmVzdWx0Rm9ybWF0dGVyID0gdGhpcy5fZm9ybWF0UmVzdWx0LCB0aGlzLl90YWdTcmNBdHRyaWJ1dGUgPSBcImRhdGFcIiwgYiA/IHRoaXMuc2V0VGFnKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzdmdcIikpIDogKHRoaXMuc2V0VGFnKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvYmplY3RcIikpLCB0aGlzLmdldFRhZygpLnR5cGUgPSBcImltYWdlL3N2Zyt4bWxcIilcbiAgICAgICAgfVxuICAgICAgICB2YXIgYSA9IGNyZWF0ZWpzLmV4dGVuZChTVkdMb2FkZXIsIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyKSxcbiAgICAgICAgICAgIGIgPSBTVkdMb2FkZXI7XG4gICAgICAgIGIuY2FuTG9hZEl0ZW0gPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICByZXR1cm4gYS50eXBlID09IGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlNWR1xuICAgICAgICB9LCBhLl9mb3JtYXRSZXN1bHQgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICB2YXIgYiA9IGNyZWF0ZWpzLkRhdGFVdGlscy5wYXJzZVhNTChhLmdldFJlc3VsdCghMCksIFwidGV4dC94bWxcIiksXG4gICAgICAgICAgICAgICAgYyA9IGEuZ2V0VGFnKCk7XG4gICAgICAgICAgICByZXR1cm4gIXRoaXMuX3ByZWZlclhIUiAmJiBkb2N1bWVudC5ib2R5LmNvbnRhaW5zKGMpICYmIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYyksIG51bGwgIT0gYi5kb2N1bWVudEVsZW1lbnQgPyAoYy5hcHBlbmRDaGlsZChiLmRvY3VtZW50RWxlbWVudCksIGMuc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiLCBjKSA6IGJcbiAgICAgICAgfSwgY3JlYXRlanMuU1ZHTG9hZGVyID0gY3JlYXRlanMucHJvbW90ZShTVkdMb2FkZXIsIFwiQWJzdHJhY3RMb2FkZXJcIilcbiAgICB9KCksIHRoaXMuY3JlYXRlanMgPSB0aGlzLmNyZWF0ZWpzIHx8IHt9LFxuICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgICAgICBmdW5jdGlvbiBYTUxMb2FkZXIoYSkge1xuICAgICAgICAgICAgdGhpcy5BYnN0cmFjdExvYWRlcl9jb25zdHJ1Y3RvcihhLCAhMCwgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIuWE1MKSwgdGhpcy5yZXN1bHRGb3JtYXR0ZXIgPSB0aGlzLl9mb3JtYXRSZXN1bHRcbiAgICAgICAgfVxuICAgICAgICB2YXIgYSA9IGNyZWF0ZWpzLmV4dGVuZChYTUxMb2FkZXIsIGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyKSxcbiAgICAgICAgICAgIGIgPSBYTUxMb2FkZXI7XG4gICAgICAgIGIuY2FuTG9hZEl0ZW0gPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICByZXR1cm4gYS50eXBlID09IGNyZWF0ZWpzLkFic3RyYWN0TG9hZGVyLlhNTFxuICAgICAgICB9LCBhLl9mb3JtYXRSZXN1bHQgPSBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlanMuRGF0YVV0aWxzLnBhcnNlWE1MKGEuZ2V0UmVzdWx0KCEwKSwgXCJ0ZXh0L3htbFwiKVxuICAgICAgICB9LCBjcmVhdGVqcy5YTUxMb2FkZXIgPSBjcmVhdGVqcy5wcm9tb3RlKFhNTExvYWRlciwgXCJBYnN0cmFjdExvYWRlclwiKVxuICAgIH0oKTsiXSwiZmlsZSI6InZlbmRvci9wcmVsb2FkanNfMC42LjIubWluLmpzIn0=
